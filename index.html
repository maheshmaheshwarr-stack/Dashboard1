<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mahesh +ve Pill ‚Äî AI-Curated Signal Over Noise</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#f97316" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Mahesh News" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <!-- Open Graph / LinkedIn Sharing -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Mahesh +ve Pill ‚Äî AI-Curated Signal Over Noise" />
  <meta property="og:description" content="An agentic AI news system that resists panic, deprioritises breaking noise, and highlights durable, constructive signals." />
  <meta property="og:url" content="https://maheshmaheshwarr-stack.github.io/Dashboard1/" />
  <meta property="og:image" content="https://maheshmaheshwarr-stack.github.io/Dashboard1/og-preview.png" />
  
  <!-- Article metadata -->
  <meta property="article:author" content="Mahesh Ramanathan" />
  <meta property="article:published_time" content="2025-12-19T08:00:00+05:30" />
  <meta property="article:modified_time" content="2025-12-19T08:00:00+05:30" />
  <meta name="author" content="Mahesh Ramanathan" />

  <style>
    :root {
      --bg: #fffbf5;
      --bg-soft: #fff8ed;
      --bg-softer: #ffedd5;
      --accent: #f97316;
      --accent-soft: rgba(249, 115, 22, 0.12);
      --accent-strong: #ea580c;
      --text-main: #292524;
      --text-muted: #78716c;
      --card-border: #fed7aa;
      --chip-bg: #ffedd5;
      --shadow-soft: 0 6px 16px rgba(194, 65, 12, 0.08);
      --radius-xl: 20px;
      --warm-gradient: linear-gradient(135deg, #fef3c7 0%, #fed7aa 50%, #fecaca 100%);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      background: #fffbf5 !important;
    }

    body {
      background: radial-gradient(circle at top, #fef3c7 0%, #fff8ed 35%, #fffbf5 70%) !important;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column; 
      justify-content: flex-start;
      align-items: center;
      padding: 24px 16px;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
      min-height: auto;
      display: flex;
      flex-direction: column;
      background: #ffffff;
      border-radius: 28px;
      padding: 20px 20px 24px;
      box-shadow: 0 20px 40px rgba(194, 65, 12, 0.12);
      border: 2px solid #fed7aa;
      position: relative;
    }

    .app-shell > footer {
      margin-top: auto;
      text-align: center;
      padding-top: 24px;
      font-size: 0.85rem;
      color: #6b7280;
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 26px 26px 30px;
      }
    }

    header {
      background: linear-gradient(to bottom, #fef3c7, #ffffff);
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 0px;
      padding: 16px 20px; 
      align-items: flex-start;
      border-bottom: 2px solid #fed7aa;
      padding-bottom: 8px;
    }

    @media (min-width: 640px) {
      header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 10px 16px 8px;
      }
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-badge {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #f97316, #ea580c);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 30px rgba(249, 115, 22, 0.4);
      position: relative;
      overflow: hidden;
    }

    .brand-text h1 {
      font-size: 1.35rem;
      letter-spacing: 0.03em;
      margin-bottom: 2px;
      line-height: 1.1;
      margin: 0;
    }

    .brand-text p {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin: 0;
      line-height: 1.2;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-start;
    }

    @media (min-width: 640px) {
      .header-right {
        align-items: flex-end;
      }
    }

    nav {
      display: flex;
      gap: 10px;
      font-size: 0.85rem;
    }

    .nav-link {
      padding: 6px 12px;
      border-radius: 999px;
      text-decoration: none;
      color: var(--text-muted);
      border: 1px solid transparent;
      background: transparent;
      transition: all 0.16s ease-out;
    }

    .nav-link:hover {
      border-color: #fed7aa;
      background: #fff8ed;
      color: #292524;
    }

    .nav-link.active {
      background: radial-gradient(circle at 0 0, rgba(249, 115, 22, 0.18), #ffedd5);
      border-color: rgba(249, 115, 22, 0.9);
      color: #292524;
      box-shadow: 0 10px 24px rgba(194, 65, 12, 0.12);
    }

    .meta {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-start;
    }

    @media (min-width: 640px) {
      .meta {
        align-items: flex-end;
      }
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.75rem;
      justify-content: flex-start;
      margin-bottom: 6px;
    }

    .pill {
      border-radius: 999px;
      padding: 4px 10px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.72rem;
    }

    .pill span.icon {
      font-size: 0.9em;
    }

    .pill--accent {
      border-color: rgba(34, 197, 94, 0.8);
      color: #166534;
      background: rgba(22, 163, 74, 0.08);
    }

    .filters-bar {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      row-gap: 6px;
      margin-bottom: 6px; 
    }

    .filter-chip {
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: var(--chip-bg);
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.16s ease-out;
    }

    .filter-chip span.dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.8);
    }

    .filter-chip.active {
      background: radial-gradient(circle at 0 0, rgba(249, 115, 22, 0.18), #ffedd5);
      color: #292524;
      border-color: rgba(249, 115, 22, 0.9);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(194, 65, 12, 0.12);
    }

    .filter-chip.active span.dot {
      background: #f97316;
    }

    .sources-wrapper {
      margin-top: 6px;
      width: 100%;
      margin-bottom: 0; 
    }

    .sources-wrapper[open] {
      background: #f9fafb;
      border-radius: 999px;
    }

    .sources-summary {
      list-style: none;
      cursor: pointer;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 10px;
      font-size: 0.72rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #f9fafb;
    }

    .sources-summary::-webkit-details-marker {
      display: none;
    }

    .sources-caret {
      font-size: 0.7rem;
      transform: translateY(1px);
      transition: transform 0.2s;
    }

    .sources-count {
      font-size: 0.7rem;
      color: #4b5563;
      padding: 2px 7px;
      border-radius: 999px;
      background: #e5e7eb;
    }

    .sources-wrapper[open] .sources-summary {
      border-color: rgba(249, 115, 22, 0.9);
      background: #ffedd5;
      color: #292524;
    }

    .sources-wrapper[open] .sources-caret {
      transform: rotate(90deg);
    }

    .source-group {
      margin-bottom: 12px;
    }

    .source-group-title {
      font-size: 0.7rem;
      text-transform: uppercase;
      color: #6b7280;
      margin: 6px 0;
      font-weight: 600;
    }

    main {
      margin-top: 8px;
      display: grid;
      grid-template-columns: minmax(0, 1.9fr) minmax(0, 1.1fr);
      gap: 18px;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .multimedia-section {
      grid-column: 1 / -1;
      margin-top: 16px;
      padding: 20px;
      background: #fff8ed;
      border-radius: 20px;
      border: 2px solid #fed7aa;
    }

    .multimedia-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .multimedia-tab {
      padding: 8px 16px;
      border-radius: 999px;
      border: 2px solid #fed7aa;
      background: #ffffff;
      color: #78716c;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .multimedia-tab:hover {
      border-color: #f97316;
      transform: translateY(-2px);
    }

    .multimedia-tab.active {
      background: linear-gradient(135deg, #f97316, #ea580c);
      color: #ffffff;
      border-color: #f97316;
    }

    .multimedia-content {
      display: none;
    }

    .multimedia-content.active {
      display: block;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 16px;
    }

    .gallery-item {
      border-radius: 16px;
      overflow: hidden;
      background: #ffffff;
      border: 2px solid #fed7aa;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    .gallery-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(249, 115, 22, 0.2);
    }

    .gallery-item img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    .gallery-item-content {
      padding: 12px;
    }

    .gallery-item-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #292524;
      line-height: 1.3;
      margin-bottom: 6px;
    }

    .gallery-item-source {
      font-size: 0.7rem;
      color: #78716c;
    }

    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .video-item {
      border-radius: 16px;
      overflow: hidden;
      background: #ffffff;
      border: 2px solid #fed7aa;
    }

    .video-item iframe {
      width: 100%;
      height: 200px;
      border: none;
    }

    .video-item-content {
      padding: 12px;
    }

    .podcast-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .podcast-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      background: #ffffff;
      border-radius: 12px;
      border: 2px solid #fed7aa;
      align-items: center;
      transition: transform 0.2s;
    }

    .podcast-item:hover {
      transform: translateX(4px);
    }

    .podcast-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      background: linear-gradient(135deg, #f97316, #ea580c);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .podcast-info {
      flex: 1;
    }

    .podcast-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #292524;
      margin-bottom: 4px;
    }

    .podcast-meta {
      font-size: 0.75rem;
      color: #78716c;
    }

    .infographic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .infographic-item {
      border-radius: 16px;
      overflow: hidden;
      background: #ffffff;
      border: 2px solid #fed7aa;
      transition: transform 0.2s;
      cursor: pointer;
    }

    .infographic-item:hover {
      transform: scale(1.02);
    }

    .infographic-item img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }

    .infographic-item-content {
      padding: 12px;
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .section-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .section-title h2 {
      font-size: 0.85rem;
      color: var(--text-muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .news-card {
      border-radius: var(--radius-xl);
      border: 2px solid var(--card-border);
      background: var(--bg-soft);
      padding: 12px 13px;
      box-shadow: var(--shadow-soft);
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 6px;
      transition: transform 0.18s ease-out, box-shadow 0.18s ease-out, border-color 0.18s ease-out;
    }

    .news-card:hover {
      transform: translateY(-3px) translateZ(0);
      box-shadow: 0 16px 32px rgba(194, 65, 12, 0.16);
      border-color: rgba(249, 115, 22, 0.7);
    }

    .news-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.68rem;
    }

    .badge {
      padding: 4px 8px;
      border-radius: 999px;
      background: #e5e7eb;
      color: var(--text-muted);
      border: 1px solid rgba(148, 163, 184, 0.8);
    }

    .badge--category {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.65rem;
    }

    .badge--positive {
      border-color: rgba(249, 115, 22, 0.9);
      color: #9a3412;
      background: #ffedd5;
    }

    .news-title {
      font-size: 0.98rem;
      font-weight: 600;
      line-height: 1.4;
      color: var(--text-main);
    }

    .news-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .news-meta {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .tagline {
      font-size: 0.75rem;
      color: #c2410c;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .news-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }

    .source {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .read-link {
      font-size: 0.72rem;
      text-decoration: none;
      color: #ea580c;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .read-link:hover {
      text-decoration: underline;
    }

    .sidebar-card {
      border-radius: 20px;
      border: 2px solid #fed7aa;
      background: #fff8ed;
      padding: 12px 14px;
      box-shadow: 0 6px 16px rgba(194, 65, 12, 0.08);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar-card h3 {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #292524;
    }

    .sidebar-card p {
      font-size: 0.8rem;
      color: var(--text-main);
    }

    .sidebar-list {
      margin-top: 4px;
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .sidebar-list li {
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pill-mini {
      border-radius: 999px;
      padding: 3px 7px;
      border: 1px solid rgba(249, 115, 22, 0.8);
      font-size: 0.7rem;
      color: #c2410c;
      background: #ffedd5;
    }

    .positivity-meter {
      margin-top: 6px;
      width: 100%;
    }

    .positivity-meter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .positivity-bar {
      position: relative;
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .positivity-bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(to right, #f97316, #ea580c);
      transition: width 0.4s ease-out;
    }

    .input, .textarea {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 6px 9px;
      font-size: 0.78rem;
      color: var(--text-main);
      background: #ffffff;
      outline: none;
    }

    .input:focus, .textarea:focus {
      border-color: #f97316;
    }

    .textarea {
      border-radius: 10px;
      min-height: 60px;
      resize: vertical;
    }

    .btn-primary {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      background: #f97316;
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: background 0.2s;
    }

    .btn-primary:hover {
      background: #ea580c;
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .feedback-status {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 4px;
      min-height: 1em;
    }

    .feedback-status.success {
      color: #15803d;
    }

    .feedback-status.error {
      color: #b91c1c;
    }

    .agent-note {
      background: #fff8ed;
      border: 2px solid #fed7aa;
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 16px;
      font-size: 0.85rem;
      color: #292524;
      animation: agentFadeIn 0.5s ease-out;
    }

    @keyframes agentFadeIn {
      from {
        opacity: 0;
        transform: translateY(6px) scale(0.98);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .agent-reason {
      margin-top: 10px;
      padding: 10px 12px;
      font-size: 0.8rem;
      color: #292524;
      background: #fff8ed;
      border-left: 3px solid #f97316;
      border-radius: 8px;
      line-height: 1.4;
    }

    .agent-ignored {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 12px;
      background: #fff7ed;
      border: 1px dashed #fed7aa;
      font-size: 0.8rem;
      color: #7c2d12;
    }

    .agent-ignored ul {
      margin-top: 6px;
      padding-left: 16px;
    }

    .agent-ignored li {
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .agentic-header {
      padding: 16px 20px 12px;
      text-align: center;
    }

    .agentic-brand {
      display: inline-flex;
      align-items: center;
      gap: 14px;
    }

    .agentic-logo {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: radial-gradient(circle at top left, #f97316, #ea580c);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 24px rgba(249, 115, 22, 0.35), inset 0 1px 0 rgba(255,255,255,0.35);
    }

    .agentic-logo-icon {
      font-size: 1.8rem;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,0.15));
    }

    .agentic-text h1 {
      font-size: 1.6rem;
      font-weight: 750;
      margin: 0;
      color: #0f172a;
      letter-spacing: -0.01em;
    }

    .agentic-tagline {
      margin: 2px 0 0;
      font-size: 0.9rem;
      color: #475569;
    }

    .agentic-subline {
      margin-top: 2px;
      font-size: 0.7rem;
      color: #94a3b8;
      letter-spacing: 0.02em;
    }

    footer {
      margin-top: 18px;
      padding-top: 10px;
      border-top: 1px dashed rgba(148, 163, 184, 0.7);
      display: flex;
      flex-direction: column;
      gap: 6px;
      justify-content: center;
      align-items: center;
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    footer a {
      color: #ea580c;
      text-decoration: none;
      cursor: pointer;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .footer-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }

    .footer-badge {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: #f3f4f6;
      color: var(--text-muted);
    }

    .hidden {
      display: none !important;
    }

    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
      }
      50% {
        box-shadow: 0 4px 20px rgba(249, 115, 22, 0.5);
      }
    }

    @keyframes float-bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-8px);
      }
    }

    .floating-discussion-btn {
      position: fixed;
      bottom: 100px;
      right: 30px;
      z-index: 9998;
      padding: 14px 20px;
      background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      color: #ffffff;
      border: none;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(249, 115, 22, 0.4);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      animation: float-bounce 3s ease-in-out infinite;
    }

    .floating-discussion-btn:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 12px 32px rgba(249, 115, 22, 0.5);
    }

    .floating-discussion-btn .badge-new {
      background: #ffffff;
      color: #ea580c;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    @media (max-width: 640px) {
      .floating-discussion-btn {
        bottom: 80px;
        right: 20px;
        padding: 12px 16px;
        font-size: 0.85rem;
      }
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100000;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .modal.show {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      background: #ffffff;
      border-radius: 14px;
      padding: 24px;
      max-width: 520px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      position: relative;
      transform: scale(0.96);
      transition: transform 0.2s ease;
    }

    .modal.show .modal-content {
      transform: scale(1);
    }

    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 12px;
    }

    .modal-content ul {
      margin: 12px 0;
      padding-left: 20px;
    }

    .modal-content li {
      margin-bottom: 8px;
      line-height: 1.5;
    }

    .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      border: none;
      background: none;
      font-size: 22px;
      cursor: pointer;
      color: #6b7280;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .modal-close:hover {
      background: #f3f4f6;
      color: #111827;
    }

    /* Mood Button Styles */
    .mood-btn.active {
      background: #fed7aa !important;
      border-color: #f97316 !important;
      font-weight: 600;
    }

    /* Print Styles */
    @media print {
      body {
        background: white !important;
        padding: 0;
      }

      .app-shell {
        box-shadow: none;
        border: none;
        max-width: 100%;
      }

      header, .filters-bar, .sources-wrapper, 
      .floating-discussion-btn, #chat-widget,
      .multimedia-section, footer, 
      .agent-ignored, .feedback-form,
      .sidebar-card, .nav-link, .pill-row,
      .filter-chip, .btn-primary {
        display: none !important;
      }

      .news-card {
        page-break-inside: avoid;
        border: 1px solid #ddd;
        margin-bottom: 16px;
      }

      .news-title {
        font-size: 1rem;
        color: black;
      }

      .tagline, .agent-reason {
        font-size: 0.85rem;
        color: #333;
      }

      .read-link {
        color: black;
        text-decoration: underline;
      }

      main {
        grid-template-columns: 1fr;
      }

      .column:last-child {
        display: none;
      }
    }

    /* Text-to-Speech Controls */
    .tts-controls {
      position: fixed;
      bottom: 180px;
      right: 30px;
      z-index: 9997;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .tts-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, #f97316, #ea580c);
      color: white;
      font-size: 1.3rem;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tts-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(249, 115, 22, 0.4);
    }

    .tts-btn.active {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* Keyboard Shortcuts Help */
    .keyboard-shortcuts-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100001;
    }

    .keyboard-shortcuts-modal.show {
      display: flex;
    }

    .shortcuts-content {
      background: white;
      padding: 24px;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .shortcut-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #fed7aa;
    }

    .shortcut-key {
      background: #ffedd5;
      padding: 4px 10px;
      border-radius: 6px;
      font-family: monospace;
      font-weight: 600;
      color: #ea580c;
      border: 2px solid #fed7aa;
    }

    /* Accessibility Focus Styles */
    *:focus-visible {
      outline: 3px solid #f97316;
      outline-offset: 2px;
    }

    /* Skip to Content Link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: #f97316;
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 0 0 8px 0;
      z-index: 100;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Language Selector */
    .language-selector {
      position: relative;
      display: inline-block;
    }

    .language-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #fed7aa;
      background: transparent;
      color: #78716c;
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.16s ease-out;
    }

    .language-btn:hover {
      border-color: #fed7aa;
      background: #fff8ed;
      color: #292524;
    }

    .language-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 2px solid #fed7aa;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(249, 115, 22, 0.2);
      display: none;
      min-width: 180px;
      z-index: 1000;
    }

    .language-dropdown.show {
      display: block;
    }

    .language-option {
      padding: 10px 16px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: #292524;
    }

    .language-option:first-child {
      border-radius: 10px 10px 0 0;
    }

    .language-option:last-child {
      border-radius: 0 0 10px 10px;
    }

    .language-option:hover {
      background: #fff8ed;
    }

    .language-option.active {
      background: #ffedd5;
      font-weight: 600;
      color: #ea580c;
    }

    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #fed7aa;
      border-top-color: #f97316;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  
  <!-- Skip to Content Link for Accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Text-to-Speech Controls -->
  <div class="tts-controls">
    <button class="tts-btn" id="tts-play-btn" title="Read articles aloud (Alt+R)" aria-label="Read articles aloud">
      üîä
    </button>
    <button class="tts-btn" id="tts-stop-btn" title="Stop reading (Alt+S)" aria-label="Stop reading" style="display:none;">
      ‚èπÔ∏è
    </button>
  </div>
  
  <header class="agentic-header">
    <div class="agentic-brand">
      <div class="agentic-logo">
        <span class="agentic-logo-icon">üß†</span>
      </div>
      <div class="agentic-text">
        <h1>Mahesh +ve Pill</h1>
        <p class="agentic-tagline">Signal-first news, curated with intent</p>
        <p class="agentic-subline">AI that selects ‚Ä¢ deprioritises ‚Ä¢ explains</p>
      </div>
    </div>
    
    <!-- NEW FEATURE ANNOUNCEMENT -->
    <div style="
      margin-top: 16px;
      padding: 12px 16px;
      background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
      animation: pulse-glow 2s ease-in-out infinite;
    ">
      <span style="font-size: 1.5rem;">üì±</span>
      <div style="flex: 1;">
        <div style="
          font-size: 0.9rem;
          font-weight: 700;
          color: #ffffff;
          margin-bottom: 2px;
        ">Install as Mobile App!</div>
        <div style="
          font-size: 0.75rem;
          color: #ffedd5;
        ">Works offline ‚Ä¢ Push notifications ‚Ä¢ No app store needed</div>
      </div>
      <button onclick="triggerInstall()" style="
        padding: 8px 16px;
        background: #ffffff;
        color: #ea580c;
        border: none;
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
        white-space: nowrap;
      " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
        Install Now ‚Üí
      </button>
    </div>
  </header>

  <div class="app-shell">
    <header>
      <div class="header-right">
        <nav aria-label="Main navigation">
          <a class="nav-link active" href="index.html">News Feed</a>
          <a class="nav-link" href="about.html">About</a>
          
          <!-- Language Selector -->
          <div class="language-selector">
            <button class="language-btn" id="language-btn" aria-label="Select language">
              <span id="current-language-flag">üåê</span>
              <span id="current-language-text">English</span>
              <span style="font-size: 0.7rem;">‚ñº</span>
            </button>
            <div class="language-dropdown" id="language-dropdown">
              <div class="language-option active" data-lang="en" data-flag="üá¨üáß">
                <span>üá¨üáß</span> English
              </div>
              <div class="language-option" data-lang="hi" data-flag="üáÆüá≥">
                <span>üáÆüá≥</span> ‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)
              </div>
              <div class="language-option" data-lang="ta" data-flag="üáÆüá≥">
                <span>üáÆüá≥</span> ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)
              </div>
              <div class="language-option" data-lang="te" data-flag="üáÆüá≥">
                <span>üáÆüá≥</span> ‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)
              </div>
              <div class="language-option" data-lang="kn" data-flag="üáÆüá≥">
                <span>üáÆüá≥</span> ‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)
              </div>
              <div class="language-option" data-lang="ml" data-flag="üáÆüá≥">
                <span>üáÆüá≥</span> ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)
              </div>
            </div>
          </div>
          
          <button id="pwa-install-btn" style="
            padding: 6px 12px;
            border-radius: 999px;
            border: 2px solid #f97316;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #ffffff;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.16s ease-out;
            display: none;
          ">
            üì± Install App
          </button>
        </nav>

        <div class="meta">
          <div class="pill-row">
            <div class="pill pill--accent">
              <span class="icon">‚ú®</span>
              <span>Signal over noise. Positivity over panic.</span>
            </div>
            <div class="pill">
              <span class="icon">üïí</span>
              <span id="last-updated">Fetching latest headlines‚Ä¶</span>
            </div>
            <div class="pill" id="weather-widget" style="cursor: pointer; display: none;" title="Click to refresh weather">
              <span class="icon" id="weather-icon">üå§Ô∏è</span>
              <span id="weather-text">Loading weather...</span>
            </div>
          </div>

          <div class="filters-bar" aria-label="Filter by topic">
            <button class="filter-chip active" data-filter="all">
              <span class="dot"></span>All
            </button>
            <button class="filter-chip" data-filter="current">
              <span class="dot"></span>Current Affairs
            </button>
            <button class="filter-chip" data-filter="ai">
              <span class="dot"></span>IT &amp; AI Trends
            </button>
            <button class="filter-chip" data-filter="startups">
              <span class="dot"></span>Startups
            </button>
            <button class="filter-chip" data-filter="markets">
              <span class="dot"></span>Stock Market &amp; Economy
            </button>
            <button class="filter-chip" data-filter="politics">
              <span class="dot"></span>Politics
            </button>
            <button class="filter-chip" data-filter="sports">
              <span class="dot"></span>Sports
            </button>
            <button class="filter-chip" data-filter="automobiles">
              <span class="dot"></span>Automobiles
            </button>
            <button id="refresh-btn" class="filter-chip" style="background:rgba(56,189,248,0.12);border-color:rgba(56,189,248,0.85);">
              <span class="dot"></span>Refresh
            </button>
          </div>

          <details class="sources-wrapper">
            <summary class="sources-summary">
              <span class="sources-label">
                <span class="sources-caret">‚ñ∂</span>Sources
              </span>
              <span class="sources-count" id="sources-count-label">All sources (combined)</span>
            </summary>
            <div class="sources-body">
              <div class="filters-bar" id="source-filters">
                <div class="source-group">
                  <div class="source-group-title">Institutions</div>
                  <button class="filter-chip source-chip" data-source="pib">PIB</button>
                  <button class="filter-chip source-chip" data-source="rbi">RBI</button>
                  <button class="filter-chip source-chip" data-source="tbi">The Better India</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Indian News</div>
                  <button class="filter-chip source-chip" data-source="thehindu">The Hindu</button>
                  <button class="filter-chip source-chip" data-source="hindustantimes">Hindustan Times</button>
                  <button class="filter-chip source-chip" data-source="ndtv">NDTV</button>
                  <button class="filter-chip source-chip" data-source="indiatoday">India Today</button>
                  <button class="filter-chip source-chip" data-source="toi">Times of India</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">International News</div>
                  <button class="filter-chip source-chip" data-source="bbc">BBC</button>
                  <button class="filter-chip source-chip" data-source="reuters">Reuters</button>
                  <button class="filter-chip source-chip" data-source="aljazeera">Al Jazeera</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Markets & Business</div>
                  <button class="filter-chip source-chip" data-source="etmarkets">ET Markets</button>
                  <button class="filter-chip source-chip" data-source="livemint">Livemint</button>
                  <button class="filter-chip source-chip" data-source="moneycontrol">Moneycontrol</button>
                  <button class="filter-chip source-chip" data-source="financialexpress">Financial Express</button>
                  <button class="filter-chip source-chip" data-source="businessstandard">Business Standard</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Technology & Startups</div>
                  <button class="filter-chip source-chip" data-source="ietech">IE Tech</button>
                  <button class="filter-chip source-chip" data-source="techcrunch">TechCrunch</button>
                  <button class="filter-chip source-chip" data-source="theverge">The Verge</button>
                  <button class="filter-chip source-chip" data-source="wired">Wired</button>
                  <button class="filter-chip source-chip" data-source="yourstory">YourStory</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Automobiles</div>
                  <button class="filter-chip source-chip" data-source="autocarindia">Autocar India</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Sports</div>
                  <button class="filter-chip source-chip" data-source="iesports">IE Sports</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Politics</div>
                  <button class="filter-chip source-chip" data-source="politics">Indian Express Politics</button>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>
    </header>

    <main>
      <section class="column" aria-label="Main news feed">
        <div class="section-title">
          <h2>Today's Highlights</h2>
        </div>

        <div class="agent-note">
          <div id="agent-note-text" class="agent-note-text">Loading AI curator insights...</div>
        </div>

        <div class="agent-ignored">
          <strong>üß† What the AI intentionally ignored today</strong>
          <ul id="ignored-list">
            <li>Evaluating headlines...</li>
          </ul>
        </div>

        <div class="news-list" id="news-list">
          <p style="color:#6b7280;font-size:0.8rem;">Fetching positive stories from multiple sources‚Ä¶</p>
        </div>

        <div style="margin-top:12px;text-align:center;">
          <button id="load-more-btn" class="btn-primary" style="background:#e0f2fe;display:none;">
            Show more stories
          </button>
        </div>
      </section>

      <aside class="column" aria-label="Summary and quick stats">
        <!-- Support/Sponsor Card -->
        <section class="sidebar-card" style="background: linear-gradient(135deg, #fef3c7, #fed7aa); border-color: #f97316;">
          <h3 style="display: flex; align-items: center; gap: 8px;">
            ‚òï Support This Project
          </h3>
          <p style="font-size:0.78rem;color:#78716c;">Help keep this ad-free and growing!</p>
          
          <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 12px;">
            <a href="https://www.buymeacoffee.com/maheshramanathan" target="_blank" rel="noopener noreferrer" style="
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              padding: 10px;
              background: #FFDD00;
              color: #000000;
              text-decoration: none;
              border-radius: 999px;
              font-weight: 600;
              font-size: 0.85rem;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              <span>‚òï</span> Buy Me a Coffee
            </a>
            
            <a href="https://github.com/sponsors/maheshmaheshwarr-stack" target="_blank" rel="noopener noreferrer" style="
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              padding: 10px;
              background: #ea4aaa;
              color: #ffffff;
              text-decoration: none;
              border-radius: 999px;
              font-weight: 600;
              font-size: 0.85rem;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              <span>üíñ</span> GitHub Sponsor
            </a>
          </div>
          
          <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px; font-size: 0.75rem; color: #78716c;">
            <strong>Your support helps:</strong><br>
            ‚Ä¢ Keep the site ad-free<br>
            ‚Ä¢ Add more news sources<br>
            ‚Ä¢ Improve AI features<br>
            ‚Ä¢ Maintain servers
          </div>
        </section>

        <!-- Premium Tier Teaser -->
        <section class="sidebar-card" style="margin-top: 10px; background: linear-gradient(135deg, #292524, #44403c); color: #ffffff; border-color: #78716c;">
          <h3 style="color: #ffffff; display: flex; align-items: center; gap: 8px;">
            ‚≠ê Premium Coming Soon
          </h3>
          <p style="font-size:0.78rem;color: #d6d3d1;">Unlock advanced features</p>
          
          <ul style="list-style: none; padding: 0; margin: 12px 0; font-size: 0.8rem; color: #e7e5e4;">
            <li style="margin-bottom: 8px;">‚ú® Ad-free experience (forever)</li>
            <li style="margin-bottom: 8px;">üìä Advanced analytics & insights</li>
            <li style="margin-bottom: 8px;">üéØ Custom news filters</li>
            <li style="margin-bottom: 8px;">üîî Priority notifications</li>
            <li style="margin-bottom: 8px;">üöÄ Early access to features</li>
            <li style="margin-bottom: 8px;">üíæ Export reading history</li>
          </ul>
          
          <button onclick="showPremiumModal()" style="
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #ffffff;
            border: none;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.2s;
          " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
            Join Waitlist ‚Üí
          </button>
          
          <div style="margin-top: 8px; text-align: center; font-size: 0.7rem; color: #a8a29e;">
            Early bird: $2.99/month
          </div>
        </section>

        <section class="sidebar-card" style="margin-top: 10px;">
          <h3>üìä Your Reading Stats</h3>
          <p style="font-size:0.78rem;color:#78716c;">Track your news consumption habits</p>
          <ul class="sidebar-list">
            <li>Articles read today<span class="pill-mini" id="articles-read-today">0</span></li>
            <li>This week<span class="pill-mini" id="articles-read-week">0</span></li>
            <li>Favorite category<span class="pill-mini" id="favorite-category">‚Äî</span></li>
            <li>Reading streak<span class="pill-mini" id="reading-streak">0 days</span></li>
          </ul>
          <button onclick="showStatsModal()" style="
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #ffffff;
            border: none;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
          " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
            View Detailed Stats ‚Üí
          </button>
        </section>

        <!-- AI Agent Card -->
        <section class="sidebar-card" style="margin-top: 10px; background: linear-gradient(135deg, #ede9fe, #ddd6fe); border-color: #a78bfa;">
          <h3 style="display: flex; align-items: center; gap: 8px;">
            ü§ñ AI Agent
          </h3>
          <p style="font-size:0.78rem;color:#78716c;">Learning your preferences</p>
          
          <div id="ai-learning-stats" style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px;">
            <div style="font-size: 0.75rem; color: #78716c;">
              üå± Building your profile...
            </div>
          </div>

          <div id="ai-agent-insight" style="
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            font-size: 0.75rem;
            color: #292524;
            line-height: 1.4;
          ">
            ü§ñ AI is learning your preferences. Keep reading to get personalized recommendations!
          </div>

          <div style="display: flex; flex-direction: column; gap: 6px; margin-top: 10px;">
            <button onclick="showAIRecommendations()" style="
              width: 100%;
              padding: 8px;
              background: linear-gradient(135deg, #8b5cf6, #7c3aed);
              color: #ffffff;
              border: none;
              border-radius: 999px;
              font-size: 0.75rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              ‚ú® AI Recommendations
            </button>

            <button onclick="showQuickReads()" style="
              width: 100%;
              padding: 8px;
              background: linear-gradient(135deg, #06b6d4, #0891b2);
              color: #ffffff;
              border: none;
              border-radius: 999px;
              font-size: 0.75rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              ‚ö° Quick Reads (< 3 min)
            </button>

            <button id="toggle-ai-learning-btn" onclick="toggleAILearning()" style="
              width: 100%;
              padding: 8px;
              background: linear-gradient(135deg, #f97316, #ea580c);
              color: #ffffff;
              border: none;
              border-radius: 999px;
              font-size: 0.75rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              ü§ñ AI Learning: ON
            </button>
          </div>

          <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.7); border-radius: 8px;">
            <div style="font-size: 0.7rem; color: #78716c; margin-bottom: 6px; font-weight: 600;">Mood Preference:</div>
            <div style="display: flex; gap: 4px;">
              <button class="mood-btn active" data-mood="uplifting" onclick="changeMoodPreference('uplifting')" style="
                flex: 1;
                padding: 6px;
                background: #fed7aa;
                border: 2px solid #f97316;
                border-radius: 8px;
                font-size: 0.65rem;
                cursor: pointer;
                transition: all 0.2s;
              ">üòä Uplifting</button>
              <button class="mood-btn" data-mood="balanced" onclick="changeMoodPreference('balanced')" style="
                flex: 1;
                padding: 6px;
                background: #e5e7eb;
                border: 2px solid transparent;
                border-radius: 8px;
                font-size: 0.65rem;
                cursor: pointer;
                transition: all 0.2s;
              ">‚öñÔ∏è Balanced</button>
              <button class="mood-btn" data-mood="serious" onclick="changeMoodPreference('serious')" style="
                flex: 1;
                padding: 6px;
                background: #e5e7eb;
                border: 2px solid transparent;
                border-radius: 8px;
                font-size: 0.65rem;
                cursor: pointer;
                transition: all 0.2s;
              ">üì∞ Serious</button>
            </div>
          </div>
        </section>

        <section class="sidebar-card" style="margin-top: 10px;">
          <h3>Today's Mood</h3>
          <p>A quick snapshot of why today's feed is net-positive.</p>
          <ul class="sidebar-list">
            <li>Net positive impact<span class="pill-mini" id="positive-count">0 stories</span></li>
            <li>Focus on AI / tech<span class="pill-mini">Key stories</span></li>
            <li>Personal relevance<span class="pill-mini">Custom curated</span></li>
          </ul>

          <div class="positivity-meter" aria-label="Overall positivity of today's feed">
            <div class="positivity-meter-header">
              <span>Positivity meter</span>
              <span id="positivity-percent">‚Äì</span>
            </div>
            <div class="positivity-bar">
              <div class="positivity-bar-fill" id="positivity-bar-fill"></div>
            </div>
          </div>
        </section>

        <section class="sidebar-card" style="margin-top: 10px;">
          <h3>Visitor Feedback</h3>
          <p style="font-size:0.78rem;color:#6b7280;">Tell me who you are and how this news feed feels.</p>
          <form id="feedback-form" style="display:flex;flex-direction:column;gap:6px;margin-top:4px;">
            <input id="feedback-name" class="input" type="text" placeholder="Your name (optional)" autocomplete="name" />
            <textarea id="feedback-text" class="textarea" placeholder="Any feedback or suggestions‚Ä¶"></textarea>
            <button type="submit" class="btn-primary" id="feedback-submit">
              <span>Send feedback</span> <span>üì®</span>
            </button>
          </form>
          <div id="feedback-status" class="feedback-status"></div>
        </section>
      </aside>
    </main>

    <!-- Multimedia Section -->
    <section class="multimedia-section">
      <div style="margin-bottom: 16px;">
        <h2 style="font-size: 1.3rem; font-weight: 600; color: #292524; margin-bottom: 6px;">
          üé¨ Multimedia News Experience
        </h2>
        <p style="font-size: 0.85rem; color: #78716c;">
          Explore news through images, videos, podcasts, and infographics
        </p>
      </div>

      <div class="multimedia-tabs">
        <button class="multimedia-tab active" onclick="switchMultimediaTab('gallery')">
          <span>üñºÔ∏è</span> Image Gallery
        </button>
        <button class="multimedia-tab" onclick="switchMultimediaTab('videos')">
          <span>üìπ</span> Video News
        </button>
        <button class="multimedia-tab" onclick="switchMultimediaTab('podcasts')">
          <span>üéôÔ∏è</span> Podcasts
        </button>
        <button class="multimedia-tab" onclick="switchMultimediaTab('infographics')">
          <span>üìä</span> Infographics
        </button>
      </div>

      <!-- Image Gallery -->
      <div id="gallery-content" class="multimedia-content active">
        <div class="gallery-grid" id="gallery-grid">
          <p style="color: #78716c; font-size: 0.85rem;">Loading visual stories...</p>
        </div>
      </div>

      <!-- Video News -->
      <div id="videos-content" class="multimedia-content">
        <div class="video-grid" id="video-grid">
          <!-- Videos will be populated here -->
        </div>
      </div>

      <!-- Podcasts -->
      <div id="podcasts-content" class="multimedia-content">
        <div class="podcast-list" id="podcast-list">
          <!-- Podcasts will be populated here -->
        </div>
      </div>

      <!-- Infographics -->
      <div id="infographics-content" class="multimedia-content">
        <div class="infographic-grid" id="infographic-grid">
          <!-- Infographics will be populated here -->
        </div>
      </div>
    </section>

    <!-- Recommended Resources (Affiliate Section) -->
    <section class="multimedia-section" style="margin-top: 16px;">
      <div style="margin-bottom: 16px;">
        <h2 style="font-size: 1.3rem; font-weight: 600; color: #292524; margin-bottom: 6px;">
          üìö Recommended Resources
        </h2>
        <p style="font-size: 0.85rem; color: #78716c;">
          Curated books, courses, and tools to deepen your understanding
        </p>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
        <!-- Book Recommendations -->
        <div style="
          padding: 16px;
          background: #ffffff;
          border: 2px solid #fed7aa;
          border-radius: 16px;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="font-size: 1.5rem; margin-bottom: 8px;">üìñ</div>
          <h3 style="font-size: 1rem; font-weight: 600; color: #292524; margin-bottom: 8px;">
            The Signal and the Noise
          </h3>
          <p style="font-size: 0.8rem; color: #78716c; margin-bottom: 12px;">
            By Nate Silver - Learn to distinguish signal from noise in data and news
          </p>
          <a href="https://www.amazon.com/Signal-Noise-Many-Predictions-Fail-but/dp/0143125087?&linkCode=ll1&tag=maheshnews-20" 
             target="_blank" 
             rel="noopener noreferrer sponsored"
             style="
               display: inline-block;
               padding: 8px 16px;
               background: #f97316;
               color: #ffffff;
               text-decoration: none;
               border-radius: 999px;
               font-size: 0.8rem;
               font-weight: 600;
               transition: background 0.2s;
             "
             onmouseover="this.style.background='#ea580c'"
             onmouseout="this.style.background='#f97316'">
            View on Amazon ‚Üí
          </a>
          <div style="margin-top: 8px; font-size: 0.7rem; color: #a8a29e;">
            Affiliate link - supports this project
          </div>
        </div>

        <!-- Course Recommendation -->
        <div style="
          padding: 16px;
          background: #ffffff;
          border: 2px solid #fed7aa;
          border-radius: 16px;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="font-size: 1.5rem; margin-bottom: 8px;">üéì</div>
          <h3 style="font-size: 1rem; font-weight: 600; color: #292524; margin-bottom: 8px;">
            AI for Everyone
          </h3>
          <p style="font-size: 0.8rem; color: #78716c; margin-bottom: 12px;">
            By Andrew Ng on Coursera - Understand AI without coding
          </p>
          <a href="https://www.coursera.org/learn/ai-for-everyone" 
             target="_blank" 
             rel="noopener noreferrer"
             style="
               display: inline-block;
               padding: 8px 16px;
               background: #f97316;
               color: #ffffff;
               text-decoration: none;
               border-radius: 999px;
               font-size: 0.8rem;
               font-weight: 600;
               transition: background 0.2s;
             "
             onmouseover="this.style.background='#ea580c'"
             onmouseout="this.style.background='#f97316'">
            Enroll Free ‚Üí
          </a>
          <div style="margin-top: 8px; font-size: 0.7rem; color: #a8a29e;">
            Free to audit
          </div>
        </div>

        <!-- Tool Recommendation -->
        <div style="
          padding: 16px;
          background: #ffffff;
          border: 2px solid #fed7aa;
          border-radius: 16px;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="font-size: 1.5rem; margin-bottom: 8px;">üõ†Ô∏è</div>
          <h3 style="font-size: 1rem; font-weight: 600; color: #292524; margin-bottom: 8px;">
            Feedly Pro
          </h3>
          <p style="font-size: 0.8rem; color: #78716c; margin-bottom: 12px;">
            Advanced RSS reader with AI-powered insights and filtering
          </p>
          <a href="https://feedly.com/" 
             target="_blank" 
             rel="noopener noreferrer"
             style="
               display: inline-block;
               padding: 8px 16px;
               background: #f97316;
               color: #ffffff;
               text-decoration: none;
               border-radius: 999px;
               font-size: 0.8rem;
               font-weight: 600;
               transition: background 0.2s;
             "
             onmouseover="this.style.background='#ea580c'"
             onmouseout="this.style.background='#f97316'">
            Try Feedly ‚Üí
          </a>
          <div style="margin-top: 8px; font-size: 0.7rem; color: #a8a29e;">
            Free plan available
          </div>
        </div>
      </div>

      <div style="margin-top: 16px; padding: 12px; background: #fff8ed; border-radius: 8px; border-left: 3px solid #f97316; font-size: 0.8rem; color: #78716c;">
        <strong>üí° Transparency Note:</strong> Some links above are affiliate links. If you purchase through them, we may earn a small commission at no extra cost to you. This helps keep the site ad-free and supports development. We only recommend products we genuinely believe in.
      </div>
    </section>

    <footer>
      <span>Built for a calm information diet. Tweak this page as your interests evolve.</span>
      <div class="footer-badges">
        <span class="footer-badge">üå± Growth-focused</span>
        <span class="footer-badge">üìö Curated, not addictive</span>
        <span class="footer-badge">ü§ñ AI, markets, sport &amp; more</span>
        <span class="footer-badge">üáÆüá≥ Built in India</span>
        <span class="footer-badge" style="background: linear-gradient(135deg, #f97316, #ea580c); color: #ffffff; border-color: #f97316;">ÔøΩ Installable PWA</span>
        <span class="footer-badge" style="background: linear-gradient(135deg, #f97316, #ea580c); color: #ffffff; border-color: #f97316;">üí¨ Community Discussions</span>
      </div>

      <div style="width:100%;text-align:center;margin-top:8px;font-size:0.7rem;color:#6b7280;">
        <a href="#" id="privacy-link">Privacy</a>
        <span style="margin:0 8px;">‚Ä¢</span>
        <a href="#" id="terms-link">Terms</a>
        <span style="margin:0 8px;">‚Ä¢</span>
        <a href="https://wa.me/?text=Check%20out%20this%20AI-powered%20news%20dashboard%20that%20filters%20panic%20and%20highlights%20positivity!%20%F0%9F%A7%A0%E2%9C%A8%20https://maheshmaheshwarr-stack.github.io/Dashboard1/" 
           target="_blank"
           rel="noopener noreferrer"
           style="color:#25D366;font-weight:600;">
          üì± Share on WhatsApp
        </a>
      </div>

      <div style="width:100%;text-align:center;margin-top:4px;font-size:0.7rem;color:#9ca3af;">
        ¬© <span id="copyright-year"></span> Mahesh Ramanathan ‚Äî All rights reserved.
      </div>
    </footer>
  </div>

  <!-- Community Discussion Section -->
  <div id="discussion-section" style="
    width: 100%;
    max-width: 1100px;
    margin: 24px auto;
    padding: 24px;
    background: #ffffff;
    border-radius: 28px;
    box-shadow: 0 20px 40px rgba(15, 23, 42, 0.08);
    border: 1px solid #e5e7eb;
  ">
    <div style="margin-bottom: 16px;">
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
        <h2 style="
          font-size: 1.2rem;
          font-weight: 600;
          color: #0f172a;
          margin: 0;
        ">üí¨ Community Discussion</h2>
        <span style="
          padding: 4px 10px;
          background: linear-gradient(135deg, #f97316, #ea580c);
          color: #ffffff;
          font-size: 0.7rem;
          font-weight: 700;
          border-radius: 999px;
          text-transform: uppercase;
          letter-spacing: 0.05em;
        ">New Feature</span>
      </div>
      <p style="
        font-size: 0.85rem;
        color: #6b7280;
        line-height: 1.5;
      ">
        Share your thoughts, discuss today's news, and collaborate with other readers. 
        Sign in with GitHub to join the conversation.
      </p>
    </div>
    
    <!-- Giscus Comments -->
    <script src="https://giscus.app/client.js"
            data-repo="maheshmaheshwarr-stack/Dashboard1"
            data-repo-id="R_kgDOQhtkgg"
            data-category="General"
            data-category-id="DIC_kwDOQhtkgs4C07hu"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="light"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
    </script>
  </div>

  <!-- Floating Discussion Button -->
  <button class="floating-discussion-btn" onclick="document.getElementById('discussion-section').scrollIntoView({behavior: 'smooth'})">
    <span>üí¨</span>
    <span>Join Discussion</span>
    <span class="badge-new">New</span>
  </button>

  <!-- Privacy Modal -->
  <div class="modal" id="privacy-modal">
    <div class="modal-content">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2>Privacy Policy</h2>
      <p>Mahesh Positive News Feed respects your privacy.</p>
      <ul>
        <li>No personal data is collected by default.</li>
        <li>No tracking cookies are used.</li>
        <li>News content is fetched from public RSS sources.</li>
        <li>All processing happens in your browser.</li>
      </ul>
      <p>This site is provided "as is" without guarantees of accuracy or availability.</p>
    </div>
  </div>

  <!-- Terms Modal -->
  <div class="modal" id="terms-modal">
    <div class="modal-content">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2>Terms of Use</h2>
      <ul>
        <li>This site is for informational purposes only.</li>
        <li>News summaries and positivity scores are automated and may be imperfect.</li>
        <li>External links lead to third-party websites over which we have no control.</li>
        <li>You agree not to misuse or attempt to disrupt the service.</li>
        <li>Content is provided without warranties of any kind.</li>
      </ul>
      <p>By using this site, you accept these terms.</p>
    </div>
  </div>

  <!-- Premium Waitlist Modal -->
  <div class="modal" id="premium-modal">
    <div class="modal-content" style="max-width: 540px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
        <span>‚≠ê</span> Premium Features Coming Soon
      </h2>
      
      <div style="background: linear-gradient(135deg, #fef3c7, #fed7aa); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
        <div style="font-size: 2rem; font-weight: 700; color: #ea580c; margin-bottom: 4px;">
          $2.99<span style="font-size: 1rem; font-weight: 400; color: #78716c;">/month</span>
        </div>
        <div style="font-size: 0.85rem; color: #78716c;">
          Early bird pricing - Lock in this rate forever!
        </div>
      </div>

      <div style="margin-bottom: 20px;">
        <h3 style="font-size: 1rem; margin-bottom: 12px;">What You'll Get:</h3>
        <ul style="list-style: none; padding: 0; display: flex; flex-direction: column; gap: 10px;">
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">‚ú®</span>
            <div>
              <strong>Ad-Free Forever</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">No ads, no distractions, pure news</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">üìä</span>
            <div>
              <strong>Advanced Analytics</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Deep insights into your reading habits</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">üéØ</span>
            <div>
              <strong>Custom Filters</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Create your own news categories</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">üîî</span>
            <div>
              <strong>Priority Notifications</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Get alerts for topics you care about</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">üöÄ</span>
            <div>
              <strong>Early Access</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Try new features before everyone else</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">üíæ</span>
            <div>
              <strong>Export Data</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Download your reading history anytime</span>
            </div>
          </li>
        </ul>
      </div>

      <form id="premium-waitlist-form" style="display: flex; flex-direction: column; gap: 12px;">
        <input 
          type="email" 
          id="premium-email" 
          placeholder="Enter your email" 
          required
          style="
            padding: 12px;
            border: 2px solid #fed7aa;
            border-radius: 8px;
            font-size: 0.9rem;
            outline: none;
          "
        />
        <button type="submit" style="
          padding: 12px;
          background: linear-gradient(135deg, #f97316, #ea580c);
          color: #ffffff;
          border: none;
          border-radius: 999px;
          font-weight: 600;
          font-size: 0.9rem;
          cursor: pointer;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
          Join Waitlist - Get Notified! üéâ
        </button>
      </form>

      <div id="premium-waitlist-status" style="margin-top: 12px; text-align: center; font-size: 0.85rem;"></div>

      <div style="margin-top: 16px; padding: 12px; background: #fff8ed; border-radius: 8px; font-size: 0.75rem; color: #78716c; text-align: center;">
        <strong>100% Money-Back Guarantee</strong><br>
        Not satisfied? Get a full refund within 30 days, no questions asked.
      </div>
    </div>
  </div>

  <!-- Reading Stats Modal -->
  <div class="modal" id="stats-modal">
    <div class="modal-content" style="max-width: 640px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px;">
        üìä Your Reading Statistics
      </h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin: 16px 0;">
        <div style="padding: 16px; background: #fff8ed; border: 2px solid #fed7aa; border-radius: 12px; text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #ea580c;" id="modal-total-read">0</div>
          <div style="font-size: 0.75rem; color: #78716c; margin-top: 4px;">Total Articles Read</div>
        </div>
        <div style="padding: 16px; background: #fff8ed; border: 2px solid #fed7aa; border-radius: 12px; text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #ea580c;" id="modal-week-read">0</div>
          <div style="font-size: 0.75rem; color: #78716c; margin-top: 4px;">This Week</div>
        </div>
        <div style="padding: 16px; background: #fff8ed; border: 2px solid #fed7aa; border-radius: 12px; text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #ea580c;" id="modal-streak">0</div>
          <div style="font-size: 0.75rem; color: #78716c; margin-top: 4px;">Day Streak üî•</div>
        </div>
      </div>

      <div style="margin: 20px 0;">
        <h3 style="font-size: 1rem; margin-bottom: 12px;">üìö Reading by Category</h3>
        <div id="category-breakdown" style="display: flex; flex-direction: column; gap: 8px;">
          <!-- Will be populated by JS -->
        </div>
      </div>

      <div style="margin: 20px 0;">
        <h3 style="font-size: 1rem; margin-bottom: 12px;">üì∞ Reading by Source</h3>
        <div id="source-breakdown" style="display: flex; flex-direction: column; gap: 8px;">
          <!-- Will be populated by JS -->
        </div>
      </div>

      <div style="margin: 20px 0; padding: 12px; background: #fff8ed; border-radius: 8px; border-left: 3px solid #f97316;">
        <strong>üí° Insight:</strong> <span id="reading-insight">Keep reading to unlock insights!</span>
      </div>

      <button onclick="resetStats()" style="
        width: 100%;
        padding: 10px;
        background: #fed7aa;
        color: #9a3412;
        border: 2px solid #fed7aa;
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 12px;
      ">
        Reset Statistics
      </button>
    </div>
  </div>

  <!-- AI Recommendations Modal -->
  <div class="modal" id="ai-recommendations-modal">
    <div class="modal-content" style="max-width: 600px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px;">
        ‚ú® AI Recommendations
      </h2>
      <p style="font-size: 0.85rem; color: #78716c; margin-bottom: 16px;">
        Based on your reading patterns, here are articles you might enjoy:
      </p>
      
      <div id="ai-recommendations-list" style="max-height: 400px; overflow-y: auto;">
        <!-- Will be populated by JS -->
      </div>
    </div>
  </div>

  <!-- Quick Reads Modal -->
  <div class="modal" id="quick-reads-modal">
    <div class="modal-content" style="max-width: 600px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px;">
        ‚ö° Quick Reads
      </h2>
      <p style="font-size: 0.85rem; color: #78716c; margin-bottom: 16px;">
        Short articles you can read in under 3 minutes:
      </p>
      
      <div id="quick-reads-list" style="max-height: 400px; overflow-y: auto;">
        <!-- Will be populated by JS -->
      </div>
    </div>
  </div>

  <!-- AI News Chat Widget -->
  <div id="chat-widget" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 320px;
    max-width: 90vw;
    background: #ffffff;
    border-radius: 18px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 10px 25px rgba(15,23,42,0.15);
    font-size: 0.8rem;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    z-index: 9999;
  ">
    <div id="chat-header" style="
      padding: 10px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(to right, #e0f2fe, #f9fafb);
      cursor: pointer;
      border-bottom: 1px solid #e5e7eb;
    ">
      <div>
        <div style="font-size:0.85rem;font-weight:600;color:#0f172a;">üí¨ News Chat</div>
        <div style="font-size:0.7rem;color:#6b7280;margin-top:2px;">Ask about today's feed</div>
      </div>
      <button id="chat-toggle" style="
        background:none;
        border:none;
        color:#0f172a;
        font-size:1.3rem;
        cursor:pointer;
        width:32px;
        height:32px;
        display:flex;
        align-items:center;
        justify-content:center;
        border-radius:50%;
        transition: background 0.2s;
      ">‚àí</button>
    </div>
    
    <div id="chat-body" style="
      display:flex;
      flex-direction:column;
      height:320px;
      background:#f9fafb;
    ">
      <div id="chat-messages" style="
        flex:1;
        padding:10px;
        overflow-y:auto;
        display:flex;
        flex-direction:column;
        gap:8px;
      ">
        <div style="
          align-self:flex-start;
          max-width:90%;
          padding:8px 10px;
          border-radius:12px;
          background:#e5e7eb;
          color:#111827;
          font-size:0.8rem;
          line-height:1.4;
        ">
          üëã I can answer questions about the stories on this page. Try: "What are today's IT highlights?" or "Summarise the sports news."
        </div>
      </div>
      
      <form id="chat-form" style="
        display:flex;
        padding:8px;
        gap:6px;
        border-top:1px solid #e5e7eb;
        background:#ffffff;
      ">
        <input
          id="chat-input"
          type="text"
          placeholder="Ask about today's news..."
          style="
            flex:1;
            background:#ffffff;
            border:1px solid #d1d5db;
            border-radius:999px;
            padding:6px 10px;
            color:#111827;
            font-size:0.8rem;
            outline:none;
          "
        />
        <button type="submit" style="
          border:none;
          border-radius:999px;
          padding:6px 12px;
          background:#38bdf8;
          color:#020617;
          font-weight:600;
          font-size:0.8rem;
          cursor:pointer;
          transition: background 0.2s;
        ">Send</button>
      </form>
    </div>
  </div>

  <!-- Keyboard Shortcuts Modal -->
  <div class="keyboard-shortcuts-modal" id="shortcuts-modal">
    <div class="shortcuts-content">
      <h2 style="margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between;">
        <span>‚å®Ô∏è Keyboard Shortcuts</span>
        <button class="modal-close" onclick="document.getElementById('shortcuts-modal').classList.remove('show')" aria-label="Close">&times;</button>
      </h2>
      
      <div class="shortcut-item">
        <span>Show this help</span>
        <span class="shortcut-key">?</span>
      </div>
      <div class="shortcut-item">
        <span>Refresh news feed</span>
        <span class="shortcut-key">R</span>
      </div>
      <div class="shortcut-item">
        <span>Read articles aloud</span>
        <span class="shortcut-key">Alt + R</span>
      </div>
      <div class="shortcut-item">
        <span>Stop reading</span>
        <span class="shortcut-key">Alt + S</span>
      </div>
      <div class="shortcut-item">
        <span>View reading stats</span>
        <span class="shortcut-key">S</span>
      </div>
      <div class="shortcut-item">
        <span>Jump to discussions</span>
        <span class="shortcut-key">D</span>
      </div>
      <div class="shortcut-item">
        <span>Print page</span>
        <span class="shortcut-key">Ctrl/Cmd + P</span>
      </div>
      <div class="shortcut-item">
        <span>Filter: All</span>
        <span class="shortcut-key">1</span>
      </div>
      <div class="shortcut-item">
        <span>Filter: Current Affairs</span>
        <span class="shortcut-key">2</span>
      </div>
      <div class="shortcut-item">
        <span>Filter: AI & Tech</span>
        <span class="shortcut-key">3</span>
      </div>
      <div class="shortcut-item">
        <span>Filter: Markets</span>
        <span class="shortcut-key">4</span>
      </div>
      
      <p style="margin-top: 16px; font-size: 0.8rem; color: #78716c; text-align: center;">
        Press <strong>Esc</strong> to close this dialog
      </p>
    </div>
  </div>

  <script>
    // ======================
    // CONFIGURATION
    // ======================
    const CONFIG = {
      FEEDBACK_EMAIL: "mahesh.maheshwarr@gmail.com",
      INITIAL_VISIBLE_COUNT: 8,
      LOAD_MORE_COUNT: 6,
      RSS_API_BASE: "https://api.rss2json.com/v1/api.json?rss_url="
    };

    // RSS Feed URLs
    const RSS_FEEDS = {
      // Existing feeds
      tbi: "https://www.thebetterindia.com/feed/",
      pib: "https://pib.gov.in/rss.aspx",
      rbi: "https://rbi.org.in/Scripts/Rss.aspx",
      ietech: "https://indianexpress.com/section/technology/feed/",
      politics: "https://indianexpress.com/section/india/politics/feed/",
      iesports: "https://indianexpress.com/section/sports/feed/",
      etmarkets: "https://economictimes.indiatimes.com/markets/rssfeeds/1977021501.cms",
      livemint: "https://www.livemint.com/rss/markets",
      moneycontrol: "https://www.moneycontrol.com/rss/MCtopnews.xml",
      autocarindia: "https://www.autocarindia.com/RSS/rss.ashx?type=all",
      
      // Indian News Sources
      thehindu: "https://www.thehindu.com/feeder/default.rss",
      hindustantimes: "https://www.hindustantimes.com/feeds/rss/india-news/rssfeed.xml",
      ndtv: "https://feeds.feedburner.com/ndtvnews-top-stories",
      indiatoday: "https://www.indiatoday.in/rss/1206578",
      toi: "https://timesofindia.indiatimes.com/rssfeedstopstories.cms",
      
      // Technology & Startups
      techcrunch: "https://techcrunch.com/feed/",
      theverge: "https://www.theverge.com/rss/index.xml",
      wired: "https://www.wired.com/feed/rss",
      yourstory: "https://yourstory.com/feed",
      
      // International News
      bbc: "http://feeds.bbci.co.uk/news/rss.xml",
      reuters: "https://www.reutersagency.com/feed/",
      aljazeera: "https://www.aljazeera.com/xml/rss/all.xml",
      
      // Business & Markets
      financialexpress: "https://www.financialexpress.com/feed/",
      businessstandard: "https://www.business-standard.com/rss/home_page_top_stories.rss"
    };

    // ======================
    // STATE MANAGEMENT
    // ======================
    const state = {
      allArticles: [],
      activeCategory: "all",
      activeSource: "all",
      visibleCount: CONFIG.INITIAL_VISIBLE_COUNT
    };

    // ======================
    // UTILITY FUNCTIONS
    // ======================
    function stripHtml(html) {
      if (!html) return "";
      return html.replace(/<[^>]*>/g, "").trim();
    }

    function shortenText(text, maxLen = 220) {
      if (!text) return "";
      const clean = text.trim();
      if (clean.length <= maxLen) return clean;
      const sliced = clean.slice(0, maxLen);
      const lastSpace = sliced.lastIndexOf(" ");
      const trimmed = lastSpace > 120 ? sliced.slice(0, lastSpace) : sliced;
      return trimmed + "‚Ä¶";
    }

    function classifyArticle(article) {
      const text = ((article.title || "") + " " + (article.description || "")).toLowerCase();
      
      if (text.match(/cricket|football|t20|ipl|world cup|olympic/i)) return "sports";
      if (text.match(/sensex|nifty|stock|market|shares|economy|gdp|inflation/i)) return "markets";
      if (text.match(/election|minister|parliament|bill passed|policy|government/i)) return "politics";
      if (text.match(/startup|start-up|funding|valuation|unicorn|series [ab]|venture capital/i)) return "startups";
      if (text.match(/\bai\b|artificial intelligence|machine learning|openai|chatgpt/i)) return "ai";
      if (text.match(/car|automobile|vehicle|\bev\b|electric vehicle|hybrid|suv|bike|two-wheeler/i)) return "automobiles";
      
      return "current";
    }

    function calculatePositivityScore(article) {
      const text = `${article.title || ""} ${article.description || ""}`.toLowerCase();
      let score = 50;

      const positiveWords = [
        "growth", "boost", "record", "success", "wins", "innovation",
        "launch", "expands", "profits", "strong", "positive", "improves",
        "electric", "sustainable", "renewable", "jobs", "breakthrough",
        "milestone", "achievement", "solution"
      ];

      const negativeWords = [
        "crash", "loss", "decline", "cut", "layoff", "drops",
        "scandal", "fraud", "fails", "shutdown", "strike", "crisis",
        "panic", "fear", "plunge", "collapse"
      ];

      positiveWords.forEach(word => {
        if (text.includes(word)) score += 4;
      });

      negativeWords.forEach(word => {
        if (text.includes(word)) score -= 6;
      });

      return Math.max(10, Math.min(90, score));
    }

    function getAgentReason(article) {
      const category = article.category;
      const description = (article.description || "").toLowerCase();
      
      if (category === "sports") return "Highlights human achievement and positive role models.";
      if (category === "automobiles" && description.includes("electric")) 
        return "Signals progress toward sustainable transportation.";
      if (description.includes("recycle") || description.includes("waste")) 
        return "Shows measurable environmental impact.";
      if (category === "startups" || description.includes("innovation")) 
        return "Represents constructive innovation and long-term value creation.";
      if (category === "politics") 
        return "Selected for policy impact rather than conflict or controversy.";
      if (category === "ai") 
        return "Highlights technological progress with practical applications.";
      
      return "Selected to maintain a calm, constructive information diet.";
    }

    function isMainstreamSensational(article) {
      const title = (article.title || "").toLowerCase();
      const sensationalKeywords = [
        "breaking", "urgent", "crash", "panic", "plunge", "fear", 
        "turmoil", "sell-off", "shock", "chaos", "crisis"
      ];
      return sensationalKeywords.some(keyword => title.includes(keyword));
    }

    // ======================
    // DOM CREATION
    // ======================
    function createNewsCard(article) {
      const card = document.createElement("article");
      card.className = "news-card";
      card.dataset.category = article.category;
      card.dataset.source = article.sourceKey;
      card.dataset.articleId = article.url; // For tracking

      const published = article.publishedAt ? 
        new Date(article.publishedAt).toLocaleString("en-IN", {
          day: "2-digit", 
          month: "short", 
          hour: "2-digit", 
          minute: "2-digit"
        }) : "";

      const sourceName = article.source?.name || "News source";
      const title = article.title || "Untitled story";
      const description = shortenText(article.description || "A positive development worth noting today.");
      
      // Generate AI summary (extract key points)
      const summary = generateAISummary(article);

      // Get translations
      const t = translations[currentLanguage].ui;

      card.innerHTML = `
        <div class="news-badges">
          <span class="badge badge--category">${article.category.toUpperCase()}</span>
          <span class="badge badge--positive">Net positive impact</span>
        </div>
        <h3 class="news-title">${title}</h3>
        
        <div class="ai-summary" style="
          margin: 8px 0;
          padding: 10px 12px;
          background: #fff8ed;
          border-left: 3px solid #f97316;
          border-radius: 8px;
          font-size: 0.78rem;
          color: #78716c;
          line-height: 1.5;
        ">
          <strong style="color: #ea580c;">ü§ñ ${t.aiSummary}:</strong> ${summary}
        </div>
        
        <p class="tagline">${description}</p>
        <div class="news-meta-row">
          <div class="news-meta">${published ? `‚è± ${published}` : ""}</div>
        </div>
        <div class="news-footer">
          <span class="source">${t.source}: ${sourceName}</span>
          ${article.url ? `<a class="read-link" href="${article.url}" target="_blank" rel="noopener noreferrer" onclick="trackArticleRead('${article.url}', '${article.category}', '${article.sourceKey}')">${t.readMore} <span>‚Üó</span></a>` : ""}
        </div>
        <div class="agent-reason">
          <strong>üß† ${t.whySelected}</strong><br>
          ${getAgentReason(article)}
        </div>
      `;

      return card;
    }

    // Generate AI Summary from article content
    function generateAISummary(article) {
      const text = (article.description || article.content || "").toLowerCase();
      const title = (article.title || "").toLowerCase();
      
      // Extract key information based on content
      let summary = "";
      
      // Check for numbers/statistics
      const numbers = text.match(/\d+%|\d+\s*(million|billion|thousand|crore|lakh)/gi);
      if (numbers && numbers.length > 0) {
        summary += `Key figures: ${numbers.slice(0, 2).join(", ")}. `;
      }
      
      // Check for key actions/events
      if (text.includes("launch") || text.includes("announce")) {
        summary += "New announcement or launch. ";
      } else if (text.includes("growth") || text.includes("increase") || text.includes("rise")) {
        summary += "Positive growth trend reported. ";
      } else if (text.includes("innovation") || text.includes("breakthrough")) {
        summary += "Innovative development highlighted. ";
      } else if (text.includes("policy") || text.includes("regulation")) {
        summary += "Policy or regulatory update. ";
      } else if (text.includes("win") || text.includes("victory") || text.includes("champion")) {
        summary += "Achievement or victory reported. ";
      }
      
      // Add category-specific context
      const category = article.category;
      if (category === "markets") {
        summary += "Market movement with potential long-term implications.";
      } else if (category === "ai" || category === "startups") {
        summary += "Technology advancement with practical applications.";
      } else if (category === "sports") {
        summary += "Sports achievement showcasing human excellence.";
      } else if (category === "politics") {
        summary += "Policy development with societal impact.";
      } else {
        summary += "Development worth noting for its constructive impact.";
      }
      
      return summary || "A positive development highlighting progress and constructive change.";
    }

    // ======================
    // UI UPDATE FUNCTIONS
    // ======================
    function updateVisibleCards() {
      const cards = Array.from(document.querySelectorAll(".news-card"));
      let shown = 0;

      cards.forEach((card) => {
        const category = card.dataset.category;
        const sourceKey = card.dataset.source;
        const categoryOK = state.activeCategory === "all" || category === state.activeCategory;
        const sourceOK = state.activeSource === "all" || sourceKey === state.activeSource;

        if (categoryOK && sourceOK && shown < state.visibleCount) {
          card.classList.remove("hidden");
          shown++;
        } else {
          card.classList.add("hidden");
        }
      });

      const loadMoreBtn = document.getElementById("load-more-btn");
      if (loadMoreBtn) {
        loadMoreBtn.style.display = shown < cards.length ? "inline-flex" : "none";
      }

      updatePositiveCount();
    }

    function updatePositiveCount() {
      const visibleCards = document.querySelectorAll(".news-card:not(.hidden)");
      const positiveCountEl = document.getElementById("positive-count");
      if (positiveCountEl) {
        positiveCountEl.textContent = `${visibleCards.length} stories`;
      }
    }

    function updatePositivityMeter(percent) {
      const positivityPercentEl = document.getElementById("positivity-percent");
      const positivityBarFillEl = document.getElementById("positivity-bar-fill");
      
      if (!positivityPercentEl || !positivityBarFillEl) return;
      
      const clamped = Math.max(0, Math.min(100, Math.round(percent)));
      positivityPercentEl.textContent = clamped ? `${clamped}% positive` : "‚Äì";
      positivityBarFillEl.style.width = `${clamped}%`;
    }

    function updateAgentNote(articles) {
      const el = document.getElementById("agent-note-text");
      if (!el || !articles || !articles.length) return;

      const categoryStats = {};
      articles.forEach(a => {
        const cat = a.category;
        if (!categoryStats[cat]) {
          categoryStats[cat] = { count: 0, totalScore: 0 };
        }
        categoryStats[cat].count++;
        categoryStats[cat].totalScore += a.aiScore;
      });

      const topCategory = Object.entries(categoryStats)
        .sort((a, b) => b[1].count - a[1].count)[0];

      const [volumeCategory, volumeData] = topCategory;
      const volumePercent = Math.round((volumeData.count / articles.length) * 100);

      el.innerHTML = `
        <div style="display:inline-block;margin-bottom:6px;padding:4px 10px;font-size:0.72rem;border-radius:999px;background:#e0f2fe;color:#0f172a;font-weight:600;">
          ü§ñ Editorial AI ¬∑ Signal-first curation
        </div>
        <div style="margin-top:8px;">
          Today's feed prioritises <strong>durable signal over breaking noise</strong>. 
          <strong>${volumeCategory.toUpperCase()}</strong> dominated headlines (${volumePercent}% of coverage), 
          curated from ${Object.keys(RSS_FEEDS).length} trusted sources.
        </div>
        <div style="margin-top:8px;color:#64748b;font-size:0.78rem;">
          The AI intentionally deprioritised urgency-driven headlines in favour of developments 
          with long-term relevance and constructive impact.
        </div>
      `;
    }

    function updateIgnoredList(articles) {
      const el = document.getElementById("ignored-list");
      if (!el) return;

      const ignored = articles.filter(a => isMainstreamSensational(a)).slice(0, 3);

      if (!ignored.length) {
        el.innerHTML = "<li>No major urgency-driven headlines were prioritised today.</li>";
        return;
      }

      el.innerHTML = ignored.map(a => `
        <li>
          <strong>"${a.title}"</strong><br>
          <em style="font-size:0.75rem;color:#92400e;">Deprioritised due to short-term urgency framing.</em>
        </li>
      `).join("");
    }

    function updateSourcesLabel() {
      const sourcesCountLabel = document.getElementById("sources-count-label");
      if (!sourcesCountLabel) return;
      
      const activeChip = document.querySelector(".source-chip.active");
      if (!activeChip || state.activeSource === "all") {
        sourcesCountLabel.textContent = "All sources (combined)";
      } else {
        sourcesCountLabel.textContent = activeChip.textContent.trim();
      }
    }

    // ======================
    // DATA FETCHING
    // ======================
    async function loadNews() {
      const newsList = document.getElementById("news-list");
      const lastUpdatedEl = document.getElementById("last-updated");
      
      newsList.innerHTML = '<p style="color:#6b7280;font-size:0.8rem;">Fetching positive stories from multiple sources‚Ä¶</p>';

      try {
        // Build fetch promises
        const fetchPromises = Object.entries(RSS_FEEDS).map(([key, url]) => 
          fetch(CONFIG.RSS_API_BASE + encodeURIComponent(url))
            .then(r => r.json())
            .then(data => ({ key, data }))
            .catch(err => {
              console.warn(`Failed to fetch ${key}:`, err);
              return { key, data: null };
            })
        );

        const results = await Promise.all(fetchPromises);
        state.allArticles = [];

        // Process all feeds
        results.forEach(({ key, data }) => {
          if (!data || data.status !== "ok" || !data.items || !data.items.length) {
            return;
          }

          const sourceName = data.feed?.title || "News Source";
          
          data.items.slice(0, 6).forEach(item => {
            const article = {
              title: item.title,
              description: stripHtml(item.description),
              content: stripHtml(item.content),
              url: item.link,
              publishedAt: item.pubDate,
              source: { name: sourceName },
              sourceKey: key,
              category: null,
              aiScore: 0
            };

            // Classify and score
            article.category = classifyArticle(article);
            article.aiScore = calculatePositivityScore(article);

            state.allArticles.push(article);
          });
        });

        if (!state.allArticles.length) {
          newsList.innerHTML = '<p style="color:#6b7280;font-size:0.8rem;">No stories found. Please try again later.</p>';
          if (lastUpdatedEl) lastUpdatedEl.textContent = "No stories available";
          return;
        }

        // Sort by positivity score
        state.allArticles.sort((a, b) => b.aiScore - a.aiScore);

        // Apply AI curation if enabled
        if (typeof applyAICuration === 'function') {
          state.allArticles = applyAICuration(state.allArticles);
        }

        // Cache articles for offline access
        cacheArticles(state.allArticles);

        // Calculate positivity meter
        const positiveCount = state.allArticles.filter(a => a.aiScore > 50).length;
        const positivityPercent = (positiveCount * 100) / state.allArticles.length;
        updatePositivityMeter(positivityPercent);

        // Render cards
        newsList.innerHTML = "";
        state.allArticles.forEach(article => {
          const card = createNewsCard(article);
          newsList.appendChild(card);
        });

        // Reset visibility
        state.visibleCount = CONFIG.INITIAL_VISIBLE_COUNT;
        updateVisibleCards();

        // Update UI elements
        if (lastUpdatedEl) {
          lastUpdatedEl.textContent = `Updated ${new Date().toLocaleTimeString("en-IN", { 
            hour: "2-digit", 
            minute: "2-digit" 
          })}`;
        }

        updateAgentNote(state.allArticles);
        updateIgnoredList(state.allArticles);

        // Load multimedia content
        loadMultimediaContent(state.allArticles);

      } catch (error) {
        console.error("Error loading news:", error);
        newsList.innerHTML = '<p style="color:#b91c1c;font-size:0.8rem;">Network error while loading stories. Please try again.</p>';
        if (lastUpdatedEl) lastUpdatedEl.textContent = "Error fetching headlines";
      }
    }

    // ======================
    // CHAT FUNCTIONALITY
    // ======================
    function fallbackChatAnswer(question, articles) {
      const q = question.toLowerCase();

      if (q.includes("today") || q.includes("news") || q.includes("headlines")) {
        const top = articles.slice(0, 5);
        return "Here's a quick snapshot of today's positive news:\n\n" +
          top.map((a, i) => `${i + 1}. ${a.title}`).join("\n");
      }

      if (q.includes("politics")) {
        const politics = articles.filter(a => a.category === "politics").slice(0, 3);
        if (!politics.length) {
          return "There aren't many major political stories in today's positive feed.";
        }
        return "Today's political highlights:\n\n" +
          politics.map(a => `‚Ä¢ ${a.title}`).join("\n");
      }

      if (q.includes("sports")) {
        const sports = articles.filter(a => a.category === "sports").slice(0, 3);
        if (!sports.length) {
          return "No major sports stories in today's feed.";
        }
        return "Sports highlights today:\n\n" +
          sports.map(a => `‚Ä¢ ${a.title}`).join("\n");
      }

      if (q.includes("ai") || q.includes("tech") || q.includes("technology")) {
        const tech = articles.filter(a => a.category === "ai").slice(0, 3);
        if (!tech.length) {
          return "No major AI/tech stories highlighted today.";
        }
        return "AI and technology highlights:\n\n" +
          tech.map(a => `‚Ä¢ ${a.title}`).join("\n");
      }

      if (q.includes("market") || q.includes("stock") || q.includes("economy")) {
        const markets = articles.filter(a => a.category === "markets").slice(0, 3);
        if (!markets.length) {
          return "No major market stories in today's feed.";
        }
        return "Market highlights:\n\n" +
          markets.map(a => `‚Ä¢ ${a.title}`).join("\n");
      }

      if (q.includes("automobile") || q.includes("car") || q.includes("vehicle")) {
        const auto = articles.filter(a => a.category === "automobiles").slice(0, 3);
        if (!auto.length) {
          return "No automobile stories highlighted today.";
        }
        return "Automobile highlights:\n\n" +
          auto.map(a => `‚Ä¢ ${a.title}`).join("\n");
      }

      return "I can help summarise today's news by topic ‚Äî try asking about politics, sports, markets, AI/tech, or today's highlights.";
    }

    function addChatBubble(text, from = "user") {
      const chatMessages = document.getElementById("chat-messages");
      const bubble = document.createElement("div");
      
      bubble.style.maxWidth = "90%";
      bubble.style.padding = "8px 10px";
      bubble.style.borderRadius = "12px";
      bubble.style.fontSize = "0.8rem";
      bubble.style.lineHeight = "1.4";

      if (from === "user") {
        bubble.style.alignSelf = "flex-end";
        bubble.style.background = "#38bdf8";
        bubble.style.color = "#020617";
      } else {
        bubble.style.alignSelf = "flex-start";
        bubble.style.background = "#e5e7eb";
        bubble.style.color = "#111827";
      }

      bubble.textContent = text;
      chatMessages.appendChild(bubble);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function setupChatWidget() {
      const chatWidget = document.getElementById("chat-widget");
      const chatBody = document.getElementById("chat-body");
      const chatToggle = document.getElementById("chat-toggle");
      const chatHeader = document.getElementById("chat-header");
      const chatForm = document.getElementById("chat-form");
      const chatInput = document.getElementById("chat-input");

      // Toggle chat on button click
      chatToggle.addEventListener("click", (e) => {
        e.stopPropagation();
        const isHidden = chatBody.style.display === "none";
        chatBody.style.display = isHidden ? "flex" : "none";
        chatToggle.textContent = isHidden ? "‚àí" : "+";
      });

      // Toggle on header click (except button)
      chatHeader.addEventListener("click", (e) => {
        if (e.target !== chatToggle && !chatToggle.contains(e.target)) {
          const isHidden = chatBody.style.display === "none";
          chatBody.style.display = isHidden ? "flex" : "none";
          chatToggle.textContent = isHidden ? "‚àí" : "+";
        }
      });

      // Handle chat form submission
      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const question = chatInput.value.trim();
        if (!question) return;

        addChatBubble(question, "user");
        chatInput.value = "";

        // Add thinking indicator
        const chatMessages = document.getElementById("chat-messages");
        const thinking = document.createElement("div");
        thinking.style.alignSelf = "flex-start";
        thinking.style.maxWidth = "90%";
        thinking.style.padding = "8px 10px";
        thinking.style.borderRadius = "12px";
        thinking.style.background = "#e5e7eb";
        thinking.style.color = "#6b7280";
        thinking.style.fontSize = "0.8rem";
        thinking.textContent = "Thinking...";
        chatMessages.appendChild(thinking);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // Simulate thinking delay
        await new Promise(resolve => setTimeout(resolve, 500));

        thinking.remove();
        const answer = fallbackChatAnswer(question, state.allArticles);
        addChatBubble(answer, "bot");
      });

      // Hover effect on toggle button
      chatToggle.addEventListener("mouseenter", () => {
        chatToggle.style.background = "#f3f4f6";
      });
      chatToggle.addEventListener("mouseleave", () => {
        chatToggle.style.background = "none";
      });
    }

    // ======================
    // EVENT HANDLERS
    // ======================
    function setupEventListeners() {
      // Category filters
      const categoryChips = document.querySelectorAll(".filter-chip[data-filter]");
      categoryChips.forEach(chip => {
        chip.addEventListener("click", () => {
          const filter = chip.getAttribute("data-filter");
          state.activeCategory = filter || "all";
          state.visibleCount = CONFIG.INITIAL_VISIBLE_COUNT;
          
          categoryChips.forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          
          updateVisibleCards();
        });
      });

      // Source filters
      const sourceChips = document.querySelectorAll(".source-chip[data-source]");
      sourceChips.forEach(chip => {
        chip.addEventListener("click", () => {
          const source = chip.getAttribute("data-source");
          state.activeSource = source || "all";
          state.visibleCount = CONFIG.INITIAL_VISIBLE_COUNT;
          
          sourceChips.forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          
          updateSourcesLabel();
          updateVisibleCards();
        });
      });

      // Refresh button
      const refreshBtn = document.getElementById("refresh-btn");
      if (refreshBtn) {
        refreshBtn.addEventListener("click", () => {
          const lastUpdatedEl = document.getElementById("last-updated");
          if (lastUpdatedEl) lastUpdatedEl.textContent = "Refreshing now‚Ä¶";
          state.visibleCount = CONFIG.INITIAL_VISIBLE_COUNT;
          loadNews();
        });
      }

      // Load more button
      const loadMoreBtn = document.getElementById("load-more-btn");
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener("click", () => {
          state.visibleCount += CONFIG.LOAD_MORE_COUNT;
          updateVisibleCards();
        });
      }

      // Feedback form
      const feedbackForm = document.getElementById("feedback-form");
      if (feedbackForm) {
        feedbackForm.addEventListener("submit", (e) => {
          e.preventDefault();
          
          const name = document.getElementById("feedback-name").value.trim();
          const feedback = document.getElementById("feedback-text").value.trim();
          const statusEl = document.getElementById("feedback-status");

          if (!feedback) {
            statusEl.textContent = "Please add a quick note before sending.";
            statusEl.className = "feedback-status error";
            return;
          }

          const subject = encodeURIComponent("Feedback on Mahesh positive news feed");
          const bodyLines = [
            `Name: ${name || "(not provided)"}`,
            "",
            "Feedback:",
            feedback,
            "",
            "---",
            "Sent from Mahesh Positive News Feed"
          ];
          const body = encodeURIComponent(bodyLines.join("\n"));
          
          window.location.href = `mailto:${CONFIG.FEEDBACK_EMAIL}?subject=${subject}&body=${body}`;

          statusEl.textContent = "Opening your email client‚Ä¶";
          statusEl.className = "feedback-status success";
          
          setTimeout(() => {
            document.getElementById("feedback-name").value = "";
            document.getElementById("feedback-text").value = "";
            statusEl.textContent = "Thank you for your feedback!";
          }, 1500);
        });
      }

      // Modal handlers
      const privacyLink = document.getElementById("privacy-link");
      const termsLink = document.getElementById("terms-link");
      const privacyModal = document.getElementById("privacy-modal");
      const termsModal = document.getElementById("terms-modal");

      if (privacyLink && privacyModal) {
        privacyLink.addEventListener("click", (e) => {
          e.preventDefault();
          privacyModal.classList.add("show");
        });
      }

      if (termsLink && termsModal) {
        termsLink.addEventListener("click", (e) => {
          e.preventDefault();
          termsModal.classList.add("show");
        });
      }

      // Close buttons for modals
      document.querySelectorAll(".modal-close").forEach(btn => {
        btn.addEventListener("click", () => {
          btn.closest(".modal").classList.remove("show");
        });
      });

      // Click outside to close modals
      document.querySelectorAll(".modal").forEach(modal => {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.classList.remove("show");
          }
        });
      });

      // Copyright year
      const copyEl = document.getElementById("copyright-year");
      if (copyEl) {
        copyEl.textContent = new Date().getFullYear();
      }
    }

    // ======================
    // MULTIMEDIA CONTENT
    // ======================
    function switchMultimediaTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.multimedia-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.closest('.multimedia-tab').classList.add('active');

      // Update content sections
      document.querySelectorAll('.multimedia-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`${tabName}-content`).classList.add('active');
    }

    function loadMultimediaContent(articles) {
      loadImageGallery(articles);
      loadVideoNews();
      loadPodcasts();
      loadInfographics();
    }

    function loadImageGallery(articles) {
      const galleryGrid = document.getElementById('gallery-grid');
      
      // Filter articles with images
      const articlesWithImages = articles.filter(a => {
        // Check if article has image in content or use placeholder
        return true; // We'll show all articles with generated images
      }).slice(0, 12);

      if (articlesWithImages.length === 0) {
        galleryGrid.innerHTML = '<p style="color: #78716c; font-size: 0.85rem;">No images available at the moment.</p>';
        return;
      }

      galleryGrid.innerHTML = articlesWithImages.map(article => {
        // Generate a placeholder image URL based on category
        const imageUrl = getPlaceholderImage(article.category);
        
        return `
          <div class="gallery-item" onclick="window.open('${article.url}', '_blank')">
            <img src="${imageUrl}" alt="${article.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/400x300/f97316/ffffff?text=News+Image'">
            <div class="gallery-item-content">
              <div class="gallery-item-title">${shortenText(article.title, 80)}</div>
              <div class="gallery-item-source">${article.source?.name || 'News Source'}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function getPlaceholderImage(category) {
      const images = {
        sports: 'https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400&h=300&fit=crop',
        markets: 'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=400&h=300&fit=crop',
        ai: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=400&h=300&fit=crop',
        automobiles: 'https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?w=400&h=300&fit=crop',
        politics: 'https://images.unsplash.com/photo-1529107386315-e1a2ed48a620?w=400&h=300&fit=crop',
        startups: 'https://images.unsplash.com/photo-1559136555-9303baea8ebd?w=400&h=300&fit=crop',
        current: 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=300&fit=crop'
      };
      return images[category] || images.current;
    }

    function loadVideoNews() {
      const videoGrid = document.getElementById('video-grid');
      
      // Curated news video channels and recent videos
      const newsVideos = [
        {
          id: 'dQw4w9WgXcQ', // Replace with actual news video IDs
          title: 'BBC News: Today\'s Top Stories',
          channel: 'BBC News'
        },
        {
          id: 'jNQXAC9IVRw', // Replace with actual news video IDs
          title: 'Tech News Roundup',
          channel: 'TechCrunch'
        },
        {
          id: 'y6120QOlsfU', // Replace with actual news video IDs
          title: 'Market Analysis Today',
          channel: 'Financial Times'
        },
        {
          id: 'dQw4w9WgXcQ', // Replace with actual news video IDs
          title: 'AI Developments This Week',
          channel: 'MIT Technology Review'
        }
      ];

      videoGrid.innerHTML = newsVideos.map(video => `
        <div class="video-item">
          <iframe 
            src="https://www.youtube.com/embed/${video.id}" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen
            loading="lazy">
          </iframe>
          <div class="video-item-content">
            <div class="gallery-item-title">${video.title}</div>
            <div class="gallery-item-source">${video.channel}</div>
          </div>
        </div>
      `).join('');
    }

    function loadPodcasts() {
      const podcastList = document.getElementById('podcast-list');
      
      // Curated news podcasts
      const podcasts = [
        {
          title: 'The Daily - New York Times',
          description: 'Today\'s biggest stories in 20 minutes',
          duration: '20 min',
          url: 'https://www.nytimes.com/column/the-daily'
        },
        {
          title: 'Up First - NPR',
          description: 'Morning news briefing',
          duration: '15 min',
          url: 'https://www.npr.org/podcasts/510318/up-first'
        },
        {
          title: 'Today in Focus - The Guardian',
          description: 'Deep dive into the day\'s news',
          duration: '25 min',
          url: 'https://www.theguardian.com/news/series/todayinfocus'
        },
        {
          title: 'Tech News Briefing - WSJ',
          description: 'Latest in technology',
          duration: '10 min',
          url: 'https://www.wsj.com/podcasts/tech-news-briefing'
        },
        {
          title: 'The Intelligence - The Economist',
          description: 'Global news analysis',
          duration: '22 min',
          url: 'https://www.economist.com/podcasts'
        }
      ];

      podcastList.innerHTML = podcasts.map(podcast => `
        <div class="podcast-item" onclick="window.open('${podcast.url}', '_blank')">
          <div class="podcast-icon">üéôÔ∏è</div>
          <div class="podcast-info">
            <div class="podcast-title">${podcast.title}</div>
            <div class="podcast-meta">${podcast.description} ‚Ä¢ ${podcast.duration}</div>
          </div>
          <button style="
            padding: 6px 12px;
            background: #f97316;
            color: #ffffff;
            border: none;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
          ">Listen</button>
        </div>
      `).join('');
    }

    function loadInfographics() {
      const infographicGrid = document.getElementById('infographic-grid');
      
      // Sample infographics (in production, these would come from your data sources)
      const infographics = [
        {
          title: 'Global AI Investment Trends 2025',
          image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=300&fit=crop',
          source: 'Visual Capitalist'
        },
        {
          title: 'Climate Change Impact by Region',
          image: 'https://images.unsplash.com/photo-1569163139394-de4798aa62b6?w=400&h=300&fit=crop',
          source: 'Our World in Data'
        },
        {
          title: 'Stock Market Performance YTD',
          image: 'https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?w=400&h=300&fit=crop',
          source: 'Financial Times'
        },
        {
          title: 'Tech Startup Funding Landscape',
          image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400&h=300&fit=crop',
          source: 'CB Insights'
        },
        {
          title: 'Renewable Energy Growth',
          image: 'https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=400&h=300&fit=crop',
          source: 'IEA'
        },
        {
          title: 'Global Trade Routes 2025',
          image: 'https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=400&h=300&fit=crop',
          source: 'World Bank'
        }
      ];

      infographicGrid.innerHTML = infographics.map(infographic => `
        <div class="infographic-item">
          <img src="${infographic.image}" alt="${infographic.title}" loading="lazy">
          <div class="infographic-item-content">
            <div class="gallery-item-title">${infographic.title}</div>
            <div class="gallery-item-source">${infographic.source}</div>
          </div>
        </div>
      `).join('');
    }

    // Make function globally accessible
    window.switchMultimediaTab = switchMultimediaTab;

    // ======================
    // INITIALIZATION
    // ======================
    document.addEventListener("DOMContentLoaded", () => {
      setupEventListeners();
      setupChatWidget();
      setupLanguageSelector();
      loadNews();
      initReadingStats();
      updateStatsDisplay();
      
      // Setup lazy loading after content loads
      setTimeout(setupLazyLoading, 1000);
    });

    // ======================
    // READING STATS TRACKING
    // ======================
    function initReadingStats() {
      // Initialize stats in localStorage if not exists
      if (!localStorage.getItem('readingStats')) {
        const initialStats = {
          totalRead: 0,
          readToday: 0,
          readThisWeek: 0,
          lastReadDate: null,
          streak: 0,
          categoryBreakdown: {},
          sourceBreakdown: {},
          readArticles: []
        };
        localStorage.setItem('readingStats', JSON.stringify(initialStats));
      }
      
      // Check if we need to reset daily/weekly counters
      checkAndResetCounters();
    }

    function checkAndResetCounters() {
      const stats = JSON.parse(localStorage.getItem('readingStats'));
      const today = new Date().toDateString();
      const lastRead = stats.lastReadDate ? new Date(stats.lastReadDate).toDateString() : null;
      
      // Reset daily counter if it's a new day
      if (lastRead !== today) {
        stats.readToday = 0;
        
        // Update streak
        if (lastRead) {
          const lastReadDate = new Date(lastRead);
          const todayDate = new Date(today);
          const diffDays = Math.floor((todayDate - lastReadDate) / (1000 * 60 * 60 * 24));
          
          if (diffDays === 1) {
            // Consecutive day - increment streak
            stats.streak += 1;
          } else if (diffDays > 1) {
            // Missed days - reset streak
            stats.streak = 0;
          }
        }
      }
      
      // Reset weekly counter if it's a new week
      const weekStart = getWeekStart(new Date());
      const lastWeekStart = stats.lastReadDate ? getWeekStart(new Date(stats.lastReadDate)) : null;
      if (!lastWeekStart || weekStart.getTime() !== lastWeekStart.getTime()) {
        stats.readThisWeek = 0;
      }
      
      localStorage.setItem('readingStats', JSON.stringify(stats));
    }

    function getWeekStart(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - day;
      return new Date(d.setDate(diff));
    }

    function trackArticleRead(url, category, source) {
      const stats = JSON.parse(localStorage.getItem('readingStats'));
      
      // Check if already read
      if (stats.readArticles.includes(url)) {
        return;
      }
      
      // Update counters
      stats.totalRead += 1;
      stats.readToday += 1;
      stats.readThisWeek += 1;
      stats.lastReadDate = new Date().toISOString();
      stats.readArticles.push(url);
      
      // Update category breakdown
      stats.categoryBreakdown[category] = (stats.categoryBreakdown[category] || 0) + 1;
      
      // Update source breakdown
      stats.sourceBreakdown[source] = (stats.sourceBreakdown[source] || 0) + 1;
      
      // Keep only last 100 articles to prevent storage bloat
      if (stats.readArticles.length > 100) {
        stats.readArticles = stats.readArticles.slice(-100);
      }
      
      localStorage.setItem('readingStats', JSON.stringify(stats));
      updateStatsDisplay();
    }

    function updateStatsDisplay() {
      const stats = JSON.parse(localStorage.getItem('readingStats'));
      
      // Update sidebar stats
      document.getElementById('articles-read-today').textContent = stats.readToday;
      document.getElementById('articles-read-week').textContent = stats.readThisWeek;
      document.getElementById('reading-streak').textContent = `${stats.streak} days`;
      
      // Find favorite category
      const categories = Object.entries(stats.categoryBreakdown);
      if (categories.length > 0) {
        const favorite = categories.sort((a, b) => b[1] - a[1])[0];
        document.getElementById('favorite-category').textContent = favorite[0].toUpperCase();
      } else {
        document.getElementById('favorite-category').textContent = '‚Äî';
      }
    }

    function showStatsModal() {
      const stats = JSON.parse(localStorage.getItem('readingStats'));
      const modal = document.getElementById('stats-modal');
      
      // Update modal stats
      document.getElementById('modal-total-read').textContent = stats.totalRead;
      document.getElementById('modal-week-read').textContent = stats.readThisWeek;
      document.getElementById('modal-streak').textContent = stats.streak;
      
      // Category breakdown
      const categoryDiv = document.getElementById('category-breakdown');
      const categories = Object.entries(stats.categoryBreakdown).sort((a, b) => b[1] - a[1]);
      
      if (categories.length > 0) {
        categoryDiv.innerHTML = categories.map(([cat, count]) => {
          const percentage = Math.round((count / stats.totalRead) * 100);
          return `
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="flex: 1; font-size: 0.8rem; color: #292524; text-transform: capitalize;">${cat}</div>
              <div style="flex: 2; background: #fed7aa; height: 8px; border-radius: 999px; overflow: hidden;">
                <div style="width: ${percentage}%; height: 100%; background: linear-gradient(to right, #f97316, #ea580c);"></div>
              </div>
              <div style="font-size: 0.75rem; color: #78716c; min-width: 50px; text-align: right;">${count} (${percentage}%)</div>
            </div>
          `;
        }).join('');
      } else {
        categoryDiv.innerHTML = '<p style="font-size: 0.8rem; color: #78716c;">No articles read yet. Start reading to see your stats!</p>';
      }
      
      // Source breakdown
      const sourceDiv = document.getElementById('source-breakdown');
      const sources = Object.entries(stats.sourceBreakdown).sort((a, b) => b[1] - a[1]).slice(0, 5);
      
      if (sources.length > 0) {
        sourceDiv.innerHTML = sources.map(([source, count]) => {
          const percentage = Math.round((count / stats.totalRead) * 100);
          return `
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="flex: 1; font-size: 0.8rem; color: #292524; text-transform: uppercase;">${source}</div>
              <div style="flex: 2; background: #fed7aa; height: 8px; border-radius: 999px; overflow: hidden;">
                <div style="width: ${percentage}%; height: 100%; background: linear-gradient(to right, #f97316, #ea580c);"></div>
              </div>
              <div style="font-size: 0.75rem; color: #78716c; min-width: 50px; text-align: right;">${count} (${percentage}%)</div>
            </div>
          `;
        }).join('');
      } else {
        sourceDiv.innerHTML = '<p style="font-size: 0.8rem; color: #78716c;">No articles read yet.</p>';
      }
      
      // Generate insight
      const insightEl = document.getElementById('reading-insight');
      if (stats.totalRead === 0) {
        insightEl.textContent = "Start reading to unlock personalized insights!";
      } else if (stats.streak >= 7) {
        insightEl.textContent = `Amazing! You've maintained a ${stats.streak}-day reading streak. Keep it up!`;
      } else if (stats.readThisWeek >= 10) {
        insightEl.textContent = "You're an active reader this week! Great job staying informed.";
      } else if (categories.length > 0) {
        const topCat = categories[0][0];
        insightEl.textContent = `You seem to enjoy ${topCat} news. Try exploring other categories for diverse perspectives!`;
      } else {
        insightEl.textContent = "Keep reading to discover your reading patterns and preferences!";
      }
      
      modal.classList.add('show');
    }

    function resetStats() {
      if (confirm('Are you sure you want to reset all reading statistics? This cannot be undone.')) {
        const initialStats = {
          totalRead: 0,
          readToday: 0,
          readThisWeek: 0,
          lastReadDate: null,
          streak: 0,
          categoryBreakdown: {},
          sourceBreakdown: {},
          readArticles: []
        };
        localStorage.setItem('readingStats', JSON.stringify(initialStats));
        updateStatsDisplay();
        document.getElementById('stats-modal').classList.remove('show');
        alert('Statistics have been reset!');
      }
    }

    // Make functions globally accessible
    window.showStatsModal = showStatsModal;
    window.resetStats = resetStats;
    window.trackArticleRead = trackArticleRead;

    // ======================
    // MULTI-LANGUAGE SUPPORT
    // ======================
    const translations = {
      en: {
        name: 'English',
        flag: 'üá¨üáß',
        ui: {
          todaysHighlights: "Today's Highlights",
          readMore: "Read",
          source: "Source",
          aiSummary: "AI Summary",
          whySelected: "Why the AI selected this"
        }
      },
      hi: {
        name: '‡§π‡§ø‡§Ç‡§¶‡•Ä',
        flag: 'üáÆüá≥',
        ui: {
          todaysHighlights: "‡§Ü‡§ú ‡§ï‡•Ä ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§¨‡§æ‡§§‡•á‡§Ç",
          readMore: "‡§™‡§¢‡§º‡•á‡§Ç",
          source: "‡§∏‡•ç‡§∞‡•ã‡§§",
          aiSummary: "‡§è‡§Ü‡§à ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂",
          whySelected: "‡§è‡§Ü‡§à ‡§®‡•á ‡§á‡§∏‡•á ‡§ï‡•ç‡§Ø‡•ã‡§Ç ‡§ö‡•Å‡§®‡§æ"
        }
      },
      ta: {
        name: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç',
        flag: 'üáÆüá≥',
        ui: {
          todaysHighlights: "‡Æá‡Æ©‡Øç‡Æ±‡Øà‡ÆØ ‡Æö‡Æø‡Æ±‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",
          readMore: "‡Æ™‡Æü‡Æø‡Æï‡Øç‡Æï",
          source: "‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç",
          aiSummary: "AI ‡Æö‡ØÅ‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ÆÆ‡Øç",
          whySelected: "AI ‡Æá‡Æ§‡Øà ‡Æè‡Æ©‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ§‡ØÅ"
        }
      },
      te: {
        name: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å',
        flag: 'üáÆüá≥',
        ui: {
          todaysHighlights: "‡∞®‡±á‡∞ü‡∞ø ‡∞Æ‡±Å‡∞ñ‡±ç‡∞Ø‡∞æ‡∞Ç‡∞∂‡∞æ‡∞≤‡±Å",
          readMore: "‡∞ö‡∞¶‡∞µ‡∞Ç‡∞°‡∞ø",
          source: "‡∞Æ‡±Ç‡∞≤‡∞Ç",
          aiSummary: "AI ‡∞∏‡∞æ‡∞∞‡∞æ‡∞Ç‡∞∂‡∞Ç",
          whySelected: "AI ‡∞¶‡±Ä‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞Ç‡∞¶‡±Å‡∞ï‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±Å‡∞Ç‡∞¶‡∞ø"
        }
      },
      kn: {
        name: '‡≤ï‡≤®‡≥ç‡≤®‡≤°',
        flag: 'üáÆüá≥',
        ui: {
          todaysHighlights: "‡≤á‡≤Ç‡≤¶‡≤ø‡≤® ‡≤Æ‡≥Å‡≤ñ‡≥ç‡≤Ø‡≤æ‡≤Ç‡≤∂‡≤ó‡≤≥‡≥Å",
          readMore: "‡≤ì‡≤¶‡≤ø",
          source: "‡≤Æ‡≥Ç‡≤≤",
          aiSummary: "AI ‡≤∏‡≤æ‡≤∞‡≤æ‡≤Ç‡≤∂",
          whySelected: "AI ‡≤á‡≤¶‡≤®‡≥ç‡≤®‡≥Å ‡≤è‡≤ï‡≥Ü ‡≤Ü‡≤Ø‡≥ç‡≤ï‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶‡≥Ü"
        }
      },
      ml: {
        name: '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç',
        flag: 'üáÆüá≥',
        ui: {
          todaysHighlights: "‡¥á‡¥®‡µç‡¥®‡¥§‡µç‡¥§‡µÜ ‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥® ‡¥µ‡¥æ‡µº‡¥§‡µç‡¥§‡¥ï‡µæ",
          readMore: "‡¥µ‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï",
          source: "‡¥â‡¥±‡¥µ‡¥ø‡¥ü‡¥Ç",
          aiSummary: "AI ‡¥∏‡¥Ç‡¥ó‡µç‡¥∞‡¥π‡¥Ç",
          whySelected: "AI ‡¥á‡¥§‡µç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥§‡µç‡¥§‡¥§‡µç ‡¥é‡¥®‡µç‡¥§‡µÅ‡¥ï‡µä‡¥£‡µç‡¥ü‡µç"
        }
      }
    };

    let currentLanguage = localStorage.getItem('preferredLanguage') || 'en';

    // Auto-detect browser language
    function detectLanguage() {
      const browserLang = navigator.language || navigator.userLanguage;
      const langCode = browserLang.split('-')[0];
      if (translations[langCode]) {
        return langCode;
      }
      return 'en';
    }

    // Initialize language
    if (!localStorage.getItem('preferredLanguage')) {
      currentLanguage = detectLanguage();
      localStorage.setItem('preferredLanguage', currentLanguage);
    }

    // Setup language selector
    function setupLanguageSelector() {
      const languageBtn = document.getElementById('language-btn');
      const languageDropdown = document.getElementById('language-dropdown');
      const languageOptions = document.querySelectorAll('.language-option');

      if (!languageBtn) return;

      // Update current language display
      updateLanguageDisplay();

      // Toggle dropdown
      languageBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        languageDropdown.classList.toggle('show');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', () => {
        languageDropdown.classList.remove('show');
      });

      // Language selection
      languageOptions.forEach(option => {
        option.addEventListener('click', () => {
          const lang = option.getAttribute('data-lang');
          changeLanguage(lang);
          languageDropdown.classList.remove('show');
        });
      });
    }

    function updateLanguageDisplay() {
      const currentLangFlag = document.getElementById('current-language-flag');
      const currentLangText = document.getElementById('current-language-text');
      
      if (currentLangFlag && currentLangText && translations[currentLanguage]) {
        currentLangFlag.textContent = translations[currentLanguage].flag;
        currentLangText.textContent = translations[currentLanguage].name;
      }

      // Update active state
      document.querySelectorAll('.language-option').forEach(option => {
        if (option.getAttribute('data-lang') === currentLanguage) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }

    async function changeLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('preferredLanguage', lang);
      updateLanguageDisplay();
      updateUITranslations();
      
      // Show loading indicator
      const newsList = document.getElementById('news-list');
      if (newsList) {
        newsList.innerHTML = '<div style="text-align:center;padding:20px;"><div class="loading-spinner"></div><p style="margin-top:10px;color:#78716c;">Translating articles...</p></div>';
      }

      // Reload news with translation
      await loadNews();
    }

    function updateUITranslations() {
      const t = translations[currentLanguage].ui;
      
      // Update section titles
      const sectionTitle = document.querySelector('.section-title h2');
      if (sectionTitle) {
        sectionTitle.textContent = t.todaysHighlights;
      }

      // Note: News cards will be recreated by loadNews() which is called after this function
      // So we don't need to update individual card elements here
    }

    // Translate text using browser's built-in translation or fallback
    async function translateText(text, targetLang) {
      if (targetLang === 'en' || !text) return text;

      // In production, use Google Translate API or similar
      // For now, return original text with a note
      // You can integrate with: https://cloud.google.com/translate
      
      return text; // Placeholder - integrate translation API here
    }

    // ======================
    // PERFORMANCE OPTIMIZATIONS
    // ======================
    
    // Lazy load images with Intersection Observer
    function setupLazyLoading() {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.removeAttribute('data-src');
              observer.unobserve(img);
            }
          }
        });
      }, {
        rootMargin: '50px'
      });

      // Observe all images with data-src
      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }

    // Cache articles in localStorage for offline access
    function cacheArticles(articles) {
      try {
        const cache = {
          articles: articles.slice(0, 20), // Cache first 20 articles
          timestamp: Date.now(),
          language: currentLanguage
        };
        localStorage.setItem('cachedArticles', JSON.stringify(cache));
      } catch (e) {
        console.warn('Failed to cache articles:', e);
      }
    }

    function getCachedArticles() {
      try {
        const cache = JSON.parse(localStorage.getItem('cachedArticles'));
        if (cache && cache.language === currentLanguage) {
          const age = Date.now() - cache.timestamp;
          // Cache valid for 1 hour
          if (age < 3600000) {
            return cache.articles;
          }
        }
      } catch (e) {
        console.warn('Failed to get cached articles:', e);
      }
      return null;
    }

    // ======================
    // PREMIUM FEATURES
    // ======================
    window.showPremiumModal = function() {
      document.getElementById('premium-modal').classList.add('show');
    };

    // Premium waitlist form
    const premiumForm = document.getElementById('premium-waitlist-form');
    if (premiumForm) {
      premiumForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('premium-email').value;
        const statusEl = document.getElementById('premium-waitlist-status');
        
        // Store in localStorage (in production, send to backend)
        const waitlist = JSON.parse(localStorage.getItem('premiumWaitlist') || '[]');
        if (!waitlist.includes(email)) {
          waitlist.push(email);
          localStorage.setItem('premiumWaitlist', JSON.stringify(waitlist));
        }
        
        statusEl.innerHTML = '<span style="color: #15803d;">‚úÖ You\'re on the list! We\'ll notify you when Premium launches.</span>';
        document.getElementById('premium-email').value = '';
        
        setTimeout(() => {
          document.getElementById('premium-modal').classList.remove('show');
          statusEl.innerHTML = '';
        }, 3000);
      });
    }

    // ======================
    // TRIGGER INSTALL FUNCTION
    // ======================
    window.triggerInstall = function() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
          }
          deferredPrompt = null;
        });
      } else {
        // Show manual install instructions
        showInstallInstructions();
      }
    };

    function showInstallInstructions() {
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      const isAndroid = /Android/i.test(navigator.userAgent);
      
      let message = '';
      
      if (isIOS) {
        message = `To install on iPhone/iPad:\n\n1. Tap the Share button (‚¨ÜÔ∏è) at the bottom\n2. Scroll and tap "Add to Home Screen"\n3. Tap "Add"\n\nThe app will appear on your home screen!`;
      } else if (isAndroid) {
        message = `To install on Android:\n\n1. Tap the menu (‚ãÆ) in your browser\n2. Select "Install app" or "Add to Home screen"\n3. Tap "Install"\n\nThe app will appear on your home screen!`;
      } else {
        message = `To install on Desktop:\n\n1. Look for the install icon (‚äï) in the address bar\n2. Click it and select "Install"\n\nOr:\n1. Click the menu (‚ãÆ) in your browser\n2. Select "Install Mahesh +ve Pill..."\n\nThe app will open in its own window!`;
      }
      
      alert(message);
    }

    // ======================
    // PWA INSTALLATION
    // ======================
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // Show install button in nav
      const installBtn = document.getElementById('pwa-install-btn');
      if (installBtn) {
        installBtn.style.display = 'inline-block';
        installBtn.addEventListener('click', async () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response: ${outcome}`);
            if (outcome === 'accepted') {
              installBtn.style.display = 'none';
            }
            deferredPrompt = null;
          }
        });
      }
      
      // Show install prompt banner
      showInstallPrompt();
    });

    function showInstallPrompt() {
      // Create install banner
      const banner = document.createElement('div');
      banner.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        max-width: 400px;
        margin: 0 auto;
        padding: 16px;
        background: linear-gradient(135deg, #f97316, #ea580c);
        color: white;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(249, 115, 22, 0.4);
        z-index: 9999;
        display: flex;
        align-items: center;
        gap: 12px;
      `;
      
      banner.innerHTML = `
        <span style="font-size: 1.5rem;">üì±</span>
        <div style="flex: 1;">
          <div style="font-weight: 600; margin-bottom: 4px;">Install App</div>
          <div style="font-size: 0.8rem; opacity: 0.9;">Get offline access and notifications</div>
        </div>
        <button id="install-btn" style="
          padding: 8px 16px;
          background: white;
          color: #ea580c;
          border: none;
          border-radius: 999px;
          font-weight: 600;
          cursor: pointer;
        ">Install</button>
        <button id="dismiss-install" style="
          padding: 8px;
          background: transparent;
          color: white;
          border: none;
          cursor: pointer;
          font-size: 1.2rem;
        ">&times;</button>
      `;
      
      document.body.appendChild(banner);
      
      document.getElementById('install-btn').addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`User response: ${outcome}`);
          deferredPrompt = null;
          banner.remove();
        }
      });
      
      document.getElementById('dismiss-install').addEventListener('click', () => {
        banner.remove();
      });
    }

    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/Dashboard1/service-worker.js')
          .then((registration) => {
            console.log('ServiceWorker registered:', registration);
          })
          .catch((error) => {
            console.log('ServiceWorker registration failed:', error);
          });
      });
    }

    // ======================
    // TEXT-TO-SPEECH
    // ======================
    let speechSynthesis = window.speechSynthesis;
    let currentUtterance = null;
    let isReading = false;

    document.getElementById('tts-play-btn').addEventListener('click', startReading);
    document.getElementById('tts-stop-btn').addEventListener('click', stopReading);

    function startReading() {
      if (isReading) {
        stopReading();
        return;
      }

      // Get all visible article titles and descriptions
      const articles = Array.from(document.querySelectorAll('.news-card:not(.hidden)'));
      
      if (articles.length === 0) {
        alert('No articles to read');
        return;
      }

      let textToRead = 'Reading today\'s positive news. ';
      
      articles.slice(0, 5).forEach((article, index) => {
        const title = article.querySelector('.news-title')?.textContent || '';
        const summary = article.querySelector('.ai-summary')?.textContent || '';
        textToRead += `Article ${index + 1}. ${title}. ${summary}. `;
      });

      currentUtterance = new SpeechSynthesisUtterance(textToRead);
      currentUtterance.rate = 0.9;
      currentUtterance.pitch = 1;
      currentUtterance.volume = 1;

      currentUtterance.onstart = () => {
        isReading = true;
        document.getElementById('tts-play-btn').style.display = 'none';
        document.getElementById('tts-stop-btn').style.display = 'flex';
        document.getElementById('tts-stop-btn').classList.add('active');
      };

      currentUtterance.onend = () => {
        stopReading();
      };

      speechSynthesis.speak(currentUtterance);
    }

    function stopReading() {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }
      isReading = false;
      document.getElementById('tts-play-btn').style.display = 'flex';
      document.getElementById('tts-stop-btn').style.display = 'none';
      document.getElementById('tts-stop-btn').classList.remove('active');
    }

    // ======================
    // KEYBOARD SHORTCUTS
    // ======================
    document.addEventListener('keydown', (e) => {
      // Ignore if user is typing in an input
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        return;
      }

      // Show shortcuts help
      if (e.key === '?' || (e.shiftKey && e.key === '/')) {
        e.preventDefault();
        document.getElementById('shortcuts-modal').classList.add('show');
      }

      // Close modals with Escape
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal, .keyboard-shortcuts-modal').forEach(modal => {
          modal.classList.remove('show');
        });
      }

      // Refresh feed
      if (e.key === 'r' || e.key === 'R') {
        e.preventDefault();
        document.getElementById('refresh-btn')?.click();
      }

      // Read aloud
      if (e.altKey && (e.key === 'r' || e.key === 'R')) {
        e.preventDefault();
        startReading();
      }

      // Stop reading
      if (e.altKey && (e.key === 's' || e.key === 'S')) {
        e.preventDefault();
        stopReading();
      }

      // View stats
      if (e.key === 's' || e.key === 'S') {
        e.preventDefault();
        showStatsModal();
      }

      // Jump to discussions
      if (e.key === 'd' || e.key === 'D') {
        e.preventDefault();
        document.getElementById('discussion-section')?.scrollIntoView({ behavior: 'smooth' });
      }

      // Filter shortcuts
      const filterButtons = document.querySelectorAll('.filter-chip[data-filter]');
      if (e.key >= '1' && e.key <= '9') {
        const index = parseInt(e.key) - 1;
        if (filterButtons[index]) {
          e.preventDefault();
          filterButtons[index].click();
        }
      }
    });

    // ======================
    // PRINT FUNCTIONALITY
    // ======================
    // Add print button to header
    const printBtn = document.createElement('button');
    printBtn.innerHTML = 'üñ®Ô∏è Print';
    printBtn.style.cssText = `
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #fed7aa;
      background: transparent;
      color: #78716c;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.16s ease-out;
    `;
    printBtn.onmouseover = () => {
      printBtn.style.borderColor = '#fed7aa';
      printBtn.style.background = '#fff8ed';
      printBtn.style.color = '#292524';
    };
    printBtn.onmouseout = () => {
      printBtn.style.borderColor = '#fed7aa';
      printBtn.style.background = 'transparent';
      printBtn.style.color = '#78716c';
    };
    printBtn.onclick = () => window.print();
    
    // Add to nav
    const nav = document.querySelector('nav');
    if (nav) {
      nav.appendChild(printBtn);
    }

    // ======================
    // AGENTIC AI FEATURES
    // ======================
    
    // AI Agent Profile - learns from user behavior
    class AIAgent {
      constructor() {
        this.profile = this.loadProfile();
      }

      loadProfile() {
        const saved = localStorage.getItem('aiAgentProfile');
        if (saved) {
          return JSON.parse(saved);
        }
        return {
          readingHistory: [],
          categoryPreferences: {},
          sourcePreferences: {},
          timePreferences: {},
          readingSpeed: 200, // words per minute
          preferredLength: 'medium', // short, medium, long
          moodPreference: 'balanced', // uplifting, balanced, serious
          lastActive: null,
          totalInteractions: 0,
          learningEnabled: true
        };
      }

      saveProfile() {
        localStorage.setItem('aiAgentProfile', JSON.stringify(this.profile));
      }

      // Learn from reading behavior
      learnFromRead(article, timeSpent) {
        if (!this.profile.learningEnabled) return;

        this.profile.readingHistory.push({
          url: article.url,
          category: article.category,
          source: article.sourceKey,
          timestamp: Date.now(),
          timeSpent: timeSpent,
          title: article.title
        });

        // Keep only last 100 reads
        if (this.profile.readingHistory.length > 100) {
          this.profile.readingHistory = this.profile.readingHistory.slice(-100);
        }

        // Update category preferences
        this.profile.categoryPreferences[article.category] = 
          (this.profile.categoryPreferences[article.category] || 0) + 1;

        // Update source preferences
        this.profile.sourcePreferences[article.sourceKey] = 
          (this.profile.sourcePreferences[article.sourceKey] || 0) + 1;

        // Update time preferences
        const hour = new Date().getHours();
        const timeSlot = hour < 12 ? 'morning' : hour < 17 ? 'afternoon' : 'evening';
        this.profile.timePreferences[timeSlot] = 
          (this.profile.timePreferences[timeSlot] || 0) + 1;

        this.profile.totalInteractions++;
        this.profile.lastActive = Date.now();
        this.saveProfile();
      }

      // Calculate article relevance score
      calculateRelevance(article) {
        let score = 50; // Base score

        // Category preference boost
        const categoryReads = this.profile.categoryPreferences[article.category] || 0;
        const totalReads = Object.values(this.profile.categoryPreferences).reduce((a, b) => a + b, 0);
        if (totalReads > 0) {
          score += (categoryReads / totalReads) * 30;
        }

        // Source preference boost
        const sourceReads = this.profile.sourcePreferences[article.sourceKey] || 0;
        const totalSourceReads = Object.values(this.profile.sourcePreferences).reduce((a, b) => a + b, 0);
        if (totalSourceReads > 0) {
          score += (sourceReads / totalSourceReads) * 20;
        }

        // Recency boost
        if (article.publishedAt) {
          const ageHours = (Date.now() - new Date(article.publishedAt).getTime()) / (1000 * 60 * 60);
          if (ageHours < 6) score += 15;
          else if (ageHours < 24) score += 10;
          else if (ageHours < 48) score += 5;
        }

        return Math.min(100, score);
      }

      // Get personalized recommendations
      getRecommendations(articles, count = 5) {
        if (this.profile.totalInteractions < 3) {
          // Not enough data, return diverse selection
          return this.getDiverseSelection(articles, count);
        }

        // Score all articles
        const scored = articles.map(article => ({
          article,
          score: this.calculateRelevance(article)
        }));

        // Sort by score and return top N
        return scored
          .sort((a, b) => b.score - a.score)
          .slice(0, count)
          .map(item => item.article);
      }

      getDiverseSelection(articles, count) {
        const categories = [...new Set(articles.map(a => a.category))];
        const perCategory = Math.ceil(count / categories.length);
        const selected = [];

        categories.forEach(cat => {
          const catArticles = articles.filter(a => a.category === cat);
          selected.push(...catArticles.slice(0, perCategory));
        });

        return selected.slice(0, count);
      }

      // Estimate reading time
      estimateReadingTime(article) {
        const text = `${article.title || ''} ${article.description || ''} ${article.content || ''}`;
        const wordCount = text.split(/\s+/).length;
        const minutes = Math.ceil(wordCount / this.profile.readingSpeed);
        return minutes;
      }

      // Get articles matching available time
      getArticlesForTime(articles, availableMinutes) {
        return articles.filter(article => {
          const readTime = this.estimateReadingTime(article);
          return readTime <= availableMinutes;
        });
      }

      // Mood-based filtering
      filterByMood(articles) {
        if (this.profile.moodPreference === 'balanced') {
          return articles;
        }

        return articles.map(article => {
          const text = `${article.title || ''} ${article.description || ''}`.toLowerCase();
          let moodScore = 0;

          // Uplifting keywords
          if (text.match(/success|win|achievement|breakthrough|innovation|growth|positive/i)) {
            moodScore += 2;
          }

          // Serious keywords
          if (text.match(/crisis|concern|challenge|issue|problem|decline/i)) {
            moodScore -= 1;
          }

          article.moodScore = moodScore;
          return article;
        }).filter(article => {
          if (this.profile.moodPreference === 'uplifting') {
            return article.moodScore >= 0;
          }
          return true; // serious mode shows all
        });
      }

      // Generate personalized insight
      getPersonalizedInsight() {
        if (this.profile.totalInteractions < 5) {
          return "ü§ñ AI is learning your preferences. Keep reading to get personalized recommendations!";
        }

        const topCategory = Object.entries(this.profile.categoryPreferences)
          .sort((a, b) => b[1] - a[1])[0];

        const topTime = Object.entries(this.profile.timePreferences)
          .sort((a, b) => b[1] - a[1])[0];

        return `ü§ñ AI Insight: You love ${topCategory[0]} news and prefer reading in the ${topTime[0]}. I've prioritized similar content for you!`;
      }

      // Reset learning
      reset() {
        this.profile = {
          readingHistory: [],
          categoryPreferences: {},
          sourcePreferences: {},
          timePreferences: {},
          readingSpeed: 200,
          preferredLength: 'medium',
          moodPreference: 'balanced',
          lastActive: null,
          totalInteractions: 0,
          learningEnabled: true
        };
        this.saveProfile();
      }
    }

    // Initialize AI Agent
    const aiAgent = new AIAgent();

    // Enhanced article tracking with AI learning
    const originalTrackArticleRead = window.trackArticleRead || function() {};
    window.trackArticleRead = function(url, category, source) {
      originalTrackArticleRead(url, category, source);
      
      // Find the article
      const article = state.allArticles.find(a => a.url === url);
      if (article) {
        // Estimate time spent (in production, track actual time)
        const estimatedTime = aiAgent.estimateReadingTime(article);
        aiAgent.learnFromRead(article, estimatedTime);
        
        // Update AI insights display
        updateAIInsights();
      }
    };

    // Apply AI curation to articles
    function applyAICuration(articles) {
      if (!aiAgent.profile.learningEnabled) {
        return articles;
      }

      // Filter by mood
      let curated = aiAgent.filterByMood(articles);

      // Add relevance scores
      curated = curated.map(article => {
        article.aiRelevance = aiAgent.calculateRelevance(article);
        article.readingTime = aiAgent.estimateReadingTime(article);
        return article;
      });

      // Sort by relevance
      curated.sort((a, b) => b.aiRelevance - a.aiRelevance);

      return curated;
    }

    // Update AI insights in UI
    function updateAIInsights() {
      const insightEl = document.getElementById('ai-agent-insight');
      if (insightEl) {
        insightEl.textContent = aiAgent.getPersonalizedInsight();
      }

      const statsEl = document.getElementById('ai-learning-stats');
      if (statsEl) {
        const topCat = Object.entries(aiAgent.profile.categoryPreferences)
          .sort((a, b) => b[1] - a[1])[0];
        
        statsEl.innerHTML = `
          <div style="font-size: 0.75rem; color: #78716c;">
            üìä ${aiAgent.profile.totalInteractions} interactions<br>
            ${topCat ? `‚ù§Ô∏è Favorite: ${topCat[0]}` : 'üå± Building your profile...'}
          </div>
        `;
      }
    }

    // Show AI recommendations panel
    function showAIRecommendations() {
      const modal = document.getElementById('ai-recommendations-modal');
      if (!modal) return;

      const recommendations = aiAgent.getRecommendations(state.allArticles, 5);
      const container = document.getElementById('ai-recommendations-list');
      
      if (recommendations.length === 0) {
        container.innerHTML = '<p style="color: #78716c; text-align: center;">No recommendations available yet. Keep reading!</p>';
      } else {
        container.innerHTML = recommendations.map(article => `
          <div style="padding: 12px; background: #fff8ed; border-radius: 12px; margin-bottom: 10px; border-left: 3px solid #f97316;">
            <div style="font-weight: 600; color: #292524; margin-bottom: 4px;">${article.title}</div>
            <div style="font-size: 0.75rem; color: #78716c; margin-bottom: 6px;">
              ${article.category.toUpperCase()} ‚Ä¢ ${article.readingTime || 3} min read ‚Ä¢ ${Math.round(article.aiRelevance || 50)}% match
            </div>
            <a href="${article.url}" target="_blank" style="font-size: 0.8rem; color: #f97316; text-decoration: none;">
              Read article ‚Üó
            </a>
          </div>
        `).join('');
      }

      modal.classList.add('show');
    }

    // Quick read mode - articles under 3 minutes
    function showQuickReads() {
      const quickReads = aiAgent.getArticlesForTime(state.allArticles, 3);
      const modal = document.getElementById('quick-reads-modal');
      if (!modal) return;

      const container = document.getElementById('quick-reads-list');
      container.innerHTML = quickReads.slice(0, 8).map(article => `
        <div style="padding: 10px; background: #fff8ed; border-radius: 10px; margin-bottom: 8px;">
          <div style="font-weight: 600; font-size: 0.85rem; color: #292524; margin-bottom: 4px;">${article.title}</div>
          <div style="font-size: 0.7rem; color: #78716c; margin-bottom: 6px;">
            ‚è±Ô∏è ${article.readingTime || 2} min ‚Ä¢ ${article.category.toUpperCase()}
          </div>
          <a href="${article.url}" target="_blank" style="font-size: 0.75rem; color: #f97316; text-decoration: none;">
            Quick read ‚Üó
          </a>
        </div>
      `).join('');

      modal.classList.add('show');
    }

    // Toggle AI learning
    function toggleAILearning() {
      aiAgent.profile.learningEnabled = !aiAgent.profile.learningEnabled;
      aiAgent.saveProfile();
      
      const btn = document.getElementById('toggle-ai-learning-btn');
      if (btn) {
        btn.textContent = aiAgent.profile.learningEnabled ? 'ü§ñ AI Learning: ON' : 'ü§ñ AI Learning: OFF';
        btn.style.background = aiAgent.profile.learningEnabled ? 
          'linear-gradient(135deg, #f97316, #ea580c)' : '#9ca3af';
      }

      alert(aiAgent.profile.learningEnabled ? 
        'AI learning enabled! The system will learn from your reading patterns.' : 
        'AI learning disabled. Your reading patterns will not be tracked.');
    }

    // Change mood preference
    function changeMoodPreference(mood) {
      aiAgent.profile.moodPreference = mood;
      aiAgent.saveProfile();
      
      // Update button states
      document.querySelectorAll('.mood-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-mood="${mood}"]`)?.classList.add('active');
      
      // Reload with new mood filter
      renderNews();
    }

    // Make functions globally accessible
    window.showAIRecommendations = showAIRecommendations;
    window.showQuickReads = showQuickReads;
    window.toggleAILearning = toggleAILearning;
    window.changeMoodPreference = changeMoodPreference;
    window.aiAgent = aiAgent;

    // Initialize AI insights on load
    updateAIInsights();

    // ======================
    // WEATHER WIDGET
    // ======================
    
    async function loadWeather() {
      const weatherWidget = document.getElementById('weather-widget');
      const weatherIcon = document.getElementById('weather-icon');
      const weatherText = document.getElementById('weather-text');
      
      if (!weatherWidget) return;

      try {
        // Try to get user's location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              const { latitude, longitude } = position.coords;
              await fetchWeatherByCoords(latitude, longitude);
            },
            async (error) => {
              // Fallback to IP-based location
              console.log('Geolocation denied, using IP-based location');
              await fetchWeatherByIP();
            },
            { timeout: 5000 }
          );
        } else {
          // Fallback to IP-based location
          await fetchWeatherByIP();
        }
      } catch (error) {
        console.error('Weather loading error:', error);
        weatherText.textContent = 'Weather unavailable';
        weatherWidget.style.display = 'inline-flex';
      }
    }

    async function fetchWeatherByCoords(lat, lon) {
      try {
        // Use wttr.in API (free, no key required)
        const response = await fetch(`https://wttr.in/?format=j1`);
        const data = await response.json();
        
        if (data && data.current_condition && data.current_condition[0]) {
          displayWeather(data.current_condition[0], data.nearest_area[0]);
        }
      } catch (error) {
        console.error('Weather fetch error:', error);
        await fetchWeatherByIP();
      }
    }

    async function fetchWeatherByIP() {
      try {
        // Use wttr.in with automatic location detection
        const response = await fetch(`https://wttr.in/?format=j1`);
        const data = await response.json();
        
        if (data && data.current_condition && data.current_condition[0]) {
          displayWeather(data.current_condition[0], data.nearest_area[0]);
        }
      } catch (error) {
        console.error('Weather fetch error:', error);
        const weatherWidget = document.getElementById('weather-widget');
        const weatherText = document.getElementById('weather-text');
        weatherText.textContent = 'Weather unavailable';
        weatherWidget.style.display = 'inline-flex';
      }
    }

    function displayWeather(current, location) {
      const weatherWidget = document.getElementById('weather-widget');
      const weatherIcon = document.getElementById('weather-icon');
      const weatherText = document.getElementById('weather-text');
      
      if (!current) return;

      const temp = current.temp_C || current.temp_F;
      const condition = current.weatherDesc?.[0]?.value || current.weatherDesc || 'Unknown';
      const locationName = location?.areaName?.[0]?.value || location?.region?.[0]?.value || 'Your location';
      
      // Map weather conditions to emojis
      const weatherEmojis = {
        'clear': '‚òÄÔ∏è',
        'sunny': '‚òÄÔ∏è',
        'partly cloudy': '‚õÖ',
        'cloudy': '‚òÅÔ∏è',
        'overcast': '‚òÅÔ∏è',
        'mist': 'üå´Ô∏è',
        'fog': 'üå´Ô∏è',
        'rain': 'üåßÔ∏è',
        'light rain': 'üå¶Ô∏è',
        'heavy rain': '‚õàÔ∏è',
        'thunderstorm': '‚õàÔ∏è',
        'snow': '‚ùÑÔ∏è',
        'sleet': 'üå®Ô∏è',
        'drizzle': 'üå¶Ô∏è'
      };

      // Find matching emoji
      let emoji = 'üå§Ô∏è';
      const conditionLower = condition.toLowerCase();
      for (const [key, value] of Object.entries(weatherEmojis)) {
        if (conditionLower.includes(key)) {
          emoji = value;
          break;
        }
      }

      weatherIcon.textContent = emoji;
      weatherText.textContent = `${temp}¬∞C, ${condition} in ${locationName}`;
      weatherWidget.style.display = 'inline-flex';
      
      // Store in localStorage with timestamp
      const weatherData = {
        temp,
        condition,
        location: locationName,
        emoji,
        timestamp: Date.now()
      };
      localStorage.setItem('weatherData', JSON.stringify(weatherData));
    }

    // Load cached weather immediately, then refresh
    function initWeather() {
      const cached = localStorage.getItem('weatherData');
      if (cached) {
        try {
          const data = JSON.parse(cached);
          const age = Date.now() - data.timestamp;
          
          // Use cache if less than 30 minutes old
          if (age < 30 * 60 * 1000) {
            const weatherWidget = document.getElementById('weather-widget');
            const weatherIcon = document.getElementById('weather-icon');
            const weatherText = document.getElementById('weather-text');
            
            weatherIcon.textContent = data.emoji;
            weatherText.textContent = `${data.temp}¬∞C, ${data.condition} in ${data.location}`;
            weatherWidget.style.display = 'inline-flex';
          }
        } catch (e) {
          console.error('Error loading cached weather:', e);
        }
      }
      
      // Refresh weather data
      loadWeather();
    }

    // Click to refresh weather
    document.getElementById('weather-widget')?.addEventListener('click', () => {
      const weatherText = document.getElementById('weather-text');
      weatherText.textContent = 'Refreshing...';
      loadWeather();
    });

    // Initialize weather on page load
    initWeather();

    // Refresh weather every 30 minutes
    setInterval(loadWeather, 30 * 60 * 1000);

  </script>

  <!-- Buy Me a Coffee Widget -->
  <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="maheshramanathan" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting! If you enjoy this ad-free news experience, consider buying me a coffee ‚òï" data-color="#f97316" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Mahesh +ve Pill — AI-Curated Signal Over Noise</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="AI-curated positive news platform that filters signal from noise. Get constructive journalism without sensationalism, doom-scrolling, or clickbait." />
  <meta name="keywords" content="AI news, positive news, curated news, constructive journalism, tech news, startup news, news aggregator, sentiment analysis, anti-clickbait" />
  <meta name="author" content="Mahesh Ramanathan" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://maheshmaheshwarr-stack.github.io/Dashboard1/" />

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#f97316" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Mahesh News" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <!-- Open Graph / LinkedIn Sharing -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Mahesh +ve Pill — AI-Curated Signal Over Noise" />
  <meta property="og:description" content="An agentic AI news system that resists panic, deprioritises breaking noise, and highlights durable, constructive signals." />
  <meta property="og:url" content="https://maheshmaheshwarr-stack.github.io/Dashboard1/" />
  <meta property="og:image" content="https://maheshmaheshwarr-stack.github.io/Dashboard1/og-preview.png" />
  
  <!-- Article metadata -->
  <meta property="article:author" content="Mahesh Ramanathan" />
  <meta property="article:published_time" content="2025-12-19T08:00:00+05:30" />
  <meta property="article:modified_time" content="2025-12-19T08:00:00+05:30" />
  <meta name="author" content="Mahesh Ramanathan" />

  <!-- Structured Data for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Mahesh +ve Pill",
    "description": "AI-curated positive news platform that filters signal from noise",
    "url": "https://maheshmaheshwarr-stack.github.io/Dashboard1/",
    "author": {
      "@type": "Person",
      "name": "Mahesh Ramanathan"
    },
    "keywords": "AI news, positive news, curated news, constructive journalism",
    "inLanguage": "en-US"
  }
  </script>

  <style>
    :root {
      /* Professional Color Palette */
      --bg: #ffffff;
      --bg-soft: #f8fafc;
      --bg-softer: #f1f5f9;
      --bg-dark: #0f172a;
      --accent: #1e40af;
      --accent-soft: rgba(30, 64, 175, 0.08);
      --accent-strong: #1d4ed8;
      --accent-light: #3b82f6;
      --text-main: #0f172a;
      --text-muted: #64748b;
      --text-light: #94a3b8;
      --card-border: #e2e8f0;
      --card-border-hover: #cbd5e1;
      --chip-bg: #f1f5f9;
      --success: #059669;
      --success-soft: #d1fae5;
      --warning: #d97706;
      --warning-soft: #fed7aa;
      --shadow-soft: 0 1px 3px rgba(0, 0, 0, 0.05);
      --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-strong: 0 8px 24px rgba(0, 0, 0, 0.12);
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --gradient-primary: linear-gradient(135deg, #1e40af 0%, #1d4ed8 100%);
      --gradient-secondary: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      background: var(--bg-soft) !important;
    }

    body {
      background: var(--gradient-secondary) !important;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Inter", "SF Pro Display", system-ui, sans-serif;
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column; 
      justify-content: flex-start;
      align-items: center;
      padding: 24px 16px;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .app-shell {
      width: 100%;
      max-width: 1400px;
      min-height: auto;
      display: flex;
      flex-direction: column;
      background: var(--bg);
      border-radius: var(--radius-lg);
      padding: 0;
      box-shadow: var(--shadow-strong);
      border: 1px solid var(--card-border);
      position: relative;
    }

    .app-shell > footer {
      margin-top: auto;
      text-align: center;
      padding: 32px 24px;
      font-size: 0.875rem;
      color: #94a3b8;
      border-top: 1px solid #e2e8f0;
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 0;
      }
    }

    header {
      background: var(--bg);
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 0;
      padding: 32px 32px 24px; 
      align-items: flex-start;
      border-bottom: 2px solid var(--card-border);
    }

    @media (min-width: 640px) {
      header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 32px 40px 24px;
      }
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .brand-badge {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-medium);
      position: relative;
      overflow: hidden;
    }

    .brand-text h1 {
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.025em;
      margin-bottom: 4px;
      line-height: 1.2;
      margin: 0;
      color: var(--text-main);
    }

    .brand-text p {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin: 0;
      line-height: 1.4;
      font-weight: 500;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-start;
    }

    @media (min-width: 640px) {
      .header-right {
        align-items: flex-end;
      }
    }

    nav {
      display: flex;
      gap: 12px;
      font-size: 0.9rem;
    }

    .nav-link {
      padding: 8px 16px;
      border-radius: var(--radius-md);
      text-decoration: none;
      color: var(--text-muted);
      border: 1px solid transparent;
      background: transparent;
      transition: all 0.2s ease-out;
      font-weight: 500;
    }

    .nav-link:hover {
      border-color: var(--card-border-hover);
      background: var(--bg-soft);
      color: var(--text-main);
    }

    .nav-link.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent-strong);
      box-shadow: var(--shadow-soft);
    }

    /* Authentication Buttons */
    .auth-section {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .auth-btn {
      padding: 8px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--card-border);
      background: var(--bg);
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .auth-btn:hover {
      color: var(--accent);
      border-color: var(--accent);
      background: var(--accent-soft);
    }

    .login-btn {
      color: var(--accent);
      border-color: var(--accent);
    }

    .login-btn:hover {
      background: var(--accent-soft);
      border-color: var(--accent-strong);
    }

    .signup-btn {
      background: var(--gradient-primary);
      color: white;
      border-color: var(--accent);
    }

    .signup-btn:hover {
      background: var(--accent-strong);
      transform: translateY(-1px);
      box-shadow: var(--shadow-medium);
    }

    /* User Profile Dropdown */
    .user-profile {
      position: relative;
    }

    .profile-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #e2e8f0;
      background: #ffffff;
      color: #64748b;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
    }

    .profile-btn:hover {
      color: #f97316;
      border-color: #fed7aa;
      background: #fff8ed;
    }

    .profile-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 8px 0;
      min-width: 160px;
      display: none;
      z-index: 1000;
    }

    .profile-dropdown a {
      display: block;
      padding: 8px 16px;
      color: #64748b;
      text-decoration: none;
      font-size: 0.875rem;
      transition: background 0.2s ease;
    }

    .profile-dropdown a:hover {
      background: #f8fafc;
      color: #f97316;
    }

    .meta {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-start;
    }

    @media (min-width: 640px) {
      .meta {
        align-items: flex-end;
      }
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.75rem;
      justify-content: flex-start;
      margin-bottom: 6px;
    }

    .pill {
      border-radius: var(--radius-md);
      padding: 4px 10px;
      background: var(--chip-bg);
      border: 1px solid var(--card-border);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.72rem;
    }

    .pill span.icon {
      font-size: 0.9em;
    }

    .pill--accent {
      border-color: rgba(34, 197, 94, 0.8);
      color: #166534;
      background: rgba(22, 163, 74, 0.08);
    }

    .filters-bar {
      margin-top: 20px;
      padding: 0 32px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      row-gap: 12px;
      margin-bottom: 20px; 
    }

    @media (min-width: 640px) {
      .filters-bar {
        padding: 0 40px;
      }
    }

    .filter-chip {
      border-radius: var(--radius-md);
      padding: 10px 18px;
      font-size: 0.9rem;
      font-weight: 500;
      border: 1px solid var(--card-border);
      background: var(--bg);
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .filter-chip span.dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-light);
    }

    .filter-chip.active {
      background: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
      box-shadow: var(--shadow-medium);
    }

    .filter-chip.active span.dot {
      background: #ffffff;
    }

    .filter-chip:hover:not(.active) {
      border-color: var(--card-border-hover);
      background: var(--bg-soft);
      color: var(--text-main);
    }

    .sources-wrapper {
      margin-top: 6px;
      width: 100%;
      margin-bottom: 0; 
    }

    .sources-wrapper[open] {
      background: #f9fafb;
      border-radius: 999px;
    }

    .sources-summary {
      list-style: none;
      cursor: pointer;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 10px;
      font-size: 0.72rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #f9fafb;
    }

    .sources-summary::-webkit-details-marker {
      display: none;
    }

    .sources-caret {
      font-size: 0.7rem;
      transform: translateY(1px);
      transition: transform 0.2s;
    }

    .sources-count {
      font-size: 0.7rem;
      color: #4b5563;
      padding: 2px 7px;
      border-radius: 999px;
      background: #e5e7eb;
    }

    .sources-wrapper[open] .sources-summary {
      border-color: rgba(249, 115, 22, 0.9);
      background: #ffedd5;
      color: #292524;
    }

    .sources-wrapper[open] .sources-caret {
      transform: rotate(90deg);
    }

    .source-group {
      margin-bottom: 12px;
    }

    .source-group-title {
      font-size: 0.7rem;
      text-transform: uppercase;
      color: #6b7280;
      margin: 6px 0;
      font-weight: 600;
    }

    main {
      margin-top: 0;
      padding: 32px;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
      gap: 32px;
    }

    @media (min-width: 640px) {
      main {
        padding: 40px;
      }
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .multimedia-section {
      grid-column: 1 / -1;
      margin-top: 16px;
      padding: 20px;
      background: #fff8ed;
      border-radius: 20px;
      border: 2px solid #fed7aa;
    }

    .multimedia-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .multimedia-tab {
      padding: 8px 16px;
      border-radius: 999px;
      border: 2px solid #fed7aa;
      background: #ffffff;
      color: #78716c;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .multimedia-tab:hover {
      border-color: #f97316;
      transform: translateY(-2px);
    }

    .multimedia-tab.active {
      background: linear-gradient(135deg, #f97316, #ea580c);
      color: #ffffff;
      border-color: #f97316;
    }

    .multimedia-content {
      display: none;
    }

    .multimedia-content.active {
      display: block;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 16px;
    }

    .gallery-item {
      border-radius: 16px;
      overflow: hidden;
      background: #ffffff;
      border: 2px solid #fed7aa;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    .gallery-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(249, 115, 22, 0.2);
    }

    .gallery-item img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    .gallery-item-content {
      padding: 12px;
    }

    .gallery-item-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #292524;
      line-height: 1.3;
      margin-bottom: 6px;
    }

    .gallery-item-source {
      font-size: 0.7rem;
      color: #78716c;
    }

    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .video-item {
      border-radius: 16px;
      overflow: hidden;
      background: #ffffff;
      border: 2px solid #fed7aa;
    }

    .video-item iframe {
      width: 100%;
      height: 200px;
      border: none;
    }

    .video-item-content {
      padding: 12px;
    }

    .podcast-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .podcast-item {
      display: flex;
      gap: 12px;
      padding: 12px;
      background: #ffffff;
      border-radius: 12px;
      border: 2px solid #fed7aa;
      align-items: center;
      transition: transform 0.2s;
    }

    .podcast-item:hover {
      transform: translateX(4px);
    }

    .podcast-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      background: linear-gradient(135deg, #f97316, #ea580c);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    .podcast-info {
      flex: 1;
    }

    .podcast-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #292524;
      margin-bottom: 4px;
    }

    .podcast-meta {
      font-size: 0.75rem;
      color: #78716c;
    }

    .infographic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .infographic-item {
      border-radius: 16px;
      overflow: hidden;
      background: #ffffff;
      border: 2px solid #fed7aa;
      transition: transform 0.2s;
      cursor: pointer;
    }

    .infographic-item:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .infographic-item img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }

    .infographic-item-content {
      padding: 12px;
    }

    .column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .section-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .section-title h2 {
      font-size: 0.85rem;
      color: var(--text-muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    /* View Toggle Buttons */
    .view-toggle-btn {
      padding: 6px 8px;
      border: 2px solid #e5e7eb;
      background: #ffffff;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6b7280;
    }

    .view-toggle-btn:hover {
      background: #f9fafb;
      border-color: #fed7aa;
      color: #f97316;
    }

    .view-toggle-btn.active {
      background: linear-gradient(135deg, #f97316, #ea580c);
      border-color: #f97316;
      color: #ffffff;
    }

    .view-toggle-btn svg {
      width: 16px;
      height: 16px;
    }

    .news-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      transition: all 0.3s ease;
    }

    /* Grid View Layout */
    .news-list.grid-view {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 16px;
    }

    @media (max-width: 768px) {
      .news-list.grid-view {
        grid-template-columns: 1fr;
      }
    }

    /* Compact View Layout */
    .news-list.compact-view .news-card {
      padding: 8px 10px;
      gap: 4px;
    }

    .news-list.compact-view .news-title {
      font-size: 0.88rem;
    }

    .news-list.compact-view .tagline {
      -webkit-line-clamp: 2;
    }

    .news-card {
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      background: var(--bg);
      padding: 24px;
      box-shadow: var(--shadow-soft);
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 16px;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      animation: cardFadeIn 0.4s ease-out;
    }

    @keyframes cardFadeIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .news-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
      border-color: var(--card-border-hover);
    }

    /* Card with Image */
    .news-card.has-image {
      grid-template-columns: 160px 1fr;
      gap: 20px;
    }

    .news-list.grid-view .news-card.has-image {
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .news-card-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: var(--radius-md);
      background: var(--gradient-secondary);
    }

    .news-list.grid-view .news-card-image {
      height: 200px;
    }

    .news-card-content {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    /* Category Color Coding */
    .news-card[data-category="ai"] {
      border-left: 3px solid #8b5cf6;
    }

    .news-card[data-category="science"] {
      border-left: 3px solid #06b6d4;
    }

    .news-card[data-category="space"] {
      border-left: 3px solid #6366f1;
    }

    .news-card[data-category="health"] {
      border-left: 3px solid #10b981;
    }

    .news-card[data-category="environment"] {
      border-left: 3px solid #22c55e;
    }

    .news-card[data-category="markets"] {
      border-left: 3px solid #f59e0b;
    }

    .news-card[data-category="startups"] {
      border-left: 3px solid #ec4899;
    }

    .news-card[data-category="sports"] {
      border-left: 3px solid #ef4444;
    }

    .news-card[data-category="culture"] {
      border-left: 3px solid #a855f7;
    }

    .news-card[data-category="design"] {
      border-left: 3px solid #f97316;
    }

    .news-card[data-category="positive"] {
      border-left: 3px solid #84cc16;
    }

    .news-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.68rem;
    }

    .badge {
      padding: 4px 8px;
      border-radius: var(--radius-sm);
      background: var(--chip-bg);
      color: var(--text-muted);
      border: 1px solid var(--card-border);
    }

    .badge--category {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.65rem;
      font-weight: 600;
    }

    /* Category Badge Colors */
    .news-card[data-category="ai"] .badge--category {
      background: #ede9fe;
      color: #6b21a8;
      border-color: #a78bfa;
    }

    .news-card[data-category="science"] .badge--category {
      background: #cffafe;
      color: #0e7490;
      border-color: #22d3ee;
    }

    .news-card[data-category="space"] .badge--category {
      background: #e0e7ff;
      color: #3730a3;
      border-color: #818cf8;
    }

    .news-card[data-category="health"] .badge--category {
      background: #d1fae5;
      color: #065f46;
      border-color: #34d399;
    }

    .news-card[data-category="environment"] .badge--category {
      background: #dcfce7;
      color: #166534;
      border-color: #4ade80;
    }

    .news-card[data-category="markets"] .badge--category {
      background: #fef3c7;
      color: #92400e;
      border-color: #fbbf24;
    }

    .news-card[data-category="startups"] .badge--category {
      background: #fce7f3;
      color: #9f1239;
      border-color: #f9a8d4;
    }

    .news-card[data-category="sports"] .badge--category {
      background: #fee2e2;
      color: #991b1b;
      border-color: #fca5a5;
    }

    .news-card[data-category="culture"] .badge--category {
      background: #f3e8ff;
      color: #6b21a8;
      border-color: #c084fc;
    }

    .news-card[data-category="design"] .badge--category {
      background: #ffedd5;
      color: #9a3412;
      border-color: #fb923c;
    }

    .news-card[data-category="positive"] .badge--category {
      background: #ecfccb;
      color: #3f6212;
      border-color: #a3e635;
    }

    .badge--positive {
      border-color: rgba(249, 115, 22, 0.9);
      color: #9a3412;
      background: #ffedd5;
    }

    .news-title {
      font-size: 0.98rem;
      font-weight: 600;
      line-height: 1.4;
      color: var(--text-main);
    }

    .news-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .news-meta {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .tagline {
      font-size: 0.75rem;
      color: #c2410c;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .news-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }

    .source {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .read-link {
      font-size: 0.875rem;
      font-weight: 500;
      text-decoration: none;
      color: #6366f1;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: color 0.2s;
    }

    .read-link:hover {
      color: #4f46e5;
      text-decoration: underline;
    }

    .sidebar-card {
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      background: var(--bg);
      padding: 20px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar-card h3 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-main);
      letter-spacing: -0.01em;
    }

    .sidebar-card p {
      font-size: 0.875rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .sidebar-list {
      margin-top: 4px;
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .sidebar-list li {
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pill-mini {
      border-radius: var(--radius-sm);
      padding: 3px 7px;
      border: 1px solid var(--accent);
      font-size: 0.7rem;
      color: var(--accent-strong);
      background: var(--accent-soft);
    }

    .positivity-meter {
      margin-top: 6px;
      width: 100%;
    }

    .positivity-meter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .positivity-bar {
      position: relative;
      width: 100%;
      height: 8px;
      border-radius: var(--radius-sm);
      background: var(--bg-softer);
      overflow: hidden;
    }

    .positivity-bar-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0%;
      border-radius: var(--radius-sm);
      background: var(--gradient-primary);
      transition: width 0.4s ease-out;
    }

    .input, .textarea {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid var(--card-border);
      padding: 8px 12px;
      font-size: 0.875rem;
      color: var(--text-main);
      background: var(--bg);
      outline: none;
      transition: border-color 0.2s;
    }

    .input:focus, .textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .textarea {
      border-radius: var(--radius-md);
      min-height: 80px;
      resize: vertical;
      padding: 12px;
    }

    .btn-primary {
      border: none;
      border-radius: var(--radius-md);
      padding: 8px 16px;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      background: var(--gradient-primary);
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
      box-shadow: var(--shadow-soft);
    }

    .btn-primary:hover {
      background: var(--accent-strong);
      transform: translateY(-1px);
      box-shadow: var(--shadow-medium);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .feedback-status {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 4px;
      min-height: 1em;
    }

    .feedback-status.success {
      color: #15803d;
    }

    .feedback-status.error {
      color: #b91c1c;
    }

    .agent-note {
      background: #fff8ed;
      border: 2px solid #fed7aa;
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 16px;
      font-size: 0.85rem;
      color: #292524;
      animation: agentFadeIn 0.5s ease-out;
    }

    @keyframes agentFadeIn {
      from {
        opacity: 0;
        transform: translateY(6px) scale(0.98);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .agent-reason {
      margin-top: 10px;
      padding: 10px 12px;
      font-size: 0.8rem;
      color: #292524;
      background: #fff8ed;
      border-left: 3px solid #f97316;
      border-radius: 8px;
      line-height: 1.4;
    }

    .agent-ignored {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 12px;
      background: #fff7ed;
      border: 1px dashed #fed7aa;
      font-size: 0.8rem;
      color: #7c2d12;
    }

    .agent-ignored ul {
      margin-top: 6px;
      padding-left: 16px;
    }

    .agent-ignored li {
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .agentic-header {
      padding: 16px 20px 12px;
      text-align: center;
    }

    .agentic-brand {
      display: inline-flex;
      align-items: center;
      gap: 14px;
    }

    .agentic-logo {
      width: 64px;
      height: 64px;
      border-radius: var(--radius-lg);
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-strong);
    }

    .agentic-logo-icon {
      font-size: 1.8rem;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,0.15));
    }

    .agentic-text h1 {
      font-size: 1.6rem;
      font-weight: 750;
      margin: 0;
      color: #0f172a;
      letter-spacing: -0.01em;
    }

    .agentic-tagline {
      margin: 2px 0 0;
      font-size: 0.9rem;
      color: #475569;
    }

    .agentic-subline {
      margin-top: 2px;
      font-size: 0.7rem;
      color: #94a3b8;
      letter-spacing: 0.02em;
    }

    footer {
      margin-top: 18px;
      padding-top: 10px;
      border-top: 1px dashed rgba(148, 163, 184, 0.7);
      display: flex;
      flex-direction: column;
      gap: 6px;
      justify-content: center;
      align-items: center;
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    footer a {
      color: #ea580c;
      text-decoration: none;
      cursor: pointer;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .footer-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
    }

    .footer-badge {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: #f3f4f6;
      color: var(--text-muted);
    }

    .hidden {
      display: none !important;
    }

    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
      }
      50% {
        box-shadow: 0 4px 20px rgba(249, 115, 22, 0.5);
      }
    }

    @keyframes fadeIn {
      0%, 100% {
        opacity: 0;
      }
      100% {
        opacity: 1;
      }
    }

    .floating-discussion-btn {
      position: fixed;
      bottom: 120px;
      right: 24px;
      z-index: 9998;
      padding: 12px 20px;
      background: var(--bg);
      color: var(--text-main);
      border: 1px solid var(--card-border);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      box-shadow: var(--shadow-medium);
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      backdrop-filter: blur(8px);
    }

    .floating-discussion-btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-strong);
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-soft);
    }

    .floating-discussion-btn .badge-new {
      background: var(--accent);
      color: #ffffff;
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }

    @media (max-width: 640px) {
      .floating-discussion-btn {
        bottom: 100px;
        right: 16px;
        padding: 10px 16px;
        font-size: 0.8rem;
      }
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100000;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .modal.show {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      background: #ffffff;
      border-radius: 14px;
      padding: 24px;
      max-width: 520px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      position: relative;
      transform: scale(0.96);
      transition: transform 0.2s ease;
    }

    .modal.show .modal-content {
      transform: scale(1);
    }

    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 12px;
    }

    .modal-content ul {
      margin: 12px 0;
      padding-left: 20px;
    }

    .modal-content li {
      margin-bottom: 8px;
      line-height: 1.5;
    }

    .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      border: none;
      background: none;
      font-size: 22px;
      cursor: pointer;
      color: #6b7280;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      transition: background 0.2s;
    }

    .modal-close:hover {
      background: #f3f4f6;
      color: #111827;
    }

    /* Mood Button Styles */
    .mood-btn.active {
      background: #fed7aa !important;
      border-color: #f97316 !important;
      font-weight: 600;
    }

    /* Wellness Features */
    .inspiration-quote {
      padding: 20px;
      background: linear-gradient(135deg, #fef3c7, #fed7aa);
      border-radius: 16px;
      border: 2px solid #f97316;
      margin-bottom: 16px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.15);
    }

    .inspiration-quote-text {
      font-size: 1.1rem;
      font-weight: 500;
      color: #292524;
      line-height: 1.6;
      margin-bottom: 8px;
      font-style: italic;
    }

    .inspiration-quote-author {
      font-size: 0.85rem;
      color: #78716c;
      font-weight: 600;
    }

    /* Professional Wellness Controls */
    .wellness-controls {
      position: fixed;
      bottom: 200px;
      right: 24px;
      z-index: 9998;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .wellness-btn {
      width: 44px;
      height: 44px;
      padding: 0;
      border-radius: var(--radius-md);
      border: 1px solid var(--card-border);
      background: var(--bg);
      color: var(--text-muted);
      font-size: 1rem;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      backdrop-filter: blur(8px);
    }

    .wellness-btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-medium);
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-soft);
    }

    .wellness-btn.active {
      background: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
    }

    .wellness-btn-tooltip {
      position: absolute;
      right: 60px;
      background: var(--bg-dark);
      color: white;
      padding: 8px 12px;
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      box-shadow: var(--shadow-medium);
    }

    .wellness-btn:hover .wellness-btn-tooltip {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .wellness-controls {
        bottom: 160px;
        right: 16px;
      }
      
      .wellness-btn {
        width: 40px;
        height: 40px;
        font-size: 0.9rem;
      }
    }

    /* Theme Overlays */
    .theme-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      transition: opacity 0.8s ease;
      opacity: 0;
    }

    .theme-overlay.active {
      opacity: 1;
    }

    .theme-ocean {
      background: linear-gradient(180deg, 
        rgba(6, 182, 212, 0.12) 0%, 
        rgba(14, 165, 233, 0.08) 50%,
        rgba(3, 105, 161, 0.15) 100%);
    }

    .theme-forest {
      background: linear-gradient(180deg, 
        rgba(34, 197, 94, 0.12) 0%, 
        rgba(22, 163, 74, 0.08) 50%,
        rgba(21, 128, 61, 0.15) 100%);
    }

    .theme-sunset {
      background: linear-gradient(180deg, 
        rgba(251, 146, 60, 0.15) 0%, 
        rgba(249, 115, 22, 0.1) 50%,
        rgba(234, 88, 12, 0.18) 100%);
    }

    /* Theme notification */
    .theme-notification {
      position: fixed;
      top: 80px;
      right: 20px;
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.4);
      z-index: 10001;
      opacity: 0;
      transform: translateX(100px);
      transition: all 0.3s ease;
      pointer-events: none;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .theme-notification.show {
      opacity: 1;
      transform: translateX(0);
    }

    /* Zen Mode */
    body.zen-mode .app-shell > *:not(main) {
      opacity: 0.3;
      transition: opacity 0.3s;
    }

    body.zen-mode .app-shell > *:not(main):hover {
      opacity: 1;
    }

    /* Breathing Exercise Modal */
    .breathing-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100002;
      flex-direction: column;
      gap: 20px;
    }

    .breathing-modal.show {
      display: flex;
    }

    .breathing-circle {
      width: 160px;
      height: 160px;
      border-radius: var(--radius-lg);
      background: var(--gradient-primary);
      box-shadow: var(--shadow-strong);
      animation: breathe 8s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.1); }
      50% { transform: scale(1); }
      75% { transform: scale(1); }
    }

    .breathing-text {
      color: white;
      font-size: 1.5rem;
      font-weight: 600;
      text-align: center;
    }

    .breathing-instruction {
      color: #d1d5db;
      font-size: 1rem;
      text-align: center;
      animation: breatheText 8s ease-in-out infinite;
    }

    @keyframes breatheText {
      0%, 100% { opacity: 0.7; }
      25% { opacity: 1; content: "Breathe In..."; }
      50% { opacity: 0.7; content: "Hold..."; }
      75% { opacity: 1; content: "Breathe Out..."; }
    }

    /* Mood Tracker Modal */
    .mood-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100001;
    }

    .mood-modal.show {
      display: flex;
    }

    .mood-content {
      background: white;
      padding: 32px;
      border-radius: 20px;
      max-width: 500px;
      width: 90%;
      text-align: center;
    }

    .mood-options {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 24px 0;
      flex-wrap: wrap;
    }

    .mood-option {
      width: 72px;
      height: 72px;
      border-radius: var(--radius-lg);
      border: 2px solid var(--card-border);
      background: var(--bg-soft);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }

    .mood-option:hover {
      transform: translateY(-2px);
      border-color: var(--accent);
      box-shadow: var(--shadow-medium);
    }

    .mood-option.selected {
      border-color: var(--accent);
      background: var(--accent-soft);
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .mood-label {
      font-size: 0.7rem;
      color: #6b7280;
      margin-top: 4px;
    }

    /* Print Styles */
    @media print {
      body {
        background: white !important;
        padding: 0;
      }

    /* Unique Features Styles */
    
    /* Living Background */
    body {
      position: relative;
      transition: background 1s ease;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 0;
      opacity: 0.4;
      pointer-events: none;
      transition: background 2s ease;
    }

    body.time-morning::before {
      background: radial-gradient(circle at 30% 20%, rgba(251, 191, 36, 0.15), transparent 50%),
                  radial-gradient(circle at 70% 80%, rgba(252, 211, 77, 0.1), transparent 50%);
    }

    body.time-afternoon::before {
      background: radial-gradient(circle at 50% 30%, rgba(96, 165, 250, 0.12), transparent 50%),
                  radial-gradient(circle at 80% 70%, rgba(147, 197, 253, 0.08), transparent 50%);
    }

    body.time-evening::before {
      background: radial-gradient(circle at 40% 40%, rgba(251, 146, 60, 0.15), transparent 50%),
                  radial-gradient(circle at 60% 60%, rgba(254, 215, 170, 0.1), transparent 50%);
    }

    body.time-night::before {
      background: radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1), transparent 50%),
                  radial-gradient(circle at 30% 70%, rgba(139, 92, 246, 0.08), transparent 50%);
    }

    /* Hope Score Widget - Professional */
    .hope-score-widget {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      background: var(--bg);
      padding: 12px 16px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-medium);
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid var(--card-border);
      backdrop-filter: blur(8px);
    }

    .hope-score-widget:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-strong);
      border-color: var(--accent);
    }

    .hope-score-number {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-strong);
      line-height: 1;
    }

    .hope-score-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-weight: 600;
    }

    /* Action Button on Cards */
    .action-button {
      margin-top: 8px;
      padding: 8px 12px;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    /* Community Stats Banner */
    .community-banner {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .community-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .community-stat-number {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .community-stat-label {
      font-size: 0.7rem;
      opacity: 0.9;
    }

    /* Story Arc Badge */
    .story-arc-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      background: linear-gradient(135deg, #ec4899, #db2777);
      color: white;
      border-radius: 999px;
      font-size: 0.65rem;
      font-weight: 600;
    }

    /* Time Capsule Section */
    .time-capsule {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border: 2px solid #fbbf24;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .time-capsule-title {
      font-size: 1rem;
      font-weight: 700;
      color: #92400e;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Hope AI Personality */
    .hope-message {
      background: linear-gradient(135deg, #ddd6fe, #e9d5ff);
      border: 2px solid #a78bfa;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
      position: relative;
    }

    .hope-avatar {
      width: 36px;
      height: 36px;
      background: var(--gradient-primary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      position: absolute;
      top: -8px;
      left: 16px;
      box-shadow: var(--shadow-medium);
    }

    .hope-text {
      margin-left: 50px;
      font-size: 0.9rem;
      color: #4c1d95;
      line-height: 1.5;
    }

    /* Print Styles */

      .app-shell {
        box-shadow: none;
        border: none;
        max-width: 100%;
      }

      header, .filters-bar, .sources-wrapper, 
      .floating-discussion-btn, #chat-widget,
      .multimedia-section, footer, 
      .agent-ignored, .feedback-form,
      .sidebar-card, .nav-link, .pill-row,
      .filter-chip, .btn-primary {
        display: none !important;
      }

      .news-card {
        page-break-inside: avoid;
        border: 1px solid #ddd;
        margin-bottom: 16px;
      }

      .news-title {
        font-size: 1rem;
        color: black;
      }

      .tagline, .agent-reason {
        font-size: 0.85rem;
        color: #333;
      }

      .read-link {
        color: black;
        text-decoration: underline;
      }

      main {
        grid-template-columns: 1fr;
      }

      .column:last-child {
        display: none;
      }
    }

    /* Text-to-Speech Controls - Professional */
    .tts-controls {
      position: fixed;
      bottom: 180px;
      right: 30px;
      z-index: 9997;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .tts-btn {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-md);
      border: 1px solid var(--card-border);
      background: var(--bg);
      color: var(--accent);
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(8px);
    }

    .tts-btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-medium);
      border-color: var(--accent);
      background: var(--accent-soft);
    }

    .tts-btn.active {
      background: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    /* Keyboard Shortcuts Help */
    .keyboard-shortcuts-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100001;
    }

    .keyboard-shortcuts-modal.show {
      display: flex;
    }

    .shortcuts-content {
      background: white;
      padding: 24px;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .shortcut-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #fed7aa;
    }

    .shortcut-key {
      background: #ffedd5;
      padding: 4px 10px;
      border-radius: 6px;
      font-family: monospace;
      font-weight: 600;
      color: #ea580c;
      border: 2px solid #fed7aa;
    }

    /* Accessibility Focus Styles */
    *:focus-visible {
      outline: 3px solid #f97316;
      outline-offset: 2px;
    }

    /* Skip to Content Link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: #f97316;
      color: white;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 0 0 8px 0;
      z-index: 100;
    }

    .skip-link:focus {
      top: 0;
    }

    /* Language Selector */
    .language-selector {
      position: relative;
      display: inline-block;
    }

    .language-btn {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #fed7aa;
      background: transparent;
      color: #78716c;
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.16s ease-out;
    }

    .language-btn:hover {
      border-color: #fed7aa;
      background: #fff8ed;
      color: #292524;
    }

    .language-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 2px solid #fed7aa;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(249, 115, 22, 0.2);
      display: none;
      min-width: 180px;
      z-index: 1000;
    }

    .language-dropdown.show {
      display: block;
    }

    .language-option {
      padding: 10px 16px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: #292524;
    }

    .language-option:first-child {
      border-radius: 10px 10px 0 0;
    }

    .language-option:last-child {
      border-radius: 0 0 10px 10px;
    }

    .language-option:hover {
      background: #fff8ed;
    }

    .language-option.active {
      background: #ffedd5;
      font-weight: 600;
      color: #ea580c;
    }

    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #fed7aa;
      border-top-color: #f97316;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
  </style>
</head>
<body>
  
  <!-- Skip to Content Link for Accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Text-to-Speech Controls -->
  <div class="tts-controls">
    <button class="tts-btn" id="tts-play-btn" title="Read articles aloud (Alt+R)" aria-label="Read articles aloud">
      🔊
    </button>
    <button class="tts-btn" id="tts-stop-btn" title="Stop reading (Alt+S)" aria-label="Stop reading" style="display:none;">
      ⏹️
    </button>
  </div>

  <!-- Hope Score Widget -->
  <div class="hope-score-widget" id="hope-score-widget" onclick="showHopeScoreModal()" title="Click to see details">
    <div>
      <div class="hope-score-number" id="hope-score-number">85</div>
      <div class="hope-score-label">Hope Score</div>
    </div>
    <div style="font-size: 1.2rem; color: var(--accent);">📊</div>
  </div>

  <!-- Wellness Controls -->
  <div class="wellness-controls">
    <button class="wellness-btn" id="music-btn" onclick="toggleMusic()" title="Ambient Music">
      🎵
      <span class="wellness-btn-tooltip">Ambient Music</span>
    </button>
    <button class="wellness-btn" id="breathing-btn" onclick="showBreathingExercise()" title="Breathing Exercise">
      🫁
      <span class="wellness-btn-tooltip">Breathing Exercise</span>
    </button>
    <button class="wellness-btn" id="theme-btn" onclick="cycleTheme()" title="Change Theme">
      🎨
      <span class="wellness-btn-tooltip">Change Theme</span>
    </button>
    <button class="wellness-btn" id="zen-btn" onclick="toggleZenMode()" title="Zen Mode">
      🧘
      <span class="wellness-btn-tooltip">Zen Mode</span>
    </button>
    <button class="wellness-btn" id="mood-btn" onclick="showMoodTracker()" title="Track Your Mood">
      😊
      <span class="wellness-btn-tooltip">Mood Tracker</span>
    </button>
  </div>

  <!-- Theme Overlays -->
  <div class="theme-overlay theme-ocean" id="theme-ocean"></div>
  <div class="theme-overlay theme-forest" id="theme-forest"></div>
  <div class="theme-overlay theme-sunset" id="theme-sunset"></div>
  <div class="theme-notification" id="theme-notification"></div>

  <!-- Breathing Exercise Modal -->
  <div class="breathing-modal" id="breathing-modal">
    <div class="breathing-circle"></div>
    <div class="breathing-text">Breathe</div>
    <div class="breathing-instruction" id="breathing-instruction">Breathe In...</div>
    <button onclick="closeBreathingExercise()" style="
      margin-top: 20px;
      padding: 10px 24px;
      background: white;
      color: #292524;
      border: none;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
    ">Close</button>
  </div>

  <!-- Mood Tracker Modal -->
  <div class="mood-modal" id="mood-modal">
    <div class="mood-content">
      <h2 style="margin-bottom: 8px;" id="mood-title">How are you feeling?</h2>
      <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 20px;" id="mood-subtitle">
        Let's check in before you start reading
      </p>
      
      <div class="mood-options" id="mood-options">
        <div class="mood-option" data-mood="stressed" onclick="selectMood('stressed')">
          😰
          <div class="mood-label">Stressed</div>
        </div>
        <div class="mood-option" data-mood="sad" onclick="selectMood('sad')">
          😢
          <div class="mood-label">Sad</div>
        </div>
        <div class="mood-option" data-mood="neutral" onclick="selectMood('neutral')">
          😐
          <div class="mood-label">Neutral</div>
        </div>
        <div class="mood-option" data-mood="good" onclick="selectMood('good')">
          🙂
          <div class="mood-label">Good</div>
        </div>
        <div class="mood-option" data-mood="happy" onclick="selectMood('happy')">
          😊
          <div class="mood-label">Happy</div>
        </div>
      </div>

      <button id="mood-submit-btn" onclick="submitMood()" style="
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #f97316, #ea580c);
        color: white;
        border: none;
        border-radius: 999px;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 16px;
        display: none;
      ">Continue</button>

      <button onclick="closeMoodTracker()" style="
        width: 100%;
        padding: 10px;
        background: transparent;
        color: #6b7280;
        border: none;
        font-size: 0.85rem;
        cursor: pointer;
        margin-top: 8px;
      ">Skip</button>
    </div>
  </div>
  
  <header class="agentic-header">
    <div class="agentic-brand">
      <div class="agentic-logo">
        <span class="agentic-logo-icon">✨</span>
      </div>
      <div class="agentic-text">
        <h1>Mahesh +ve Pill</h1>
        <p class="agentic-tagline">Signal-first news, curated with intent</p>
        <p class="agentic-subline">AI that selects • deprioritises • explains</p>
      </div>
    </div>
    
    <!-- Daily Inspiration Quote -->
    <div class="inspiration-quote" id="inspiration-quote">
      <div class="inspiration-quote-text" id="quote-text">
        "The best way to predict the future is to create it."
      </div>
      <div class="inspiration-quote-author" id="quote-author">
        — Peter Drucker
      </div>
    </div>
  </header>

  <div class="app-shell">
    <header>
      <div class="header-right">
        <nav aria-label="Main navigation">
          <a class="nav-link active" href="index.html">News Feed</a>
          <a class="nav-link" href="about.html">About</a>
          
          <!-- User Authentication -->
          <div class="auth-section" id="auth-section">
            <button class="auth-btn login-btn" id="login-btn" onclick="showLoginModal()">
              👤 Login
            </button>
            <button class="auth-btn signup-btn" id="signup-btn" onclick="showSignupModal()">
              ✨ Sign Up
            </button>
          </div>
          
          <!-- User Profile (hidden by default) -->
          <div class="user-profile" id="user-profile" style="display: none;">
            <button class="profile-btn" id="profile-btn" onclick="toggleProfileMenu()">
              <span id="user-avatar">👤</span>
              <span id="user-name">User</span>
              <span style="font-size: 0.7rem;">▼</span>
            </button>
            <div class="profile-dropdown" id="profile-dropdown">
              <a href="#" onclick="showProfileSettings()">⚙️ Settings</a>
              <a href="#" onclick="showReadingStats()">📊 My Stats</a>
              <a href="#" onclick="showPreferences()">🎯 Preferences</a>
              <a href="#" onclick="logout()">🚪 Logout</a>
            </div>
          </div>
          
          <!-- Language Selector -->
          <div class="language-selector">
            <button class="language-btn" id="language-btn" aria-label="Select language">
              <span id="current-language-flag">🌐</span>
              <span id="current-language-text">English</span>
              <span style="font-size: 0.7rem;">▼</span>
            </button>
            <div class="language-dropdown" id="language-dropdown">
              <div class="language-option active" data-lang="en" data-flag="🇬🇧">
                <span>🇬🇧</span> English
              </div>
              <div class="language-option" data-lang="hi" data-flag="🇮🇳">
                <span>🇮🇳</span> हिंदी (Hindi)
              </div>
              <div class="language-option" data-lang="ta" data-flag="🇮🇳">
                <span>🇮🇳</span> தமிழ் (Tamil)
              </div>
              <div class="language-option" data-lang="te" data-flag="🇮🇳">
                <span>🇮🇳</span> తెలుగు (Telugu)
              </div>
              <div class="language-option" data-lang="kn" data-flag="🇮🇳">
                <span>🇮🇳</span> ಕನ್ನಡ (Kannada)
              </div>
              <div class="language-option" data-lang="ml" data-flag="🇮🇳">
                <span>🇮🇳</span> മലയാളം (Malayalam)
              </div>
            </div>
          </div>
          
          <button id="pwa-install-btn" style="
            padding: 6px 12px;
            border-radius: 999px;
            border: 2px solid #f97316;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #ffffff;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.16s ease-out;
            display: none;
          ">
            📱 Install App
          </button>
        </nav>

        <div class="meta">
          <div class="pill-row">
            <div class="pill pill--accent">
              <span class="icon">✨</span>
              <span>Signal over noise. Positivity over panic.</span>
            </div>
            <div class="pill">
              <span class="icon">🕒</span>
              <span id="last-updated">Fetching latest headlines…</span>
            </div>
            <div class="pill" id="weather-widget" style="cursor: pointer; display: none;" title="Click to refresh weather">
              <span class="icon" id="weather-icon">🌤️</span>
              <span id="weather-text">Loading weather...</span>
            </div>
          </div>

          <div class="filters-bar" aria-label="Filter by topic">
            <button class="filter-chip active" data-filter="all">
              <span class="dot"></span>All
            </button>
            <button class="filter-chip" data-filter="current">
              <span class="dot"></span>Current Affairs
            </button>
            <button class="filter-chip" data-filter="ai">
              <span class="dot"></span>AI &amp; Tech
            </button>
            <button class="filter-chip" data-filter="startups">
              <span class="dot"></span>Startups
            </button>
            <button class="filter-chip" data-filter="markets">
              <span class="dot"></span>Markets
            </button>
            <button class="filter-chip" data-filter="automobiles">
              <span class="dot"></span>Automobiles
            </button>
            <button class="filter-chip" data-filter="science">
              <span class="dot"></span>Science
            </button>
            <button class="filter-chip" data-filter="space">
              <span class="dot"></span>Space
            </button>
            <button class="filter-chip" data-filter="health">
              <span class="dot"></span>Health
            </button>
            <button class="filter-chip" data-filter="environment">
              <span class="dot"></span>Environment
            </button>
            <button class="filter-chip" data-filter="politics">
              <span class="dot"></span>Politics
            </button>
            <button class="filter-chip" data-filter="sports">
              <span class="dot"></span>Sports
            </button>
            <button class="filter-chip" data-filter="culture">
              <span class="dot"></span>Culture
            </button>
            <button class="filter-chip" data-filter="design">
              <span class="dot"></span>Design
            </button>
            <button class="filter-chip" data-filter="positive">
              <span class="dot"></span>Positive News
            </button>
            <button id="refresh-btn" class="filter-chip" style="background:rgba(56,189,248,0.12);border-color:rgba(56,189,248,0.85);">
              <span class="dot"></span>Refresh
            </button>
          </div>

          <details class="sources-wrapper">
            <summary class="sources-summary">
              <span class="sources-label">
                <span class="sources-caret">▶</span>Sources
              </span>
              <span class="sources-count" id="sources-count-label">All sources (combined)</span>
            </summary>
            <div class="sources-body">
              <div class="filters-bar" id="source-filters">
                <div class="source-group">
                  <div class="source-group-title">Institutions</div>
                  <button class="filter-chip source-chip" data-source="pib">PIB</button>
                  <button class="filter-chip source-chip" data-source="rbi">RBI</button>
                  <button class="filter-chip source-chip" data-source="tbi">The Better India</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Indian News</div>
                  <button class="filter-chip source-chip" data-source="thehindu">The Hindu</button>
                  <button class="filter-chip source-chip" data-source="hindustantimes">Hindustan Times</button>
                  <button class="filter-chip source-chip" data-source="ndtv">NDTV</button>
                  <button class="filter-chip source-chip" data-source="indiatoday">India Today</button>
                  <button class="filter-chip source-chip" data-source="toi">Times of India</button>
                  <button class="filter-chip source-chip" data-source="deccanherald">Deccan Herald</button>
                  <button class="filter-chip source-chip" data-source="theprint">The Print</button>
                  <button class="filter-chip source-chip" data-source="scroll">Scroll</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">International News</div>
                  <button class="filter-chip source-chip" data-source="bbc">BBC</button>
                  <button class="filter-chip source-chip" data-source="reuters">Reuters</button>
                  <button class="filter-chip source-chip" data-source="aljazeera">Al Jazeera</button>
                  <button class="filter-chip source-chip" data-source="apnews">AP News</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Markets & Business</div>
                  <button class="filter-chip source-chip" data-source="etmarkets">ET Markets</button>
                  <button class="filter-chip source-chip" data-source="livemint">Livemint</button>
                  <button class="filter-chip source-chip" data-source="moneycontrol">Moneycontrol</button>
                  <button class="filter-chip source-chip" data-source="financialexpress">Financial Express</button>
                  <button class="filter-chip source-chip" data-source="businessstandard">Business Standard</button>
                  <button class="filter-chip source-chip" data-source="forbes">Forbes</button>
                  <button class="filter-chip source-chip" data-source="entrepreneur">Entrepreneur</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Technology & Startups</div>
                  <button class="filter-chip source-chip" data-source="ietech">IE Tech</button>
                  <button class="filter-chip source-chip" data-source="techcrunch">TechCrunch</button>
                  <button class="filter-chip source-chip" data-source="theverge">The Verge</button>
                  <button class="filter-chip source-chip" data-source="wired">Wired</button>
                  <button class="filter-chip source-chip" data-source="yourstory">YourStory</button>
                  <button class="filter-chip source-chip" data-source="hackernews">Hacker News</button>
                  <button class="filter-chip source-chip" data-source="arstechnica">Ars Technica</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Science & Research</div>
                  <button class="filter-chip source-chip" data-source="sciencedaily">Science Daily</button>
                  <button class="filter-chip source-chip" data-source="nature">Nature</button>
                  <button class="filter-chip source-chip" data-source="newscientist">New Scientist</button>
                  <button class="filter-chip source-chip" data-source="phys">Phys.org</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Space & Astronomy</div>
                  <button class="filter-chip source-chip" data-source="nasa">NASA</button>
                  <button class="filter-chip source-chip" data-source="spacenews">Space News</button>
                  <button class="filter-chip source-chip" data-source="universetoday">Universe Today</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Environment & Climate</div>
                  <button class="filter-chip source-chip" data-source="treehugger">Treehugger</button>
                  <button class="filter-chip source-chip" data-source="earthorg">Earth.org</button>
                  <button class="filter-chip source-chip" data-source="mongabay">Mongabay</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Health & Wellness</div>
                  <button class="filter-chip source-chip" data-source="healthline">Healthline</button>
                  <button class="filter-chip source-chip" data-source="medicalnews">Medical News Today</button>
                  <button class="filter-chip source-chip" data-source="webmd">WebMD</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Culture & Society</div>
                  <button class="filter-chip source-chip" data-source="smithsonian">Smithsonian</button>
                  <button class="filter-chip source-chip" data-source="theconversation">The Conversation</button>
                  <button class="filter-chip source-chip" data-source="aeon">Aeon</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Design & Creativity</div>
                  <button class="filter-chip source-chip" data-source="designboom">Designboom</button>
                  <button class="filter-chip source-chip" data-source="dezeen">Dezeen</button>
                  <button class="filter-chip source-chip" data-source="creativebloq">Creative Bloq</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Open Source & Dev</div>
                  <button class="filter-chip source-chip" data-source="opensource">Opensource.com</button>
                  <button class="filter-chip source-chip" data-source="devto">Dev.to</button>
                  <button class="filter-chip source-chip" data-source="githubtrending">GitHub Trending</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Positive News</div>
                  <button class="filter-chip source-chip" data-source="goodnewsnetwork">Good News Network</button>
                  <button class="filter-chip source-chip" data-source="positivenews">Positive News</button>
                  <button class="filter-chip source-chip" data-source="optimistdaily">Optimist Daily</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Sports</div>
                  <button class="filter-chip source-chip" data-source="iesports">IE Sports</button>
                </div>

                <div class="source-group">
                  <div class="source-group-title">Politics</div>
                  <button class="filter-chip source-chip" data-source="politics">Indian Express Politics</button>
                </div>
              </div>
            </div>
          </details>
        </div>
      </div>
    </header>

    <main>
      <section class="column" aria-label="Main news feed">
        <div class="section-title">
          <h2>Today's Highlights</h2>
          <div style="display: flex; gap: 6px; align-items: center;">
            <button id="list-view-btn" class="view-toggle-btn active" title="List View" onclick="changeView('list')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
              </svg>
            </button>
            <button id="grid-view-btn" class="view-toggle-btn" title="Grid View" onclick="changeView('grid')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
              </svg>
            </button>
            <button id="compact-view-btn" class="view-toggle-btn" title="Compact View" onclick="changeView('compact')">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <rect x="3" y="5" width="2" height="2"></rect>
                <rect x="3" y="11" width="2" height="2"></rect>
                <rect x="3" y="17" width="2" height="2"></rect>
              </svg>
            </button>
          </div>
        </div>

        <!-- Hope's Personality Message -->
        <div class="hope-message" id="hope-message">
          <div class="hope-avatar">🌟</div>
          <div class="hope-text" id="hope-text">
            Hey! I'm Hope, your AI news companion. I've found some amazing stories for you today! 💫
          </div>
        </div>

        <!-- Community Stats Banner -->
        <div class="community-banner" id="community-banner">
          <div class="community-stat">
            <div class="community-stat-number" id="global-reads">1,247,893</div>
            <div class="community-stat-label">Global Reads</div>
          </div>
          <div class="community-stat">
            <div class="community-stat-number" id="active-readers">2,341</div>
            <div class="community-stat-label">Reading Now</div>
          </div>
          <div class="community-stat">
            <div class="community-stat-number" id="hope-spread">94%</div>
            <div class="community-stat-label">Hope Spread</div>
          </div>
        </div>

        <!-- Time Capsule -->
        <div class="time-capsule" id="time-capsule" style="display: none;">
          <div class="time-capsule-title">
            <span>⏰</span>
            <span>One Year Ago Today</span>
          </div>
          <div id="time-capsule-content" style="font-size: 0.85rem; color: #78350f;">
            Loading historical positive news...
          </div>
        </div>

        <!-- Simplified Agent Note -->
        <div class="agent-note" style="padding: 10px 12px; margin-bottom: 10px;">
          <div id="agent-note-text" class="agent-note-text" style="font-size: 0.8rem;">Loading AI curator insights...</div>
        </div>

        <!-- Collapsible "What AI Ignored" Section -->
        <details style="margin-bottom: 12px; cursor: pointer;">
          <summary style="
            padding: 8px 12px;
            background: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            font-size: 0.8rem;
            color: #6b7280;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 8px;
          ">
            <span style="font-size: 0.9rem;">🧠</span>
            <span>What the AI filtered out</span>
            <span style="margin-left: auto; font-size: 0.7rem;">▼</span>
          </summary>
          <div class="agent-ignored" style="margin-top: 8px; padding: 10px 12px;">
            <ul id="ignored-list" style="font-size: 0.75rem;">
              <li>Evaluating headlines...</li>
            </ul>
          </div>
        </details>

        <div class="news-list" id="news-list">
          <p style="color:#6b7280;font-size:0.8rem;">Fetching positive stories from multiple sources…</p>
        </div>

        <div style="margin-top:12px;text-align:center;">
          <button id="load-more-btn" class="btn-primary" style="background:#e0f2fe;display:none;">
            Show more stories
          </button>
        </div>
      </section>

      <aside class="column" aria-label="Summary and quick stats">
        <!-- Support/Sponsor Card -->
        <section class="sidebar-card" style="background: linear-gradient(135deg, #fef3c7, #fed7aa); border-color: #f97316;">
          <h3 style="display: flex; align-items: center; gap: 8px;">
            ☕ Support This Project
          </h3>
          <p style="font-size:0.78rem;color:#78716c;">Help keep this ad-free and growing!</p>
          
          <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 12px;">
            <a href="https://www.buymeacoffee.com/maheshramanathan" target="_blank" rel="noopener noreferrer" style="
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              padding: 10px;
              background: #FFDD00;
              color: #000000;
              text-decoration: none;
              border-radius: 999px;
              font-weight: 600;
              font-size: 0.85rem;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              <span>☕</span> Buy Me a Coffee
            </a>
            
            <a href="https://github.com/sponsors/maheshmaheshwarr-stack" target="_blank" rel="noopener noreferrer" style="
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              padding: 10px;
              background: #ea4aaa;
              color: #ffffff;
              text-decoration: none;
              border-radius: 999px;
              font-weight: 600;
              font-size: 0.85rem;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              <span>💖</span> GitHub Sponsor
            </a>
          </div>
          
          <div style="margin-top: 12px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px; font-size: 0.75rem; color: #78716c;">
            <strong>Your support helps:</strong><br>
            • Keep the site ad-free<br>
            • Add more news sources<br>
            • Improve AI features<br>
            • Maintain servers
          </div>
        </section>

        <!-- Premium Tier Teaser -->
        <section class="sidebar-card" style="margin-top: 10px; background: linear-gradient(135deg, #292524, #44403c); color: #ffffff; border-color: #78716c;">
          <h3 style="color: #ffffff; display: flex; align-items: center; gap: 8px;">
            ⭐ Premium Coming Soon
          </h3>
          <p style="font-size:0.78rem;color: #d6d3d1;">Unlock advanced features</p>
          
          <ul style="list-style: none; padding: 0; margin: 12px 0; font-size: 0.8rem; color: #e7e5e4;">
            <li style="margin-bottom: 8px;">✨ Ad-free experience (forever)</li>
            <li style="margin-bottom: 8px;">📊 Advanced analytics & insights</li>
            <li style="margin-bottom: 8px;">🎯 Custom news filters</li>
            <li style="margin-bottom: 8px;">🔔 Priority notifications</li>
            <li style="margin-bottom: 8px;">🚀 Early access to features</li>
            <li style="margin-bottom: 8px;">💾 Export reading history</li>
          </ul>
          
          <button onclick="showPremiumModal()" style="
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #ffffff;
            border: none;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.2s;
          " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
            Join Waitlist →
          </button>
          
          <div style="margin-top: 8px; text-align: center; font-size: 0.7rem; color: #a8a29e;">
            Early bird: $2.99/month
          </div>
        </section>

        <section class="sidebar-card" style="margin-top: 10px;">
          <h3>📊 Your Reading Stats</h3>
          <p style="font-size:0.78rem;color:#78716c;">Track your news consumption habits</p>
          <ul class="sidebar-list">
            <li>Articles read today<span class="pill-mini" id="articles-read-today">0</span></li>
            <li>This week<span class="pill-mini" id="articles-read-week">0</span></li>
            <li>Favorite category<span class="pill-mini" id="favorite-category">—</span></li>
            <li>Reading streak<span class="pill-mini" id="reading-streak">0 days</span></li>
          </ul>
          <button onclick="showStatsModal()" style="
            width: 100%;
            margin-top: 8px;
            padding: 8px;
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: #ffffff;
            border: none;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
          " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
            View Detailed Stats →
          </button>
        </section>

        <!-- AI Agent Card -->
        <section class="sidebar-card" style="margin-top: 10px; background: linear-gradient(135deg, #ede9fe, #ddd6fe); border-color: #a78bfa;">
          <h3 style="display: flex; align-items: center; gap: 8px;">
            🤖 AI Agent
          </h3>
          <p style="font-size:0.78rem;color:#78716c;">Learning your preferences</p>
          
          <div id="ai-learning-stats" style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px;">
            <div style="font-size: 0.75rem; color: #78716c;">
              🌱 Building your profile...
            </div>
          </div>

          <div id="ai-agent-insight" style="
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 8px;
            font-size: 0.75rem;
            color: #292524;
            line-height: 1.4;
          ">
            🤖 AI is learning your preferences. Keep reading to get personalized recommendations!
          </div>

          <div style="display: flex; flex-direction: column; gap: 6px; margin-top: 10px;">
            <button onclick="showAIRecommendations()" style="
              width: 100%;
              padding: 8px;
              background: linear-gradient(135deg, #8b5cf6, #7c3aed);
              color: #ffffff;
              border: none;
              border-radius: 999px;
              font-size: 0.75rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              ✨ AI Recommendations
            </button>

            <button onclick="showQuickReads()" style="
              width: 100%;
              padding: 8px;
              background: linear-gradient(135deg, #06b6d4, #0891b2);
              color: #ffffff;
              border: none;
              border-radius: 999px;
              font-size: 0.75rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              ⚡ Quick Reads (< 3 min)
            </button>

            <button id="toggle-ai-learning-btn" onclick="toggleAILearning()" style="
              width: 100%;
              padding: 8px;
              background: linear-gradient(135deg, #f97316, #ea580c);
              color: #ffffff;
              border: none;
              border-radius: 999px;
              font-size: 0.75rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s;
            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
              🤖 AI Learning: ON
            </button>
          </div>

          <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.7); border-radius: 8px;">
            <div style="font-size: 0.7rem; color: #78716c; margin-bottom: 6px; font-weight: 600;">Mood Preference:</div>
            <div style="display: flex; gap: 4px;">
              <button class="mood-btn active" data-mood="uplifting" onclick="changeMoodPreference('uplifting')" style="
                flex: 1;
                padding: 6px;
                background: #fed7aa;
                border: 2px solid #f97316;
                border-radius: 8px;
                font-size: 0.65rem;
                cursor: pointer;
                transition: all 0.2s;
              ">😊 Uplifting</button>
              <button class="mood-btn" data-mood="balanced" onclick="changeMoodPreference('balanced')" style="
                flex: 1;
                padding: 6px;
                background: #e5e7eb;
                border: 2px solid transparent;
                border-radius: 8px;
                font-size: 0.65rem;
                cursor: pointer;
                transition: all 0.2s;
              ">⚖️ Balanced</button>
              <button class="mood-btn" data-mood="serious" onclick="changeMoodPreference('serious')" style="
                flex: 1;
                padding: 6px;
                background: #e5e7eb;
                border: 2px solid transparent;
                border-radius: 8px;
                font-size: 0.65rem;
                cursor: pointer;
                transition: all 0.2s;
              ">📰 Serious</button>
            </div>
          </div>
        </section>

        <section class="sidebar-card" style="margin-top: 10px;">
          <h3>Today's Mood</h3>
          <p>A quick snapshot of why today's feed is net-positive.</p>
          <ul class="sidebar-list">
            <li>Net positive impact<span class="pill-mini" id="positive-count">0 stories</span></li>
            <li>Focus on AI / tech<span class="pill-mini">Key stories</span></li>
            <li>Personal relevance<span class="pill-mini">Custom curated</span></li>
          </ul>

          <div class="positivity-meter" aria-label="Overall positivity of today's feed">
            <div class="positivity-meter-header">
              <span>Positivity meter</span>
              <span id="positivity-percent">–</span>
            </div>
            <div class="positivity-bar">
              <div class="positivity-bar-fill" id="positivity-bar-fill"></div>
            </div>
          </div>
        </section>

        <section class="sidebar-card" style="margin-top: 10px;">
          <h3>Visitor Feedback</h3>
          <p style="font-size:0.78rem;color:#6b7280;">Tell me who you are and how this news feed feels.</p>
          <form id="feedback-form" style="display:flex;flex-direction:column;gap:6px;margin-top:4px;">
            <input id="feedback-name" class="input" type="text" placeholder="Your name (optional)" autocomplete="name" />
            <textarea id="feedback-text" class="textarea" placeholder="Any feedback or suggestions…"></textarea>
            <button type="submit" class="btn-primary" id="feedback-submit">
              <span>Send feedback</span> <span>📨</span>
            </button>
          </form>
          <div id="feedback-status" class="feedback-status"></div>
        </section>

        <!-- AI Curation Info Section -->
        <section class="sidebar-card" style="margin-top: 16px; border-color: var(--accent);">
          <h3 style="display: flex; align-items: center; gap: 8px; color: var(--accent-strong);">
            🤖 AI-Powered Curation
          </h3>
          <p style="font-size: 0.875rem; color: var(--text-muted);">How we filter signal from noise</p>
          
          <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
            <!-- AI Feature 1 -->
            <div style="
              padding: 16px;
              background: var(--bg-soft);
              border-radius: var(--radius-lg);
              border-left: 3px solid var(--accent);
            ">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 1.1rem;">📊</span>
                <div style="font-weight: 600; font-size: 0.875rem; color: var(--text-main);">Sentiment Analysis</div>
              </div>
              <p style="font-size: 0.8rem; color: var(--text-muted); line-height: 1.5;">
                Every article is analyzed for positivity and constructiveness before reaching your feed.
              </p>
            </div>

            <!-- AI Feature 2 -->
            <div style="
              padding: 16px;
              background: var(--bg-soft);
              border-radius: var(--radius-lg);
              border-left: 3px solid var(--accent);
            ">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 1.1rem;">🎯</span>
                <div style="font-weight: 600; font-size: 0.875rem; color: var(--text-main);">Quality Filtering</div>
              </div>
              <p style="font-size: 0.8rem; color: var(--text-muted); line-height: 1.5;">
                AI evaluates article credibility, depth, and journalistic quality automatically.
              </p>
            </div>

            <!-- AI Feature 3 -->
            <div style="
              padding: 16px;
              background: var(--bg-soft);
              border-radius: var(--radius-lg);
              border-left: 3px solid var(--accent);
            ">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 1.1rem;">✨</span>
                <div style="font-weight: 600; font-size: 0.875rem; color: var(--text-main);">Personalization</div>
              </div>
              <p style="font-size: 0.8rem; color: var(--text-muted); line-height: 1.5;">
                Content adapts to your preferences and reading habits for a tailored experience.
              </p>
            </div>
          </div>

          <button onclick="showAIDetails()" style="
            width: 100%;
            margin-top: 16px;
            padding: 12px;
            background: var(--gradient-primary);
            color: #ffffff;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
          " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='var(--shadow-medium)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
            Learn More About AI Curation →
          </button>
        </section>
      </aside>
    </main>

    <!-- Multimedia Section -->
    <section class="multimedia-section">
      <div style="margin-bottom: 16px;">
        <h2 style="font-size: 1.3rem; font-weight: 600; color: #292524; margin-bottom: 6px;">
          🎬 Multimedia News Experience
        </h2>
        <p style="font-size: 0.85rem; color: #78716c;">
          Explore news through images, videos, podcasts, and infographics
        </p>
      </div>

      <div class="multimedia-tabs">
        <button class="multimedia-tab active" onclick="switchMultimediaTab('gallery')">
          <span>🖼️</span> Image Gallery
        </button>
        <button class="multimedia-tab" onclick="switchMultimediaTab('videos')">
          <span>📹</span> Video News
        </button>
        <button class="multimedia-tab" onclick="switchMultimediaTab('podcasts')">
          <span>🎙️</span> Podcasts
        </button>
        <button class="multimedia-tab" onclick="switchMultimediaTab('infographics')">
          <span>📊</span> Infographics
        </button>
      </div>

      <!-- Image Gallery -->
      <div id="gallery-content" class="multimedia-content active">
        <div class="gallery-grid" id="gallery-grid">
          <p style="color: #78716c; font-size: 0.85rem;">Loading visual stories...</p>
        </div>
      </div>

      <!-- Video News -->
      <div id="videos-content" class="multimedia-content">
        <div class="video-grid" id="video-grid">
          <!-- Videos will be populated here -->
        </div>
      </div>

      <!-- Podcasts -->
      <div id="podcasts-content" class="multimedia-content">
        <div class="podcast-list" id="podcast-list">
          <!-- Podcasts will be populated here -->
        </div>
      </div>

      <!-- Infographics -->
      <div id="infographics-content" class="multimedia-content">
        <div class="infographic-grid" id="infographic-grid">
          <!-- Infographics will be populated here -->
        </div>
      </div>
    </section>

    <!-- Recommended Resources (Affiliate Section) -->
    <section class="multimedia-section" style="margin-top: 16px;">
      <div style="margin-bottom: 16px;">
        <h2 style="font-size: 1.3rem; font-weight: 600; color: #292524; margin-bottom: 6px;">
          📚 Recommended Resources
        </h2>
        <p style="font-size: 0.85rem; color: #78716c;">
          Curated books, courses, and tools to deepen your understanding
        </p>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px;">
        <!-- Book Recommendations -->
        <div style="
          padding: 16px;
          background: #ffffff;
          border: 2px solid #fed7aa;
          border-radius: 16px;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="font-size: 1.5rem; margin-bottom: 8px;">📖</div>
          <h3 style="font-size: 1rem; font-weight: 600; color: #292524; margin-bottom: 8px;">
            The Signal and the Noise
          </h3>
          <p style="font-size: 0.8rem; color: #78716c; margin-bottom: 12px;">
            By Nate Silver - Learn to distinguish signal from noise in data and news
          </p>
          <a href="https://www.amazon.com/Signal-Noise-Many-Predictions-Fail-but/dp/0143125087?&linkCode=ll1&tag=maheshnews-20" 
             target="_blank" 
             rel="noopener noreferrer sponsored"
             style="
               display: inline-block;
               padding: 8px 16px;
               background: #f97316;
               color: #ffffff;
               text-decoration: none;
               border-radius: 999px;
               font-size: 0.8rem;
               font-weight: 600;
               transition: background 0.2s;
             "
             onmouseover="this.style.background='#ea580c'"
             onmouseout="this.style.background='#f97316'">
            View on Amazon →
          </a>
          <div style="margin-top: 8px; font-size: 0.7rem; color: #a8a29e;">
            Affiliate link - supports this project
          </div>
        </div>

        <!-- Course Recommendation -->
        <div style="
          padding: 16px;
          background: #ffffff;
          border: 2px solid #fed7aa;
          border-radius: 16px;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="font-size: 1.5rem; margin-bottom: 8px;">🎓</div>
          <h3 style="font-size: 1rem; font-weight: 600; color: #292524; margin-bottom: 8px;">
            AI for Everyone
          </h3>
          <p style="font-size: 0.8rem; color: #78716c; margin-bottom: 12px;">
            By Andrew Ng on Coursera - Understand AI without coding
          </p>
          <a href="https://www.coursera.org/learn/ai-for-everyone" 
             target="_blank" 
             rel="noopener noreferrer"
             style="
               display: inline-block;
               padding: 8px 16px;
               background: #f97316;
               color: #ffffff;
               text-decoration: none;
               border-radius: 999px;
               font-size: 0.8rem;
               font-weight: 600;
               transition: background 0.2s;
             "
             onmouseover="this.style.background='#ea580c'"
             onmouseout="this.style.background='#f97316'">
            Enroll Free →
          </a>
          <div style="margin-top: 8px; font-size: 0.7rem; color: #a8a29e;">
            Free to audit
          </div>
        </div>

        <!-- Tool Recommendation -->
        <div style="
          padding: 16px;
          background: #ffffff;
          border: 2px solid #fed7aa;
          border-radius: 16px;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
          <div style="font-size: 1.5rem; margin-bottom: 8px;">🛠️</div>
          <h3 style="font-size: 1rem; font-weight: 600; color: #292524; margin-bottom: 8px;">
            Feedly Pro
          </h3>
          <p style="font-size: 0.8rem; color: #78716c; margin-bottom: 12px;">
            Advanced RSS reader with AI-powered insights and filtering
          </p>
          <a href="https://feedly.com/" 
             target="_blank" 
             rel="noopener noreferrer"
             style="
               display: inline-block;
               padding: 8px 16px;
               background: #f97316;
               color: #ffffff;
               text-decoration: none;
               border-radius: 999px;
               font-size: 0.8rem;
               font-weight: 600;
               transition: background 0.2s;
             "
             onmouseover="this.style.background='#ea580c'"
             onmouseout="this.style.background='#f97316'">
            Try Feedly →
          </a>
          <div style="margin-top: 8px; font-size: 0.7rem; color: #a8a29e;">
            Free plan available
          </div>
        </div>
      </div>

      <div style="margin-top: 16px; padding: 12px; background: #fff8ed; border-radius: 8px; border-left: 3px solid #f97316; font-size: 0.8rem; color: #78716c;">
        <strong>💡 Transparency Note:</strong> Some links above are affiliate links. If you purchase through them, we may earn a small commission at no extra cost to you. This helps keep the site ad-free and supports development. We only recommend products we genuinely believe in.
      </div>
    </section>

    <footer>
      <span>Built for a calm information diet. Tweak this page as your interests evolve.</span>
      <div class="footer-badges">
        <span class="footer-badge">🌱 Growth-focused</span>
        <span class="footer-badge">📚 Curated, not addictive</span>
        <span class="footer-badge">🤖 AI, markets, sport &amp; more</span>
        <span class="footer-badge">🇮🇳 Built in India</span>
        <span class="footer-badge" style="background: linear-gradient(135deg, #f97316, #ea580c); color: #ffffff; border-color: #f97316;">� Installable PWA</span>
        <span class="footer-badge" style="background: linear-gradient(135deg, #f97316, #ea580c); color: #ffffff; border-color: #f97316;">💬 Community Discussions</span>
      </div>

      <div style="width:100%;text-align:center;margin-top:8px;font-size:0.7rem;color:#6b7280;">
        <a href="#" id="privacy-link">Privacy</a>
        <span style="margin:0 8px;">•</span>
        <a href="#" id="terms-link">Terms</a>
        <span style="margin:0 8px;">•</span>
        <a href="https://wa.me/?text=Check%20out%20this%20AI-powered%20news%20dashboard%20that%20filters%20panic%20and%20highlights%20positivity!%20%F0%9F%A7%A0%E2%9C%A8%20https://maheshmaheshwarr-stack.github.io/Dashboard1/" 
           target="_blank"
           rel="noopener noreferrer"
           style="color:#25D366;font-weight:600;">
          📱 Share on WhatsApp
        </a>
      </div>

      <div style="width:100%;text-align:center;margin-top:4px;font-size:0.7rem;color:#9ca3af;">
        © <span id="copyright-year"></span> Mahesh Ramanathan — All rights reserved.
      </div>
    </footer>
  </div>

  <!-- Community Discussion Section -->
  <div id="discussion-section" style="
    width: 100%;
    max-width: 1100px;
    margin: 24px auto;
    padding: 24px;
    background: #ffffff;
    border-radius: 28px;
    box-shadow: 0 20px 40px rgba(15, 23, 42, 0.08);
    border: 1px solid #e5e7eb;
  ">
    <div style="margin-bottom: 16px;">
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
        <h2 style="
          font-size: 1.2rem;
          font-weight: 600;
          color: #0f172a;
          margin: 0;
        ">💬 Community Discussion</h2>
        <span style="
          padding: 4px 10px;
          background: linear-gradient(135deg, #f97316, #ea580c);
          color: #ffffff;
          font-size: 0.7rem;
          font-weight: 700;
          border-radius: 999px;
          text-transform: uppercase;
          letter-spacing: 0.05em;
        ">New Feature</span>
      </div>
      <p style="
        font-size: 0.85rem;
        color: #6b7280;
        line-height: 1.5;
      ">
        Share your thoughts, discuss today's news, and collaborate with other readers. 
        Sign in with GitHub to join the conversation.
      </p>
    </div>
    
    <!-- Giscus Comments -->
    <script src="https://giscus.app/client.js"
            data-repo="maheshmaheshwarr-stack/Dashboard1"
            data-repo-id="R_kgDOQhtkgg"
            data-category="General"
            data-category-id="DIC_kwDOQhtkgs4C07hu"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="light"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
    </script>
  </div>

  <!-- Floating Discussion Button -->
  <button class="floating-discussion-btn" onclick="document.getElementById('discussion-section').scrollIntoView({behavior: 'smooth'})">
    <span>💬</span>
    <span>Join Discussion</span>
    <span class="badge-new">New</span>
  </button>

  <!-- Privacy Modal -->
  <div class="modal" id="privacy-modal">
    <div class="modal-content">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2>Privacy Policy</h2>
      <p>Mahesh Positive News Feed respects your privacy.</p>
      <ul>
        <li>No personal data is collected by default.</li>
        <li>No tracking cookies are used.</li>
        <li>News content is fetched from public RSS sources.</li>
        <li>All processing happens in your browser.</li>
      </ul>
      <p>This site is provided "as is" without guarantees of accuracy or availability.</p>
    </div>
  </div>

  <!-- Terms Modal -->
  <div class="modal" id="terms-modal">
    <div class="modal-content">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2>Terms of Use</h2>
      <ul>
        <li>This site is for informational purposes only.</li>
        <li>News summaries and positivity scores are automated and may be imperfect.</li>
        <li>External links lead to third-party websites over which we have no control.</li>
        <li>You agree not to misuse or attempt to disrupt the service.</li>
        <li>Content is provided without warranties of any kind.</li>
      </ul>
      <p>By using this site, you accept these terms.</p>
    </div>
  </div>

  <!-- Premium Waitlist Modal -->
  <div class="modal" id="premium-modal">
    <div class="modal-content" style="max-width: 540px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
        <span>⭐</span> Premium Features Coming Soon
      </h2>
      
      <div style="background: linear-gradient(135deg, #fef3c7, #fed7aa); padding: 16px; border-radius: 12px; margin-bottom: 16px;">
        <div style="font-size: 2rem; font-weight: 700; color: #ea580c; margin-bottom: 4px;">
          $2.99<span style="font-size: 1rem; font-weight: 400; color: #78716c;">/month</span>
        </div>
        <div style="font-size: 0.85rem; color: #78716c;">
          Early bird pricing - Lock in this rate forever!
        </div>
      </div>

      <div style="margin-bottom: 20px;">
        <h3 style="font-size: 1rem; margin-bottom: 12px;">What You'll Get:</h3>
        <ul style="list-style: none; padding: 0; display: flex; flex-direction: column; gap: 10px;">
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">✨</span>
            <div>
              <strong>Ad-Free Forever</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">No ads, no distractions, pure news</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">📊</span>
            <div>
              <strong>Advanced Analytics</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Deep insights into your reading habits</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">🎯</span>
            <div>
              <strong>Custom Filters</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Create your own news categories</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">🔔</span>
            <div>
              <strong>Priority Notifications</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Get alerts for topics you care about</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">🚀</span>
            <div>
              <strong>Early Access</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Try new features before everyone else</span>
            </div>
          </li>
          <li style="display: flex; align-items: start; gap: 10px;">
            <span style="color: #f97316; font-size: 1.2rem;">💾</span>
            <div>
              <strong>Export Data</strong><br>
              <span style="font-size: 0.8rem; color: #78716c;">Download your reading history anytime</span>
            </div>
          </li>
        </ul>
      </div>

      <form id="premium-waitlist-form" style="display: flex; flex-direction: column; gap: 12px;">
        <input 
          type="email" 
          id="premium-email" 
          placeholder="Enter your email" 
          required
          style="
            padding: 12px;
            border: 2px solid #fed7aa;
            border-radius: 8px;
            font-size: 0.9rem;
            outline: none;
          "
        />
        <button type="submit" style="
          padding: 12px;
          background: linear-gradient(135deg, #f97316, #ea580c);
          color: #ffffff;
          border: none;
          border-radius: 999px;
          font-weight: 600;
          font-size: 0.9rem;
          cursor: pointer;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
          Join Waitlist - Get Notified! 🎉
        </button>
      </form>

      <div id="premium-waitlist-status" style="margin-top: 12px; text-align: center; font-size: 0.85rem;"></div>

      <div style="margin-top: 16px; padding: 12px; background: #fff8ed; border-radius: 8px; font-size: 0.75rem; color: #78716c; text-align: center;">
        <strong>100% Money-Back Guarantee</strong><br>
        Not satisfied? Get a full refund within 30 days, no questions asked.
      </div>
    </div>
  </div>

  <!-- Reading Stats Modal -->
  <div class="modal" id="stats-modal">
    <div class="modal-content" style="max-width: 640px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px;">
        📊 Your Reading Statistics
      </h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin: 16px 0;">
        <div style="padding: 16px; background: #fff8ed; border: 2px solid #fed7aa; border-radius: 12px; text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #ea580c;" id="modal-total-read">0</div>
          <div style="font-size: 0.75rem; color: #78716c; margin-top: 4px;">Total Articles Read</div>
        </div>
        <div style="padding: 16px; background: #fff8ed; border: 2px solid #fed7aa; border-radius: 12px; text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #ea580c;" id="modal-week-read">0</div>
          <div style="font-size: 0.75rem; color: #78716c; margin-top: 4px;">This Week</div>
        </div>
        <div style="padding: 16px; background: #fff8ed; border: 2px solid #fed7aa; border-radius: 12px; text-align: center;">
          <div style="font-size: 2rem; font-weight: 700; color: #ea580c;" id="modal-streak">0</div>
          <div style="font-size: 0.75rem; color: #78716c; margin-top: 4px;">Day Streak 🔥</div>
        </div>
      </div>

      <div style="margin: 20px 0;">
        <h3 style="font-size: 1rem; margin-bottom: 12px;">📚 Reading by Category</h3>
        <div id="category-breakdown" style="display: flex; flex-direction: column; gap: 8px;">
          <!-- Will be populated by JS -->
        </div>
      </div>

      <div style="margin: 20px 0;">
        <h3 style="font-size: 1rem; margin-bottom: 12px;">📰 Reading by Source</h3>
        <div id="source-breakdown" style="display: flex; flex-direction: column; gap: 8px;">
          <!-- Will be populated by JS -->
        </div>
      </div>

      <div style="margin: 20px 0; padding: 12px; background: #fff8ed; border-radius: 8px; border-left: 3px solid #f97316;">
        <strong>💡 Insight:</strong> <span id="reading-insight">Keep reading to unlock insights!</span>
      </div>

      <button onclick="resetStats()" style="
        width: 100%;
        padding: 10px;
        background: #fed7aa;
        color: #9a3412;
        border: 2px solid #fed7aa;
        border-radius: 999px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 12px;
      ">
        Reset Statistics
      </button>
    </div>
  </div>

  <!-- AI Recommendations Modal -->
  <div class="modal" id="ai-recommendations-modal">
    <div class="modal-content" style="max-width: 600px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px;">
        ✨ AI Recommendations
      </h2>
      <p style="font-size: 0.85rem; color: #78716c; margin-bottom: 16px;">
        Based on your reading patterns, here are articles you might enjoy:
      </p>
      
      <div id="ai-recommendations-list" style="max-height: 400px; overflow-y: auto;">
        <!-- Will be populated by JS -->
      </div>
    </div>
  </div>

  <!-- Quick Reads Modal -->
  <div class="modal" id="quick-reads-modal">
    <div class="modal-content" style="max-width: 600px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px;">
        ⚡ Quick Reads
      </h2>
      <p style="font-size: 0.85rem; color: #78716c; margin-bottom: 16px;">
        Short articles you can read in under 3 minutes:
      </p>
      
      <div id="quick-reads-list" style="max-height: 400px; overflow-y: auto;">
        <!-- Will be populated by JS -->
      </div>
    </div>
  </div>

  <!-- AI Details Modal -->
  <div class="modal" id="ai-details-modal">
    <div class="modal-content" style="max-width: 700px;">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h2 style="display: flex; align-items: center; gap: 8px; color: #0ea5e9;">
        🤖 AI-Powered Curation System
      </h2>
      <p style="font-size: 0.9rem; color: #075985; margin-bottom: 20px;">
        Deep dive into how our AI filters signal from noise
      </p>
      
      <div style="display: flex; flex-direction: column; gap: 20px;">
        <!-- Sentiment Analysis Section -->
        <div style="padding: 16px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px; border-left: 4px solid #0ea5e9;">
          <h3 style="display: flex; align-items: center; gap: 8px; color: #0c4a6e; margin-bottom: 12px;">
            📊 Sentiment Analysis Engine
          </h3>
          <p style="font-size: 0.85rem; color: #0f172a; line-height: 1.6; margin-bottom: 12px;">
            Our AI analyzes every article's emotional tone and constructiveness using advanced natural language processing:
          </p>
          <ul style="font-size: 0.8rem; color: #374151; line-height: 1.5; margin-left: 20px;">
            <li><strong>Positivity Scoring:</strong> Measures constructive vs. destructive language patterns</li>
            <li><strong>Solution Focus:</strong> Identifies articles that propose solutions rather than just problems</li>
            <li><strong>Emotional Impact:</strong> Filters content that promotes anxiety or fear-based engagement</li>
            <li><strong>Context Awareness:</strong> Understands nuanced topics that may be serious but constructive</li>
          </ul>
        </div>

        <!-- Quality Filtering Section -->
        <div style="padding: 16px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px; border-left: 4px solid #0ea5e9;">
          <h3 style="display: flex; align-items: center; gap: 8px; color: #0c4a6e; margin-bottom: 12px;">
            🎯 Quality Assessment Algorithm
          </h3>
          <p style="font-size: 0.85rem; color: #0f172a; line-height: 1.6; margin-bottom: 12px;">
            Multi-factor analysis ensures only high-quality journalism reaches your feed:
          </p>
          <ul style="font-size: 0.8rem; color: #374151; line-height: 1.5; margin-left: 20px;">
            <li><strong>Source Credibility:</strong> Evaluates publisher reputation and journalistic standards</li>
            <li><strong>Content Depth:</strong> Prioritizes in-depth analysis over surface-level reporting</li>
            <li><strong>Fact Density:</strong> Measures information value vs. opinion or speculation</li>
            <li><strong>Clickbait Detection:</strong> Filters out sensationalized headlines and engagement bait</li>
          </ul>
        </div>

        <!-- Personalization Section -->
        <div style="padding: 16px; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 12px; border-left: 4px solid #0ea5e9;">
          <h3 style="display: flex; align-items: center; gap: 8px; color: #0c4a6e; margin-bottom: 12px;">
            ✨ Adaptive Personalization
          </h3>
          <p style="font-size: 0.85rem; color: #0f172a; line-height: 1.6; margin-bottom: 12px;">
            The system learns your preferences while maintaining editorial integrity:
          </p>
          <ul style="font-size: 0.8rem; color: #374151; line-height: 1.5; margin-left: 20px;">
            <li><strong>Reading Patterns:</strong> Adapts to your preferred topics and article lengths</li>
            <li><strong>Engagement Signals:</strong> Learns from your reading behavior and time spent</li>
            <li><strong>Mood Preferences:</strong> Adjusts content mix based on your selected mood settings</li>
            <li><strong>Diversity Balance:</strong> Ensures exposure to varied perspectives and topics</li>
          </ul>
        </div>

        <!-- Technical Implementation -->
        <div style="padding: 16px; background: linear-gradient(135deg, #fef3c7, #fed7aa); border-radius: 12px; border-left: 4px solid #f97316;">
          <h3 style="display: flex; align-items: center; gap: 8px; color: #9a3412; margin-bottom: 12px;">
            ⚙️ Technical Implementation
          </h3>
          <p style="font-size: 0.85rem; color: #292524; line-height: 1.6; margin-bottom: 12px;">
            Built with enterprise-grade architecture for reliability and scale:
          </p>
          <ul style="font-size: 0.8rem; color: #44403c; line-height: 1.5; margin-left: 20px;">
            <li><strong>Real-time Processing:</strong> Node.js backend processes 15+ RSS feeds continuously</li>
            <li><strong>AI APIs Integration:</strong> Leverages multiple AI services for comprehensive analysis</li>
            <li><strong>Caching Strategy:</strong> Optimized performance with intelligent content caching</li>
            <li><strong>Scalable Architecture:</strong> MongoDB database designed for growth and reliability</li>
          </ul>
        </div>

        <!-- Ethics & Transparency -->
        <div style="padding: 16px; background: linear-gradient(135deg, #ecfdf5, #d1fae5); border-radius: 12px; border-left: 4px solid #10b981;">
          <h3 style="display: flex; align-items: center; gap: 8px; color: #065f46; margin-bottom: 12px;">
            🛡️ Ethics & Transparency
          </h3>
          <p style="font-size: 0.85rem; color: #0f172a; line-height: 1.6; margin-bottom: 12px;">
            Our AI curation follows strict ethical guidelines:
          </p>
          <ul style="font-size: 0.8rem; color: #374151; line-height: 1.5; margin-left: 20px;">
            <li><strong>No Censorship:</strong> Filters for quality and constructiveness, not viewpoints</li>
            <li><strong>Source Diversity:</strong> Maintains balanced representation across publishers</li>
            <li><strong>Transparency:</strong> Users can see why articles were selected or filtered</li>
            <li><strong>Human Oversight:</strong> Regular auditing ensures AI decisions align with values</li>
          </ul>
        </div>
      </div>

      <div style="margin-top: 24px; padding: 16px; background: #f8fafc; border-radius: 12px; text-align: center;">
        <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 12px;">
          Questions about our AI system? Want to suggest improvements?
        </p>
        <button onclick="toggleAIChat()" style="
          padding: 10px 20px;
          background: linear-gradient(135deg, #0ea5e9, #0284c7);
          color: white;
          border: none;
          border-radius: 999px;
          font-weight: 600;
          font-size: 0.85rem;
          cursor: pointer;
          transition: transform 0.2s;
        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
          💬 Chat with Hope AI →
        </button>
      </div>
    </div>
  </div>



  <!-- AI News Chat Widget - Professional Design -->
  <div id="chat-widget" style="
    position: fixed;
    bottom: 24px;
    right: 24px;
    width: 380px;
    max-width: 90vw;
    background: var(--bg);
    border-radius: var(--radius-lg);
    border: 1px solid var(--card-border);
    box-shadow: var(--shadow-strong);
    font-size: 0.875rem;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    z-index: 9999;
    backdrop-filter: blur(8px);
  ">
    <div id="chat-header" style="
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--gradient-primary);
      cursor: pointer;
      border-bottom: none;
    ">
      <div style="display: flex; align-items: center; gap: 12px;">
        <div style="
          width: 40px;
          height: 40px;
          background: rgba(255,255,255,0.2);
          border-radius: var(--radius-md);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.2rem;
          backdrop-filter: blur(4px);
        ">🤖</div>
        <div>
          <div style="font-size:0.95rem;font-weight:600;color:#ffffff;">AI Assistant</div>
          <div style="font-size:0.75rem;color:rgba(255,255,255,0.8);margin-top:2px;">News & Analysis Support</div>
        </div>
      </div>
      <button id="chat-toggle" style="
        background:rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        color:#ffffff;
        font-size:1rem;
        cursor:pointer;
        width:32px;
        height:32px;
        display:flex;
        align-items:center;
        justify-content:center;
        border-radius: var(--radius-sm);
        transition: all 0.2s;
      " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">−</button>
    </div>
    
    <div id="chat-body" style="
      display:flex;
      flex-direction:column;
      height:400px;
      background: var(--bg-soft);
    ">
      <div id="chat-messages" style="
        flex:1;
        padding:16px;
        overflow-y:auto;
        display:flex;
        flex-direction:column;
        gap:12px;
      ">
        <div style="
          align-self:flex-start;
          max-width:85%;
          padding:12px 16px;
          border-radius: var(--radius-md);
          background: var(--accent);
          color:#ffffff;
          font-size:0.875rem;
          line-height:1.5;
          box-shadow: var(--shadow-soft);
        ">
          <div style="font-weight: 600; margin-bottom: 6px;">👋 AI Assistant</div>
          I'm here to help you explore today's curated news. Ask me anything like:
          <div style="margin-top: 8px; font-size: 0.8rem; opacity: 0.9;">
            • "What's the most important story?"<br>
            • "Show me technology news"<br>
            • "Explain this article's significance"<br>
            • "What are the key insights today?"
          </div>
        </div>
      </div>
      
      <form id="chat-form" onsubmit="return false;" style="
        display:flex;
        padding:16px;
        gap:12px;
        border-top: 1px solid var(--card-border);
        background: var(--bg);
      ">
        <input
          id="chat-input"
          type="text"
          placeholder="Ask about today's news..."
          style="
            flex:1;
            background: var(--bg-soft);
            border: 1px solid var(--card-border);
            border-radius: var(--radius-md);
            padding:10px 14px;
            color: var(--text-main);
            font-size:0.875rem;
            outline:none;
            transition: border-color 0.2s;
          "
          onfocus="this.style.borderColor='var(--accent)'"
          onblur="this.style.borderColor='var(--card-border)'"
        />
        <button type="submit" style="
          border:none;
          border-radius: var(--radius-md);
          padding:10px 16px;
          background: var(--gradient-primary);
          color:#ffffff;
          font-weight:600;
          font-size:0.875rem;
          cursor:pointer;
          transition: all 0.2s;
          box-shadow: var(--shadow-soft);
        " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='var(--shadow-medium)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-soft)'">Send</button>
      </form>
    </div>
  </div>

  <style>
    @keyframes slideIn {
      from {
        transform: translateY(8px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  </style>

  <!-- Keyboard Shortcuts Modal -->
  <div class="keyboard-shortcuts-modal" id="shortcuts-modal">
    <div class="shortcuts-content">
      <h2 style="margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between;">
        <span>⌨️ Keyboard Shortcuts</span>
        <button class="modal-close" onclick="document.getElementById('shortcuts-modal').classList.remove('show')" aria-label="Close">&times;</button>
      </h2>
      
      <div class="shortcut-item">
        <span>Show this help</span>
        <span class="shortcut-key">?</span>
      </div>
      <div class="shortcut-item">
        <span>Refresh news feed</span>
        <span class="shortcut-key">R</span>
      </div>
      <div class="shortcut-item">
        <span>Read articles aloud</span>
        <span class="shortcut-key">Alt + R</span>
      </div>
      <div class="shortcut-item">
        <span>Stop reading</span>
        <span class="shortcut-key">Alt + S</span>
      </div>
      <div class="shortcut-item">
        <span>View reading stats</span>
        <span class="shortcut-key">S</span>
      </div>
      <div class="shortcut-item">
        <span>Jump to discussions</span>
        <span class="shortcut-key">D</span>
      </div>
      <div class="shortcut-item">
        <span>Print page</span>
        <span class="shortcut-key">Ctrl/Cmd + P</span>
      </div>
      <div class="shortcut-item">
        <span>Filter: All</span>
        <span class="shortcut-key">1</span>
      </div>
      <div class="shortcut-item">
        <span>Filter: Current Affairs</span>
        <span class="shortcut-key">2</span>
      </div>
      <div class="shortcut-item">
        <span>Filter: AI & Tech</span>
        <span class="shortcut-key">3</span>
      </div>
      <div class="shortcut-item">
        <span>Filter: Markets</span>
        <span class="shortcut-key">4</span>
      </div>
      
      <p style="margin-top: 16px; font-size: 0.8rem; color: #78716c; text-align: center;">
        Press <strong>Esc</strong> to close this dialog
      </p>
    </div>
  </div>

  <script>
    // ======================
    // CONFIGURATION
    // ======================
    const CONFIG = {
      FEEDBACK_EMAIL: "mahesh.maheshwarr@gmail.com",
      INITIAL_VISIBLE_COUNT: 8,
      LOAD_MORE_COUNT: 6,
      RSS_API_BASE: "https://api.rss2json.com/v1/api.json?rss_url="
    };

    // Language-specific RSS Feeds
    const RSS_FEEDS = {
      en: {
        // Existing English feeds
        tbi: "https://www.thebetterindia.com/feed/",
        pib: "https://pib.gov.in/rss.aspx",
        rbi: "https://rbi.org.in/Scripts/Rss.aspx",
        ietech: "https://indianexpress.com/section/technology/feed/",
        politics: "https://indianexpress.com/section/india/politics/feed/",
        iesports: "https://indianexpress.com/section/sports/feed/",
        etmarkets: "https://economictimes.indiatimes.com/markets/rssfeeds/1977021501.cms",
        livemint: "https://www.livemint.com/rss/markets",
        moneycontrol: "https://www.moneycontrol.com/rss/MCtopnews.xml",
        autocarindia: "https://www.autocarindia.com/RSS/rss.ashx?type=all",
        teambhp: "https://www.team-bhp.com/forum/external.php?type=RSS2",
        
        // Indian News Sources
        thehindu: "https://www.thehindu.com/feeder/default.rss",
        hindustantimes: "https://www.hindustantimes.com/feeds/rss/india-news/rssfeed.xml",
        ndtv: "https://feeds.feedburner.com/ndtvnews-top-stories",
        indiatoday: "https://www.indiatoday.in/rss/1206578",
        toi: "https://timesofindia.indiatimes.com/rssfeedstopstories.cms",
        
        // Technology & Startups
        techcrunch: "https://techcrunch.com/feed/",
        theverge: "https://www.theverge.com/rss/index.xml",
        wired: "https://www.wired.com/feed/rss",
        yourstory: "https://yourstory.com/feed",
        hackernews: "https://hnrss.org/frontpage",
        arstechnica: "https://feeds.arstechnica.com/arstechnica/index",
        
        // International News
        bbc: "http://feeds.bbci.co.uk/news/rss.xml",
        reuters: "https://www.reutersagency.com/feed/",
        aljazeera: "https://www.aljazeera.com/xml/rss/all.xml",
        apnews: "https://rsshub.app/apnews/topics/apf-topnews",
        
        // Business & Markets
        financialexpress: "https://www.financialexpress.com/feed/",
        businessstandard: "https://www.business-standard.com/rss/home_page_top_stories.rss",
        forbes: "https://www.forbes.com/innovation/feed2/",
        entrepreneur: "https://www.entrepreneur.com/latest.rss",
        
        // Science & Research
        sciencedaily: "https://www.sciencedaily.com/rss/all.xml",
        nature: "https://www.nature.com/nature.rss",
        newscientist: "https://www.newscientist.com/feed/home",
        phys: "https://phys.org/rss-feed/"
      },
      ta: {
        // Tamil News Sources (Authentic Tamil content) - Updated with working feeds
        news18tamil: "https://www.news18.com/rss/tamil.xml",
        tamiloneindia: "https://tamil.oneindia.com/rss/tamil-news-fb.xml",
        zeenewstamil: "https://zeenews.india.com/tamil/rss.xml",
        // Fallback to major Indian sources that work reliably
        thehindu: "https://www.thehindu.com/feeder/default.rss",
        ndtv: "https://feeds.feedburner.com/ndtvnews-top-stories",
        indiatoday: "https://www.indiatoday.in/rss/1206578",
        tbi: "https://www.thebetterindia.com/feed/",
        hindustantimes: "https://www.hindustantimes.com/feeds/rss/india-news/rssfeed.xml",
        // Working international sources for comparison
        bbc: "http://feeds.bbci.co.uk/news/rss.xml",
        reuters: "https://www.reutersagency.com/feed/",
        // Tech sources that work well
        techcrunch: "https://techcrunch.com/feed/",
        hackernews: "https://hnrss.org/frontpage"
      },
      hi: {
        // Hindi News Sources
        ndtv: "https://feeds.feedburner.com/ndtvnews-top-stories",
        indiatoday: "https://www.indiatoday.in/rss/1206578",
        thehindu: "https://www.thehindu.com/feeder/default.rss",
        jagran: "https://www.jagran.com/rss/news.xml",
        aajtak: "https://www.aajtak.in/rss/top-stories.xml",
        navbharat: "https://navbharattimes.indiatimes.com/rssfeedstopstories.cms"
      }
    };

    // Get current language feeds
    const getCurrentFeeds = () => {
      return RSS_FEEDS[currentLanguage] || RSS_FEEDS.en;
    };

    // ======================
    // UTILITY FUNCTIONS
    // STATE MANAGEMENT
    // ======================
    const state = {
      allArticles: [],
      activeCategory: "all",
      activeSource: "all",
      visibleCount: CONFIG.INITIAL_VISIBLE_COUNT
    };

    // ======================
    // UTILITY FUNCTIONS
    // ======================
    function stripHtml(html) {
      if (!html) return "";
      return html.replace(/<[^>]*>/g, "").trim();
    }

    function shortenText(text, maxLen = 220) {
      if (!text) return "";
      const clean = text.trim();
      if (clean.length <= maxLen) return clean;
      const sliced = clean.slice(0, maxLen);
      const lastSpace = sliced.lastIndexOf(" ");
      const trimmed = lastSpace > 120 ? sliced.slice(0, lastSpace) : sliced;
      return trimmed + "…";
    }

    // Tamil content detection and enhancement
    function isTamilContent(text) {
      if (!text) return false;
      // Check for Tamil Unicode characters (U+0B80 to U+0BFF)
      const tamilRegex = /[\u0B80-\u0BFF]/;
      return tamilRegex.test(text);
    }

    function enhanceTamilContent(article) {
      if (currentLanguage !== 'ta') return article;
      
      // Check if content is already in Tamil
      const hasTamilTitle = isTamilContent(article.title);
      const hasTamilDescription = isTamilContent(article.description);
      
      // Mark if content is authentic Tamil
      if (hasTamilTitle || hasTamilDescription) {
        article.isAuthenticTamil = true;
      } else {
        article.isAuthenticTamil = false;
      }
      
      // Don't modify the title - display content as-is from the feed
      return article;
    }

    function classifyArticle(article) {
      const text = ((article.title || "") + " " + (article.description || "")).toLowerCase();
      const source = article.sourceKey || "";
      
      // Source-based classification first
      if (source.match(/nasa|space|universe/i)) return "space";
      if (source.match(/science|nature|phys/i)) return "science";
      if (source.match(/health|medical|webmd/i)) return "health";
      if (source.match(/treehugger|earth|mongabay/i)) return "environment";
      if (source.match(/design|dezeen|creative/i)) return "design";
      if (source.match(/ign|polygon|variety/i)) return "entertainment";
      if (source.match(/krebs|bleeping|security/i)) return "cybersecurity";
      if (source.match(/opensource|devto|github/i)) return "opensource";
      if (source.match(/smithsonian|conversation|aeon/i)) return "culture";
      if (source.match(/edutopia|chronicle/i)) return "education";
      if (source.match(/goodnews|positive|optimist/i)) return "positive";
      if (source.match(/autocar|teambhp|team-bhp/i)) return "automobiles";
      
      // Content-based classification
      if (text.match(/cricket|football|t20|ipl|world cup|olympic|tennis|basketball/i)) return "sports";
      if (text.match(/sensex|nifty|stock|market|shares|economy|gdp|inflation|trading/i)) return "markets";
      if (text.match(/election|minister|parliament|bill passed|policy|government|congress/i)) return "politics";
      if (text.match(/startup|start-up|funding|valuation|unicorn|series [ab]|venture capital|entrepreneur/i)) return "startups";
      if (text.match(/\bai\b|artificial intelligence|machine learning|openai|chatgpt|neural|deep learning/i)) return "ai";
      if (text.match(/car|automobile|vehicle|\bev\b|electric vehicle|hybrid|suv|bike|two-wheeler/i)) return "automobiles";
      if (text.match(/space|rocket|satellite|mars|moon|asteroid|planet|galaxy|cosmos/i)) return "space";
      if (text.match(/research|study|scientist|discovery|experiment|laboratory|peer-review/i)) return "science";
      if (text.match(/health|medical|disease|treatment|vaccine|hospital|doctor|patient/i)) return "health";
      if (text.match(/climate|environment|carbon|emission|renewable|solar|wind|sustainability/i)) return "environment";
      if (text.match(/design|architecture|art|creative|aesthetic|visual/i)) return "design";
      if (text.match(/game|gaming|esports|console|playstation|xbox|nintendo/i)) return "entertainment";
      if (text.match(/hack|breach|cyber|security|malware|vulnerability|encryption/i)) return "cybersecurity";
      if (text.match(/open source|github|linux|developer|programming|code|software/i)) return "opensource";
      if (text.match(/culture|society|history|philosophy|anthropology/i)) return "culture";
      if (text.match(/education|learning|school|university|student|teacher/i)) return "education";
      
      return "current";
    }

    function calculatePositivityScore(article) {
      const text = `${article.title || ""} ${article.description || ""}`.toLowerCase();
      let score = 50;

      const positiveWords = [
        "growth", "boost", "record", "success", "wins", "innovation",
        "launch", "expands", "profits", "strong", "positive", "improves",
        "electric", "sustainable", "renewable", "jobs", "breakthrough",
        "milestone", "achievement", "solution"
      ];

      const negativeWords = [
        "crash", "loss", "decline", "cut", "layoff", "drops",
        "scandal", "fraud", "fails", "shutdown", "strike", "crisis",
        "panic", "fear", "plunge", "collapse"
      ];

      positiveWords.forEach(word => {
        if (text.includes(word)) score += 4;
      });

      negativeWords.forEach(word => {
        if (text.includes(word)) score -= 6;
      });

      return Math.max(10, Math.min(90, score));
    }

    function getAgentReason(article) {
      const category = article.category;
      const description = (article.description || "").toLowerCase();
      
      if (category === "sports") return "Highlights human achievement and positive role models.";
      if (category === "automobiles" && description.includes("electric")) 
        return "Signals progress toward sustainable transportation.";
      if (description.includes("recycle") || description.includes("waste")) 
        return "Shows measurable environmental impact.";
      if (category === "startups" || description.includes("innovation")) 
        return "Represents constructive innovation and long-term value creation.";
      if (category === "politics") 
        return "Selected for policy impact rather than conflict or controversy.";
      if (category === "ai") 
        return "Highlights technological progress with practical applications.";
      
      return "Selected to maintain a calm, constructive information diet.";
    }

    function isMainstreamSensational(article) {
      const title = (article.title || "").toLowerCase();
      const sensationalKeywords = [
        "breaking", "urgent", "crash", "panic", "plunge", "fear", 
        "turmoil", "sell-off", "shock", "chaos", "crisis"
      ];
      return sensationalKeywords.some(keyword => title.includes(keyword));
    }

    // ======================
    // DOM CREATION
    // ======================
    function createNewsCard(article) {
      const card = document.createElement("article");
      card.className = "news-card";
      card.dataset.category = article.category;
      card.dataset.source = article.sourceKey;
      card.dataset.articleId = article.url; // For tracking

      // Check if article has image
      const hasImage = article.enclosure?.link || article.thumbnail || article.image;
      if (hasImage) {
        card.classList.add('has-image');
      }

      const published = article.publishedAt ? 
        new Date(article.publishedAt).toLocaleString("en-IN", {
          day: "2-digit", 
          month: "short", 
          hour: "2-digit", 
          minute: "2-digit"
        }) : "";

      const sourceName = article.source?.name || "News source";
      const title = article.title || "Untitled story";
      const description = shortenText(article.description || "A positive development worth noting today.");
      
      // Don't add prefix - display content as-is from the feed
      const displayTitle = title;
      const displayDescription = description;
      
      // Generate AI summary (extract key points)
      const summary = generateAISummary(article);

      // Get translations
      const t = translations[currentLanguage].ui;
      const categoryTranslations = translations[currentLanguage].categories || {};
      const translatedCategory = categoryTranslations[article.category] || article.category.toUpperCase();

      // Get image URL
      const imageUrl = article.enclosure?.link || article.thumbnail || article.image || '';

      const imageHTML = imageUrl ? `
        <img src="${imageUrl}" alt="${title}" class="news-card-image" loading="lazy" onerror="this.style.display='none'">
      ` : '';

      card.innerHTML = `
        ${imageHTML}
        <div class="news-card-content">
          <div class="news-badges">
            <span class="badge badge--category">${translatedCategory}</span>
            <span class="badge badge--positive">${t.netPositiveImpact || 'Net positive impact'}</span>
            ${article.isStoryArc ? `<span class="story-arc-badge">📖 ${t.ongoingStory || 'Ongoing Story'}</span>` : ''}
          </div>
          <h3 class="news-title">${displayTitle}</h3>
          
          <div class="ai-summary" style="
            margin: 8px 0;
            padding: 10px 12px;
            background: #fff8ed;
            border-left: 3px solid #f97316;
            border-radius: 8px;
            font-size: 0.78rem;
            color: #78716c;
            line-height: 1.5;
          ">
            <strong style="color: #ea580c;">🤖 ${t.aiSummary}:</strong> ${summary}
          </div>
          
          <p class="tagline">${displayDescription}</p>
          <div class="news-meta-row">
            <div class="news-meta">${published ? `⏱ ${published}` : ""}</div>
          </div>
          <div class="news-footer">
            <span class="source">${t.source}: ${sourceName}</span>
            ${article.url ? `<a class="read-link" href="#" onclick="handleReadMore('${article.url}', '${encodeURIComponent(title)}', '${currentLanguage}', '${article.category}', '${article.sourceKey}')">${t.readMore} <span>↗</span></a>` : ""}
          </div>
          <button class="action-button" onclick="showActionModal('${article.category}', '${encodeURIComponent(article.title)}')">
            <span>💪</span>
            <span>${t.whatCanIDo || 'What Can I Do?'}</span>
          </button>
          <div class="agent-reason">
            <strong>🧠 ${t.whySelected}</strong><br>
            ${getAgentReason(article)}
          </div>
        </div>
      `;

      return card;
    }

    // Generate AI Summary from article content
    function generateAISummary(article) {
      const text = (article.description || article.content || "").toLowerCase();
      const title = (article.title || "").toLowerCase();
      
      // Extract key information based on content
      let summary = "";
      
      // Check for numbers/statistics
      const numbers = text.match(/\d+%|\d+\s*(million|billion|thousand|crore|lakh)/gi);
      if (numbers && numbers.length > 0) {
        summary += `Key figures: ${numbers.slice(0, 2).join(", ")}. `;
      }
      
      // Check for key actions/events
      if (text.includes("launch") || text.includes("announce")) {
        summary += "New announcement or launch. ";
      } else if (text.includes("growth") || text.includes("increase") || text.includes("rise")) {
        summary += "Positive growth trend reported. ";
      } else if (text.includes("innovation") || text.includes("breakthrough")) {
        summary += "Innovative development highlighted. ";
      } else if (text.includes("policy") || text.includes("regulation")) {
        summary += "Policy or regulatory update. ";
      } else if (text.includes("win") || text.includes("victory") || text.includes("champion")) {
        summary += "Achievement or victory reported. ";
      }
      
      // Add category-specific context
      const category = article.category;
      if (category === "markets") {
        summary += "Market movement with potential long-term implications.";
      } else if (category === "ai" || category === "startups") {
        summary += "Technology advancement with practical applications.";
      } else if (category === "sports") {
        summary += "Sports achievement showcasing human excellence.";
      } else if (category === "politics") {
        summary += "Policy development with societal impact.";
      } else {
        summary += "Development worth noting for its constructive impact.";
      }
      
      return summary || "A positive development highlighting progress and constructive change.";
    }

    // ======================
    // UI UPDATE FUNCTIONS
    // ======================
    function updateVisibleCards() {
      const cards = Array.from(document.querySelectorAll(".news-card"));
      let shown = 0;

      cards.forEach((card) => {
        const category = card.dataset.category;
        const sourceKey = card.dataset.source;
        const categoryOK = state.activeCategory === "all" || category === state.activeCategory;
        const sourceOK = state.activeSource === "all" || sourceKey === state.activeSource;

        if (categoryOK && sourceOK && shown < state.visibleCount) {
          card.classList.remove("hidden");
          shown++;
        } else {
          card.classList.add("hidden");
        }
      });

      const loadMoreBtn = document.getElementById("load-more-btn");
      if (loadMoreBtn) {
        loadMoreBtn.style.display = shown < cards.length ? "inline-flex" : "none";
      }

      updatePositiveCount();
    }

    function updatePositiveCount() {
      const visibleCards = document.querySelectorAll(".news-card:not(.hidden)");
      const positiveCountEl = document.getElementById("positive-count");
      if (positiveCountEl) {
        positiveCountEl.textContent = `${visibleCards.length} stories`;
      }
    }

    function updatePositivityMeter(percent) {
      const positivityPercentEl = document.getElementById("positivity-percent");
      const positivityBarFillEl = document.getElementById("positivity-bar-fill");
      
      if (!positivityPercentEl || !positivityBarFillEl) return;
      
      const clamped = Math.max(0, Math.min(100, Math.round(percent)));
      positivityPercentEl.textContent = clamped ? `${clamped}% positive` : "–";
      positivityBarFillEl.style.width = `${clamped}%`;
    }

    function updateAgentNote(articles) {
      const el = document.getElementById("agent-note-text");
      if (!el || !articles || !articles.length) return;

      const categoryStats = {};
      articles.forEach(a => {
        const cat = a.category;
        if (!categoryStats[cat]) {
          categoryStats[cat] = { count: 0, totalScore: 0 };
        }
        categoryStats[cat].count++;
        categoryStats[cat].totalScore += a.aiScore;
      });

      const topCategory = Object.entries(categoryStats)
        .sort((a, b) => b[1].count - a[1].count)[0];

      const [volumeCategory, volumeData] = topCategory;
      const volumePercent = Math.round((volumeData.count / articles.length) * 100);

      el.innerHTML = `
        <div style="display:inline-block;margin-bottom:6px;padding:4px 10px;font-size:0.72rem;border-radius:999px;background:#e0f2fe;color:#0f172a;font-weight:600;">
          🤖 Editorial AI · Signal-first curation
        </div>
        <div style="margin-top:8px;">
          Today's feed prioritises <strong>durable signal over breaking noise</strong>. 
          <strong>${volumeCategory.toUpperCase()}</strong> dominated headlines (${volumePercent}% of coverage), 
          curated from ${Object.keys(getCurrentFeeds()).length} trusted sources.
        </div>
        <div style="margin-top:8px;color:#64748b;font-size:0.78rem;">
          The AI intentionally deprioritised urgency-driven headlines in favour of developments 
          with long-term relevance and constructive impact.
        </div>
      `;
    }

    function updateIgnoredList(articles) {
      const el = document.getElementById("ignored-list");
      if (!el) return;

      const ignored = articles.filter(a => isMainstreamSensational(a)).slice(0, 3);

      if (!ignored.length) {
        el.innerHTML = "<li>No major urgency-driven headlines were prioritised today.</li>";
        return;
      }

      el.innerHTML = ignored.map(a => `
        <li>
          <strong>"${a.title}"</strong><br>
          <em style="font-size:0.75rem;color:#92400e;">Deprioritised due to short-term urgency framing.</em>
        </li>
      `).join("");
    }

    function updateSourcesLabel() {
      const sourcesCountLabel = document.getElementById("sources-count-label");
      if (!sourcesCountLabel) return;
      
      const activeChip = document.querySelector(".source-chip.active");
      if (!activeChip || state.activeSource === "all") {
        sourcesCountLabel.textContent = "All sources (combined)";
      } else {
        sourcesCountLabel.textContent = activeChip.textContent.trim();
      }
    }

    // ======================
    // DATA FETCHING
    // ======================
    async function loadNews() {
      const newsList = document.getElementById("news-list");
      const lastUpdatedEl = document.getElementById("last-updated");
      
      newsList.innerHTML = `<p style="color:#6b7280;font-size:0.8rem;">${translations[currentLanguage].ui.fetchingStories || 'Fetching positive stories from multiple sources…'}</p>`;

      try {
        // Build fetch promises using current language feeds
        const currentFeeds = getCurrentFeeds();
        const fetchPromises = Object.entries(currentFeeds).map(([key, url]) => 
          fetch(CONFIG.RSS_API_BASE + encodeURIComponent(url))
            .then(r => r.json())
            .then(data => ({ key, data }))
            .catch(err => {
              console.warn(`Failed to fetch ${key}:`, err);
              return { key, data: null };
            })
        );

        const results = await Promise.all(fetchPromises);
        state.allArticles = [];

        // Process all feeds
        results.forEach(({ key, data }) => {
          if (!data || data.status !== "ok" || !data.items || !data.items.length) {
            console.log(`DEBUG: Feed ${key} failed or has no items:`, data?.status, data?.message);
            return;
          }

          const sourceName = data.feed?.title || "News Source";
          console.log(`DEBUG: Processing ${key} with ${data.items.length} items from ${sourceName}`);
          
          data.items.slice(0, 6).forEach(item => {
            const article = {
              title: item.title,
              description: stripHtml(item.description),
              content: stripHtml(item.content),
              url: item.link,
              publishedAt: item.pubDate,
              source: { name: sourceName },
              sourceKey: key,
              category: null,
              aiScore: 0
            };

            // Enhance Tamil content if in Tamil mode
            const enhancedArticle = enhanceTamilContent(article);

            // Classify and score
            enhancedArticle.category = classifyArticle(enhancedArticle);
            enhancedArticle.aiScore = calculatePositivityScore(enhancedArticle);

            state.allArticles.push(enhancedArticle);
          });
        });

        if (!state.allArticles.length) {
          console.log('DEBUG: No articles found. Current language:', currentLanguage);
          console.log('DEBUG: Current feeds:', getCurrentFeeds());
          console.log('DEBUG: Results from feeds:', results.map(r => ({ key: r.key, status: r.data?.status, items: r.data?.items?.length })));
          
          const t = translations[currentLanguage].ui;
          newsList.innerHTML = `<p style="color:#6b7280;font-size:0.8rem;">${t.noStoriesFound || 'No stories found. Please try again later.'}</p>`;
          if (lastUpdatedEl) lastUpdatedEl.textContent = t.noStoriesAvailable || "No stories available";
          return;
        }

        // Sort by positivity score
        state.allArticles.sort((a, b) => b.aiScore - a.aiScore);

        // Apply AI curation if enabled
        if (typeof applyAICuration === 'function') {
          state.allArticles = applyAICuration(state.allArticles);
        }

        // Cache articles for offline access
        cacheArticles(state.allArticles);

        // Calculate positivity meter
        const positiveCount = state.allArticles.filter(a => a.aiScore > 50).length;
        const positivityPercent = (positiveCount * 100) / state.allArticles.length;
        updatePositivityMeter(positivityPercent);

        // Render cards
        newsList.innerHTML = "";
        state.allArticles.forEach(article => {
          const card = createNewsCard(article);
          newsList.appendChild(card);
        });

        // Reset visibility
        state.visibleCount = CONFIG.INITIAL_VISIBLE_COUNT;
        updateVisibleCards();

        // Update UI elements
        if (lastUpdatedEl) {
          lastUpdatedEl.textContent = `Updated ${new Date().toLocaleTimeString("en-IN", { 
            hour: "2-digit", 
            minute: "2-digit" 
          })}`;
        }

        updateAgentNote(state.allArticles);
        updateIgnoredList(state.allArticles);

        // Load multimedia content
        loadMultimediaContent(state.allArticles);

      } catch (error) {
        console.error("Error loading news:", error);
        newsList.innerHTML = '<p style="color:#b91c1c;font-size:0.8rem;">Network error while loading stories. Please try again.</p>';
        if (lastUpdatedEl) lastUpdatedEl.textContent = "Error fetching headlines";
      }
    }

    // ======================
    // CHAT FUNCTIONALITY - Enhanced with Hope's Personality
    // ======================
    function hopeChatAnswer(question, articles) {
      const q = question.toLowerCase();

      // Hope Score queries
      if (q.includes("hope score") || q.includes("my score")) {
        const score = calculateHopeScore();
        return `✨ Your Hope Score is ${score}! ${score >= 80 ? "You're doing amazing!" : score >= 60 ? "Keep up the great work!" : "Let's boost it by reading more positive news!"} Click the score widget to learn more!`;
      }

      // Action/Help queries
      if (q.includes("what can i do") || q.includes("how can i help") || q.includes("take action")) {
        return `💪 I love your enthusiasm! Every article has a "What Can I Do?" button with specific actions. You can also:\n\n• Share positive news with friends\n• Support causes you care about\n• Practice gratitude daily\n• Spread kindness in your community`;
      }

      // Mood/Wellness queries
      if (q.includes("mood") || q.includes("feeling") || q.includes("wellness")) {
        return `😊 I care about how you're feeling! Use the mood tracker (😊 button on the right) to check in. Reading positive news can boost your mood by up to 30%! How are you feeling today?`;
      }

      // Community queries
      if (q.includes("community") || q.includes("readers") || q.includes("others")) {
        const stats = document.getElementById('global-reads')?.textContent || "1M+";
        return `🌍 You're part of an amazing community! ${stats} people have read positive news with us. Together, we're spreading hope and making a difference!`;
      }

      // Inspiring/best story
      if (q.includes("inspiring") || q.includes("best") || q.includes("favorite") || q.includes("top")) {
        const top = articles.slice(0, 3);
        return `🌟 Here are today's most inspiring stories I found for you:\n\n${top.map((a, i) => `${i + 1}. ${a.title}`).join("\n\n")}\n\nWhich one speaks to you?`;
      }

      // Category-specific queries with personality
      if (q.includes("science")) {
        const science = articles.filter(a => a.category === "science").slice(0, 3);
        if (!science.length) {
          return "🔬 No major science stories today, but check back soon! Science is always advancing!";
        }
        return `🔬 Science is amazing! Here's what's happening:\n\n${science.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      if (q.includes("space") || q.includes("astronomy")) {
        const space = articles.filter(a => a.category === "space").slice(0, 3);
        if (!space.length) {
          return "🚀 No space news today, but the universe is always full of wonders!";
        }
        return `🚀 The cosmos is calling! Check out:\n\n${space.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      if (q.includes("health") || q.includes("medical")) {
        const health = articles.filter(a => a.category === "health").slice(0, 3);
        if (!health.length) {
          return "💚 No major health stories today, but remember: your wellbeing matters!";
        }
        return `💚 Health breakthroughs:\n\n${health.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      if (q.includes("environment") || q.includes("climate")) {
        const env = articles.filter(a => a.category === "environment").slice(0, 3);
        if (!env.length) {
          return "🌱 No environment stories today, but every day is Earth Day!";
        }
        return `🌱 Great news for our planet:\n\n${env.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      if (q.includes("politics")) {
        const politics = articles.filter(a => a.category === "politics").slice(0, 3);
        if (!politics.length) {
          return "🏛️ No major political stories in today's positive feed.";
        }
        return `🏛️ Political progress:\n\n${politics.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      if (q.includes("sports")) {
        const sports = articles.filter(a => a.category === "sports").slice(0, 3);
        if (!sports.length) {
          return "⚽ No sports stories today, but champions are made every day!";
        }
        return `⚽ Sports victories:\n\n${sports.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      if (q.includes("ai") || q.includes("tech") || q.includes("technology")) {
        const tech = articles.filter(a => a.category === "ai").slice(0, 3);
        if (!tech.length) {
          return "🤖 No major AI/tech stories today, but innovation never stops!";
        }
        return `🤖 Tech innovations:\n\n${tech.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      if (q.includes("market") || q.includes("stock") || q.includes("economy")) {
        const markets = articles.filter(a => a.category === "markets").slice(0, 3);
        if (!markets.length) {
          return "📈 No major market stories today, but opportunities are everywhere!";
        }
        return `📈 Market highlights:\n\n${markets.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      if (q.includes("automobile") || q.includes("car") || q.includes("vehicle") || q.includes("auto")) {
        const autos = articles.filter(a => a.category === "automobiles").slice(0, 3);
        if (!autos.length) {
          return "🚗 No major automobile stories today, but the road ahead is exciting!";
        }
        return `🚗 Latest automobile news:\n\n${autos.map(a => `• ${a.title}`).join("\n\n")}`;
      }

      // Today's news summary
      if (q.includes("today") || q.includes("summary") || q.includes("headlines")) {
        const top = articles.slice(0, 5);
        return `📰 Here's what I've curated for you today:\n\n${top.map((a, i) => `${i + 1}. ${a.title}`).join("\n\n")}\n\nWant to know more about any category?`;
      }

      // Gratitude/positive
      if (q.includes("thank") || q.includes("grateful") || q.includes("appreciate")) {
        return `💝 Aww, you're so sweet! I'm grateful for YOU! Keep spreading positivity. You're making the world brighter! ✨`;
      }

      // Who are you
      if (q.includes("who are you") || q.includes("what are you") || q.includes("your name")) {
        return `🌟 I'm Hope, your AI news companion! I'm here to help you discover positive, uplifting news and turn inspiration into action. Think of me as your friend who always sees the bright side! What would you like to know?`;
      }

      // Default response with personality
      return `💫 I'm here to help! You can ask me about:\n\n• Today's inspiring stories\n• Specific topics (science, health, space, etc.)\n• Your Hope Score\n• What you can do to help\n• Community stats\n\nWhat interests you most?`;
    }

    function addChatBubble(text, from = "user") {
      const chatMessages = document.getElementById("chat-messages");
      const bubble = document.createElement("div");
      
      bubble.style.maxWidth = "85%";
      bubble.style.padding = "10px 12px";
      bubble.style.borderRadius = "16px";
      bubble.style.fontSize = "0.85rem";
      bubble.style.lineHeight = "1.5";
      bubble.style.marginBottom = "4px";
      bubble.style.animation = "fadeIn 0.3s ease";

      if (from === "user") {
        bubble.style.alignSelf = "flex-end";
        bubble.style.background = "linear-gradient(135deg, #60a5fa, #3b82f6)";
        bubble.style.color = "#ffffff";
        bubble.style.boxShadow = "0 2px 8px rgba(59, 130, 246, 0.3)";
      } else {
        bubble.style.alignSelf = "flex-start";
        bubble.style.background = "linear-gradient(135deg, #8b5cf6, #7c3aed)";
        bubble.style.color = "#ffffff";
        bubble.style.boxShadow = "0 2px 8px rgba(139, 92, 246, 0.3)";
      }

      // Preserve line breaks
      bubble.style.whiteSpace = "pre-wrap";
      bubble.textContent = text;
      chatMessages.appendChild(bubble);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function setupChatWidget() {
      const chatWidget = document.getElementById("chat-widget");
      const chatBody = document.getElementById("chat-body");
      const chatToggle = document.getElementById("chat-toggle");
      const chatHeader = document.getElementById("chat-header");
      const chatForm = document.getElementById("chat-form");
      const chatInput = document.getElementById("chat-input");

      // Toggle chat on button click
      chatToggle.addEventListener("click", (e) => {
        e.stopPropagation();
        const isHidden = chatBody.style.display === "none";
        chatBody.style.display = isHidden ? "flex" : "none";
        chatToggle.textContent = isHidden ? "−" : "+";
      });

      // Toggle on header click (except button)
      chatHeader.addEventListener("click", (e) => {
        if (e.target !== chatToggle && !chatToggle.contains(e.target)) {
          const isHidden = chatBody.style.display === "none";
          chatBody.style.display = isHidden ? "flex" : "none";
          chatToggle.textContent = isHidden ? "−" : "+";
        }
      });

      // Handle chat form submission
      if (chatForm) {
        chatForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          const question = chatInput.value.trim();
          if (!question) return false;

          try {
            addChatBubble(question, "user");
            chatInput.value = "";

            // Add thinking indicator with Hope's personality
            const chatMessages = document.getElementById("chat-messages");
            const thinking = document.createElement("div");
            thinking.style.alignSelf = "flex-start";
            thinking.style.maxWidth = "85%";
            thinking.style.padding = "10px 12px";
            thinking.style.borderRadius = "16px";
            thinking.style.background = "linear-gradient(135deg, #8b5cf6, #7c3aed)";
            thinking.style.color = "#ffffff";
            thinking.style.fontSize = "0.85rem";
            thinking.innerHTML = "✨ Hope is thinking...";
            chatMessages.appendChild(thinking);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Simulate thinking delay
            await new Promise(resolve => setTimeout(resolve, 800));

            thinking.remove();
            const answer = hopeChatAnswer(question, state.allArticles);
            addChatBubble(answer, "bot");
          } catch (error) {
            console.error('Chat error:', error);
            addChatBubble("Oops! Something went wrong. Please try again!", "bot");
          }
          
          return false;
        });
      }
    }

    // ======================
    // EVENT HANDLERS
    // ======================
    function setupEventListeners() {
      // Category filters
      const categoryChips = document.querySelectorAll(".filter-chip[data-filter]");
      categoryChips.forEach(chip => {
        chip.addEventListener("click", () => {
          const filter = chip.getAttribute("data-filter");
          state.activeCategory = filter || "all";
          state.visibleCount = CONFIG.INITIAL_VISIBLE_COUNT;
          
          categoryChips.forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          
          updateVisibleCards();
        });
      });

      // Source filters
      const sourceChips = document.querySelectorAll(".source-chip[data-source]");
      sourceChips.forEach(chip => {
        chip.addEventListener("click", () => {
          const source = chip.getAttribute("data-source");
          state.activeSource = source || "all";
          state.visibleCount = CONFIG.INITIAL_VISIBLE_COUNT;
          
          sourceChips.forEach(c => c.classList.remove("active"));
          chip.classList.add("active");
          
          updateSourcesLabel();
          updateVisibleCards();
        });
      });

      // Refresh button with cache clearing
      const refreshBtn = document.getElementById("refresh-btn");
      if (refreshBtn) {
        refreshBtn.addEventListener("click", async () => {
          const lastUpdatedEl = document.getElementById("last-updated");
          if (lastUpdatedEl) lastUpdatedEl.textContent = "Clearing cache & refreshing…";
          
          // Clear service worker caches
          if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(
              cacheNames.map(cacheName => caches.delete(cacheName))
            );
            console.log('All caches cleared');
          }
          
          // Force reload from server
          window.location.reload(true);
        });
      }

      // Load more button
      const loadMoreBtn = document.getElementById("load-more-btn");
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener("click", () => {
          state.visibleCount += CONFIG.LOAD_MORE_COUNT;
          updateVisibleCards();
        });
      }

      // Feedback form
      const feedbackForm = document.getElementById("feedback-form");
      if (feedbackForm) {
        feedbackForm.addEventListener("submit", (e) => {
          e.preventDefault();
          
          const name = document.getElementById("feedback-name").value.trim();
          const feedback = document.getElementById("feedback-text").value.trim();
          const statusEl = document.getElementById("feedback-status");

          if (!feedback) {
            statusEl.textContent = "Please add a quick note before sending.";
            statusEl.className = "feedback-status error";
            return;
          }

          const subject = encodeURIComponent("Feedback on Mahesh positive news feed");
          const bodyLines = [
            `Name: ${name || "(not provided)"}`,
            "",
            "Feedback:",
            feedback,
            "",
            "---",
            "Sent from Mahesh Positive News Feed"
          ];
          const body = encodeURIComponent(bodyLines.join("\n"));
          
          window.location.href = `mailto:${CONFIG.FEEDBACK_EMAIL}?subject=${subject}&body=${body}`;

          statusEl.textContent = "Opening your email client…";
          statusEl.className = "feedback-status success";
          
          setTimeout(() => {
            document.getElementById("feedback-name").value = "";
            document.getElementById("feedback-text").value = "";
            statusEl.textContent = "Thank you for your feedback!";
          }, 1500);
        });
      }

      // Modal handlers
      const privacyLink = document.getElementById("privacy-link");
      const termsLink = document.getElementById("terms-link");
      const privacyModal = document.getElementById("privacy-modal");
      const termsModal = document.getElementById("terms-modal");

      if (privacyLink && privacyModal) {
        privacyLink.addEventListener("click", (e) => {
          e.preventDefault();
          privacyModal.classList.add("show");
        });
      }

      if (termsLink && termsModal) {
        termsLink.addEventListener("click", (e) => {
          e.preventDefault();
          termsModal.classList.add("show");
        });
      }

      // Close buttons for modals
      document.querySelectorAll(".modal-close").forEach(btn => {
        btn.addEventListener("click", () => {
          btn.closest(".modal").classList.remove("show");
        });
      });

      // Click outside to close modals
      document.querySelectorAll(".modal").forEach(modal => {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            modal.classList.remove("show");
          }
        });
      });

      // Copyright year
      const copyEl = document.getElementById("copyright-year");
      if (copyEl) {
        copyEl.textContent = new Date().getFullYear();
      }
    }

    // ======================
    // MULTIMEDIA CONTENT
    // ======================
    function switchMultimediaTab(tabName) {
      // Update tab buttons
      document.querySelectorAll('.multimedia-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.closest('.multimedia-tab').classList.add('active');

      // Update content sections
      document.querySelectorAll('.multimedia-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`${tabName}-content`).classList.add('active');
    }

    function loadMultimediaContent(articles) {
      loadImageGallery(articles);
      loadVideoNews();
      loadPodcasts();
      loadInfographics();
    }

    function loadImageGallery(articles) {
      const galleryGrid = document.getElementById('gallery-grid');
      
      // Filter articles with images
      const articlesWithImages = articles.filter(a => {
        // Check if article has image in content or use placeholder
        return true; // We'll show all articles with generated images
      }).slice(0, 12);

      if (articlesWithImages.length === 0) {
        galleryGrid.innerHTML = '<p style="color: #78716c; font-size: 0.85rem;">No images available at the moment.</p>';
        return;
      }

      galleryGrid.innerHTML = articlesWithImages.map(article => {
        // Generate a placeholder image URL based on category
        const imageUrl = getPlaceholderImage(article.category);
        
        return `
          <div class="gallery-item" onclick="window.open('${article.url}', '_blank')">
            <img src="${imageUrl}" alt="${article.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/400x300/f97316/ffffff?text=News+Image'">
            <div class="gallery-item-content">
              <div class="gallery-item-title">${shortenText(article.title, 80)}</div>
              <div class="gallery-item-source">${article.source?.name || 'News Source'}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function getPlaceholderImage(category) {
      const images = {
        sports: 'https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=400&h=300&fit=crop',
        markets: 'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=400&h=300&fit=crop',
        ai: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=400&h=300&fit=crop',
        automobiles: 'https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?w=400&h=300&fit=crop',
        politics: 'https://images.unsplash.com/photo-1529107386315-e1a2ed48a620?w=400&h=300&fit=crop',
        startups: 'https://images.unsplash.com/photo-1559136555-9303baea8ebd?w=400&h=300&fit=crop',
        current: 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=300&fit=crop'
      };
      return images[category] || images.current;
    }

    function loadVideoNews() {
      const videoGrid = document.getElementById('video-grid');
      
      // Curated news video channels and recent videos
      const newsVideos = [
        {
          id: 'dQw4w9WgXcQ', // Replace with actual news video IDs
          title: 'BBC News: Today\'s Top Stories',
          channel: 'BBC News'
        },
        {
          id: 'jNQXAC9IVRw', // Replace with actual news video IDs
          title: 'Tech News Roundup',
          channel: 'TechCrunch'
        },
        {
          id: 'y6120QOlsfU', // Replace with actual news video IDs
          title: 'Market Analysis Today',
          channel: 'Financial Times'
        },
        {
          id: 'dQw4w9WgXcQ', // Replace with actual news video IDs
          title: 'AI Developments This Week',
          channel: 'MIT Technology Review'
        }
      ];

      videoGrid.innerHTML = newsVideos.map(video => `
        <div class="video-item">
          <iframe 
            src="https://www.youtube.com/embed/${video.id}" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen
            loading="lazy">
          </iframe>
          <div class="video-item-content">
            <div class="gallery-item-title">${video.title}</div>
            <div class="gallery-item-source">${video.channel}</div>
          </div>
        </div>
      `).join('');
    }

    function loadPodcasts() {
      const podcastList = document.getElementById('podcast-list');
      
      // Curated news podcasts
      const podcasts = [
        {
          title: 'The Daily - New York Times',
          description: 'Today\'s biggest stories in 20 minutes',
          duration: '20 min',
          url: 'https://www.nytimes.com/column/the-daily'
        },
        {
          title: 'Up First - NPR',
          description: 'Morning news briefing',
          duration: '15 min',
          url: 'https://www.npr.org/podcasts/510318/up-first'
        },
        {
          title: 'Today in Focus - The Guardian',
          description: 'Deep dive into the day\'s news',
          duration: '25 min',
          url: 'https://www.theguardian.com/news/series/todayinfocus'
        },
        {
          title: 'Tech News Briefing - WSJ',
          description: 'Latest in technology',
          duration: '10 min',
          url: 'https://www.wsj.com/podcasts/tech-news-briefing'
        },
        {
          title: 'The Intelligence - The Economist',
          description: 'Global news analysis',
          duration: '22 min',
          url: 'https://www.economist.com/podcasts'
        }
      ];

      podcastList.innerHTML = podcasts.map(podcast => `
        <div class="podcast-item" onclick="window.open('${podcast.url}', '_blank')">
          <div class="podcast-icon">🎙️</div>
          <div class="podcast-info">
            <div class="podcast-title">${podcast.title}</div>
            <div class="podcast-meta">${podcast.description} • ${podcast.duration}</div>
          </div>
          <button style="
            padding: 6px 12px;
            background: #f97316;
            color: #ffffff;
            border: none;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
          ">Listen</button>
        </div>
      `).join('');
    }

    function loadInfographics() {
      const infographicGrid = document.getElementById('infographic-grid');
      
      // Sample infographics (in production, these would come from your data sources)
      const infographics = [
        {
          title: 'Global AI Investment Trends 2025',
          image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=300&fit=crop',
          source: 'Visual Capitalist'
        },
        {
          title: 'Climate Change Impact by Region',
          image: 'https://images.unsplash.com/photo-1569163139394-de4798aa62b6?w=400&h=300&fit=crop',
          source: 'Our World in Data'
        },
        {
          title: 'Stock Market Performance YTD',
          image: 'https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?w=400&h=300&fit=crop',
          source: 'Financial Times'
        },
        {
          title: 'Tech Startup Funding Landscape',
          image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400&h=300&fit=crop',
          source: 'CB Insights'
        },
        {
          title: 'Renewable Energy Growth',
          image: 'https://images.unsplash.com/photo-1473341304170-971dccb5ac1e?w=400&h=300&fit=crop',
          source: 'IEA'
        },
        {
          title: 'Global Trade Routes 2025',
          image: 'https://images.unsplash.com/photo-1526304640581-d334cdbbf45e?w=400&h=300&fit=crop',
          source: 'World Bank'
        }
      ];

      infographicGrid.innerHTML = infographics.map(infographic => `
        <div class="infographic-item">
          <img src="${infographic.image}" alt="${infographic.title}" loading="lazy">
          <div class="infographic-item-content">
            <div class="gallery-item-title">${infographic.title}</div>
            <div class="gallery-item-source">${infographic.source}</div>
          </div>
        </div>
      `).join('');
    }

    // Make function globally accessible
    window.switchMultimediaTab = switchMultimediaTab;

    // ======================
    // INITIALIZATION
    // ======================
    document.addEventListener("DOMContentLoaded", () => {
      setupEventListeners();
      setupChatWidget();
      setupLanguageSelector();
      loadNews();
      initReadingStats();
      updateStatsDisplay();
      
      // Setup lazy loading after content loads
      setTimeout(setupLazyLoading, 1000);
    });

    // ======================
    // READING STATS TRACKING
    // ======================
    function initReadingStats() {
      // Initialize stats in localStorage if not exists
      if (!localStorage.getItem('readingStats')) {
        const initialStats = {
          totalRead: 0,
          readToday: 0,
          readThisWeek: 0,
          lastReadDate: null,
          streak: 0,
          categoryBreakdown: {},
          sourceBreakdown: {},
          readArticles: []
        };
        localStorage.setItem('readingStats', JSON.stringify(initialStats));
      }
      
      // Check if we need to reset daily/weekly counters
      checkAndResetCounters();
    }

    function checkAndResetCounters() {
      const stats = JSON.parse(localStorage.getItem('readingStats'));
      const today = new Date().toDateString();
      const lastRead = stats.lastReadDate ? new Date(stats.lastReadDate).toDateString() : null;
      
      // Reset daily counter if it's a new day
      if (lastRead !== today) {
        stats.readToday = 0;
        
        // Update streak
        if (lastRead) {
          const lastReadDate = new Date(lastRead);
          const todayDate = new Date(today);
          const diffDays = Math.floor((todayDate - lastReadDate) / (1000 * 60 * 60 * 24));
          
          if (diffDays === 1) {
            // Consecutive day - increment streak
            stats.streak += 1;
          } else if (diffDays > 1) {
            // Missed days - reset streak
            stats.streak = 0;
          }
        }
      }
      
      // Reset weekly counter if it's a new week
      const weekStart = getWeekStart(new Date());
      const lastWeekStart = stats.lastReadDate ? getWeekStart(new Date(stats.lastReadDate)) : null;
      if (!lastWeekStart || weekStart.getTime() !== lastWeekStart.getTime()) {
        stats.readThisWeek = 0;
      }
      
      localStorage.setItem('readingStats', JSON.stringify(stats));
    }

    function getWeekStart(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - day;
      return new Date(d.setDate(diff));
    }

    function trackArticleRead(url, category, source) {
      const stats = JSON.parse(localStorage.getItem('readingStats'));
      
      // Check if already read
      if (stats.readArticles.includes(url)) {
        return;
      }
      
      // Update counters
      stats.totalRead += 1;
      stats.readToday += 1;
      stats.readThisWeek += 1;
      stats.lastReadDate = new Date().toISOString();
      stats.readArticles.push(url);
      
      // Update category breakdown
      stats.categoryBreakdown[category] = (stats.categoryBreakdown[category] || 0) + 1;
      
      // Update source breakdown
      stats.sourceBreakdown[source] = (stats.sourceBreakdown[source] || 0) + 1;
      
      // Keep only last 100 articles to prevent storage bloat
      if (stats.readArticles.length > 100) {
        stats.readArticles = stats.readArticles.slice(-100);
      }
      
      localStorage.setItem('readingStats', JSON.stringify(stats));
      updateStatsDisplay();
    }

    function updateStatsDisplay() {
      const stats = JSON.parse(localStorage.getItem('readingStats'));
      
      // Update sidebar stats
      document.getElementById('articles-read-today').textContent = stats.readToday;
      document.getElementById('articles-read-week').textContent = stats.readThisWeek;
      document.getElementById('reading-streak').textContent = `${stats.streak} days`;
      
      // Find favorite category
      const categories = Object.entries(stats.categoryBreakdown);
      if (categories.length > 0) {
        const favorite = categories.sort((a, b) => b[1] - a[1])[0];
        document.getElementById('favorite-category').textContent = favorite[0].toUpperCase();
      } else {
        document.getElementById('favorite-category').textContent = '—';
      }
    }

    function showStatsModal() {
      const stats = JSON.parse(localStorage.getItem('readingStats'));
      const modal = document.getElementById('stats-modal');
      
      // Update modal stats
      document.getElementById('modal-total-read').textContent = stats.totalRead;
      document.getElementById('modal-week-read').textContent = stats.readThisWeek;
      document.getElementById('modal-streak').textContent = stats.streak;
      
      // Category breakdown
      const categoryDiv = document.getElementById('category-breakdown');
      const categories = Object.entries(stats.categoryBreakdown).sort((a, b) => b[1] - a[1]);
      
      if (categories.length > 0) {
        categoryDiv.innerHTML = categories.map(([cat, count]) => {
          const percentage = Math.round((count / stats.totalRead) * 100);
          return `
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="flex: 1; font-size: 0.8rem; color: #292524; text-transform: capitalize;">${cat}</div>
              <div style="flex: 2; background: #fed7aa; height: 8px; border-radius: 999px; overflow: hidden;">
                <div style="width: ${percentage}%; height: 100%; background: linear-gradient(to right, #f97316, #ea580c);"></div>
              </div>
              <div style="font-size: 0.75rem; color: #78716c; min-width: 50px; text-align: right;">${count} (${percentage}%)</div>
            </div>
          `;
        }).join('');
      } else {
        categoryDiv.innerHTML = '<p style="font-size: 0.8rem; color: #78716c;">No articles read yet. Start reading to see your stats!</p>';
      }
      
      // Source breakdown
      const sourceDiv = document.getElementById('source-breakdown');
      const sources = Object.entries(stats.sourceBreakdown).sort((a, b) => b[1] - a[1]).slice(0, 5);
      
      if (sources.length > 0) {
        sourceDiv.innerHTML = sources.map(([source, count]) => {
          const percentage = Math.round((count / stats.totalRead) * 100);
          return `
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="flex: 1; font-size: 0.8rem; color: #292524; text-transform: uppercase;">${source}</div>
              <div style="flex: 2; background: #fed7aa; height: 8px; border-radius: 999px; overflow: hidden;">
                <div style="width: ${percentage}%; height: 100%; background: linear-gradient(to right, #f97316, #ea580c);"></div>
              </div>
              <div style="font-size: 0.75rem; color: #78716c; min-width: 50px; text-align: right;">${count} (${percentage}%)</div>
            </div>
          `;
        }).join('');
      } else {
        sourceDiv.innerHTML = '<p style="font-size: 0.8rem; color: #78716c;">No articles read yet.</p>';
      }
      
      // Generate insight
      const insightEl = document.getElementById('reading-insight');
      if (stats.totalRead === 0) {
        insightEl.textContent = "Start reading to unlock personalized insights!";
      } else if (stats.streak >= 7) {
        insightEl.textContent = `Amazing! You've maintained a ${stats.streak}-day reading streak. Keep it up!`;
      } else if (stats.readThisWeek >= 10) {
        insightEl.textContent = "You're an active reader this week! Great job staying informed.";
      } else if (categories.length > 0) {
        const topCat = categories[0][0];
        insightEl.textContent = `You seem to enjoy ${topCat} news. Try exploring other categories for diverse perspectives!`;
      } else {
        insightEl.textContent = "Keep reading to discover your reading patterns and preferences!";
      }
      
      modal.classList.add('show');
    }

    function resetStats() {
      if (confirm('Are you sure you want to reset all reading statistics? This cannot be undone.')) {
        const initialStats = {
          totalRead: 0,
          readToday: 0,
          readThisWeek: 0,
          lastReadDate: null,
          streak: 0,
          categoryBreakdown: {},
          sourceBreakdown: {},
          readArticles: []
        };
        localStorage.setItem('readingStats', JSON.stringify(initialStats));
        updateStatsDisplay();
        document.getElementById('stats-modal').classList.remove('show');
        alert('Statistics have been reset!');
      }
    }

    // Make functions globally accessible
    window.showStatsModal = showStatsModal;
    window.resetStats = resetStats;
    window.trackArticleRead = trackArticleRead;

    // ======================
    // MULTI-LANGUAGE SUPPORT
    // ======================
    const translations = {
      en: {
        name: 'English',
        flag: '🇬🇧',
        ui: {
          todaysHighlights: "Today's Highlights",
          readMore: "Read",
          source: "Source",
          aiSummary: "AI Summary",
          whySelected: "Why the AI selected this",
          // Additional UI elements
          loading: "Loading...",
          translating: "Translating articles...",
          refresh: "Refresh",
          listView: "List View",
          gridView: "Grid View",
          allSources: "All Sources",
          allCategories: "All Categories",
          lastUpdated: "Last updated",
          readingTime: "min read",
          aiCurated: "AI Curated",
          positiveNews: "Positive News"
        }
      },
      hi: {
        name: 'हिंदी',
        flag: '🇮🇳',
        ui: {
          todaysHighlights: "आज की मुख्य बातें",
          readMore: "पढ़ें",
          source: "स्रोत",
          aiSummary: "एआई सारांश",
          whySelected: "एआई ने इसे क्यों चुना",
          // Additional UI elements
          loading: "लोड हो रहा है...",
          translating: "लेखों का अनुवाद हो रहा है...",
          refresh: "रिफ्रेश",
          listView: "सूची दृश्य",
          gridView: "ग्रिड दृश्य",
          compactView: "कॉम्पैक्ट दृश्य",
          allSources: "सभी स्रोत (संयुक्त)",
          allCategories: "सभी",
          sources: "स्रोत",
          lastUpdated: "अंतिम अपडेट",
          readingTime: "मिनट पढ़ें",
          aiCurated: "एआई क्यूरेटेड",
          positiveNews: "सकारात्मक समाचार",
          loadingWeather: "मौसम लोड हो रहा है...",
          supportProject: "इस परियोजना का समर्थन करें",
          premiumSoon: "प्रीमियम जल्द आ रहा है",
          readingStats: "आपके पढ़ने के आंकड़े",
          aiAgent: "एआई एजेंट",
          todaysMood: "आज का मूड",
          feedback: "आगंतुक प्रतिक्रिया",
          sendFeedback: "प्रतिक्रिया भेजें",
          showMore: "और कहानियां दिखाएं",
          installApp: "ऐप इंस्टॉल करें",
          login: "लॉगिन",
          signUp: "साइन अप करें",
          newsFeed: "समाचार फ़ीड",
          about: "के बारे में",
          noStoriesFound: "कोई कहानी नहीं मिली। कृपया बाद में पुनः प्रयास करें।",
          noStoriesAvailable: "कोई कहानी उपलब्ध नहीं है",
          fetchingStories: "कई स्रोतों से सकारात्मक कहानियां प्राप्त कर रहे हैं...",
          // News card specific translations
          netPositiveImpact: "सकारात्मक प्रभाव",
          ongoingStory: "चल रही कहानी",
          whatCanIDo: "मैं क्या कर सकता हूं?",
          // Hope AI agent translations
          hopeGreeting1: "वापसी पर स्वागत है! मैं होप हूं, और आज की उत्साहवर्धक कहानियां साझा करने के लिए उत्साहित हूं! 🌟",
          hopeGreeting2: "नमस्ते! मैं होप हूं, अच्छी खबरों का आपका व्यक्तिगत क्यूरेटर। आइए आपके दिन को रोशन करें! 🌈",
          hopeGreeting3: "नमस्ते! मैं होप हूं, और आपके लिए सबसे प्रेरणादायक कहानियां खोजने में व्यस्त रही हूं! 💝",
          globalReads: "वैश्विक पाठक",
          readingNow: "अभी पढ़ रहे हैं",
          hopeSpread: "आशा का प्रसार",
          oneYearAgoToday: "एक साल पहले आज",
          oneYearAgo: "एक साल पहले:"
        },
        categories: {
          all: "सभी",
          current: "वर्तमान मामले",
          politics: "राजनीति",
          markets: "बाजार",
          startups: "स्टार्टअप",
          ai: "AI और तकनीक",
          automobiles: "ऑटोमोबाइल",
          space: "अंतरिक्ष",
          science: "विज्ञान",
          health: "स्वास्थ्य",
          environment: "पर्यावरण",
          sports: "खेल",
          design: "डिज़ाइन",
          culture: "संस्कृति",
          positive: "सकारात्मक समाचार"
        }
      },
      ta: {
        name: 'தமிழ்',
        flag: '🇮🇳',
        ui: {
          todaysHighlights: "இன்றைய சிறப்புகள்",
          readMore: "படிக்க",
          source: "மூலம்",
          aiSummary: "AI சுருக்கம்",
          whySelected: "AI இதை ஏன் தேர்ந்தெடுத்தது",
          // Additional UI elements
          loading: "ஏற்றுகிறது...",
          translating: "கட்டுரைகளை மொழிபெயர்க்கிறது...",
          refresh: "புதுப்பிக்க",
          listView: "பட்டியல் காட்சி",
          gridView: "கிரிட் காட்சி",
          compactView: "சுருக்க காட்சி",
          allSources: "அனைத்து மூலங்கள் (ஒருங்கிணைந்த)",
          allCategories: "அனைத்து",
          sources: "மூலங்கள்",
          lastUpdated: "கடைசியாக புதுப்பிக்கப்பட்டது",
          readingTime: "நிமிடம் படிக்க",
          aiCurated: "AI தேர்வு செய்யப்பட்ட",
          positiveNews: "நேர்மறை செய்திகள்",
          loadingWeather: "வானிலை ஏற்றுகிறது...",
          supportProject: "இந்த திட்டத்தை ஆதரிக்கவும்",
          premiumSoon: "பிரீமியம் விரைவில்",
          readingStats: "உங்கள் வாசிப்பு புள்ளிவிவரங்கள்",
          aiAgent: "AI முகவர்",
          todaysMood: "இன்றைய மனநிலை",
          feedback: "பார்வையாளர் கருத்து",
          sendFeedback: "கருத்து அனுப்பவும்",
          showMore: "மேலும் கதைகளைக் காட்டு",
          installApp: "ஆப்ஸை நிறுவவும்",
          login: "உள்நுழைய",
          signUp: "பதிவு செய்யவும்",
          newsFeed: "செய்தி ஊட்டம்",
          about: "பற்றி",
          noStoriesFound: "கதைகள் எதுவும் கிடைக்கவில்லை. பின்னர் முயற்சிக்கவும்.",
          noStoriesAvailable: "கதைகள் எதுவும் கிடைக்கவில்லை",
          fetchingStories: "பல மூலங்களிலிருந்து நேர்மறை கதைகளைப் பெறுகிறது...",
          // News card specific translations
          netPositiveImpact: "நேர்மறை தாக்கம்",
          ongoingStory: "தொடர் கதை",
          whatCanIDo: "நான் என்ன செய்ய முடியும்?",
          // Hope AI agent translations
          hopeGreeting1: "மீண்டும் வரவேற்கிறோம்! நான் ஹோப், இன்றைய உற்சாகமூட்டும் கதைகளைப் பகிர்ந்து கொள்ள மகிழ்ச்சியாக இருக்கிறேன்! 🌟",
          hopeGreeting2: "வணக்கம்! நான் ஹோப், உங்கள் நல்ல செய்திகளின் தனிப்பட்ட தேர்வாளர். உங்கள் நாளை பிரகாசமாக்குவோம்! 🌈",
          hopeGreeting3: "வணக்கம்! நான் ஹோப், உங்களுக்காக மிகவும் ஊக்கமளிக்கும் கதைகளைக் கண்டுபிடிப்பதில் பிஸியாக இருந்தேன்! 💝",
          globalReads: "உலகளாவிய வாசிப்புகள்",
          readingNow: "இப்போது படிக்கிறார்கள்",
          hopeSpread: "நம்பிக்கை பரவல்",
          oneYearAgoToday: "ஒரு வருடம் முன்பு இன்று",
          oneYearAgo: "ஒரு வருடம் முன்பு:"
        },
        categories: {
          all: "அனைத்து",
          current: "நடப்பு விவகாரங்கள்",
          politics: "அரசியல்",
          markets: "சந்தைகள்",
          startups: "ஸ்டார்ட்அப்கள்",
          ai: "AI & தொழில்நுட்பம்",
          automobiles: "வாகனங்கள்",
          space: "விண்வெளி",
          science: "அறிவியல்",
          health: "சுகாதாரம்",
          environment: "சுற்றுச்சூழல்",
          sports: "விளையாட்டு",
          design: "வடிவமைப்பு",
          culture: "கலாச்சாரம்",
          positive: "நேர்மறை செய்திகள்"
        }
      },
      te: {
        name: 'తెలుగు',
        flag: '🇮🇳',
        ui: {
          todaysHighlights: "నేటి ముఖ్యాంశాలు",
          readMore: "చదవండి",
          source: "మూలం",
          aiSummary: "AI సారాంశం",
          whySelected: "AI దీన్ని ఎందుకు ఎంచుకుంది",
          // Additional UI elements
          loading: "లోడ్ అవుతోంది...",
          translating: "వ్యాసాలను అనువదిస్తోంది...",
          refresh: "రిఫ్రెష్",
          listView: "జాబితా వీక్షణ",
          gridView: "గ్రిడ్ వీక్షణ",
          compactView: "కాంపాక్ట్ వీక్షణ",
          allSources: "అన్ని మూలాలు (కలిపి)",
          allCategories: "అన్నీ",
          sources: "మూలాలు",
          lastUpdated: "చివరిగా అప్‌డేట్ చేయబడింది",
          readingTime: "నిమిషం చదవండి",
          aiCurated: "AI క్యూరేటెడ్",
          positiveNews: "సానుకూల వార్తలు",
          loadingWeather: "వాతావరణం లోడ్ అవుతోంది...",
          supportProject: "ఈ ప్రాజెక్ట్‌కు మద్దతు ఇవ్వండి",
          premiumSoon: "ప్రీమియం త్వరలో",
          readingStats: "మీ పఠన గణాంకాలు",
          aiAgent: "AI ఏజెంట్",
          todaysMood: "నేటి మూడ్",
          feedback: "సందర్శకుల అభిప్రాయం",
          sendFeedback: "అభిప్రాయం పంపండి",
          showMore: "మరిన్ని కథలు చూపించు",
          installApp: "యాప్ ఇన్‌స్టాల్ చేయండి",
          login: "లాగిన్",
          signUp: "సైన్ అప్ చేయండి",
          newsFeed: "వార్తల ఫీడ్",
          about: "గురించి",
          noStoriesFound: "కథలు కనుగొనబడలేదు. దయచేసి తర్వాత ప్రయత్నించండి.",
          noStoriesAvailable: "కథలు అందుబాటులో లేవు",
          fetchingStories: "అనేక మూలాల నుండి సానుకూల కథలను పొందుతోంది...",
          // News card specific translations
          netPositiveImpact: "సానుకూల ప్రభావం",
          ongoingStory: "కొనసాగుతున్న కథ",
          whatCanIDo: "నేను ఏమి చేయగలను?",
          // Hope AI agent translations
          hopeGreeting1: "తిరిగి స్వాగతం! నేను హోప్, మరియు నేడు ఉత్తేజపరిచే కథలను పంచుకోవడానికి సంతోషిస్తున్నాను! 🌟",
          hopeGreeting2: "హలో! నేను హోప్, మంచి వార్తల యొక్క మీ వ్యక్తిగత క్యూరేటర్. మీ రోజును ప్రకాశవంతం చేద్దాం! 🌈",
          hopeGreeting3: "హలో! నేను హోప్, మరియు మీ కోసం అత్యంత స్ఫూర్తిదాయకమైన కథలను కనుగొనడంలో బిజీగా ఉన్నాను! 💝",
          globalReads: "ప్రపంచ పఠనాలు",
          readingNow: "ఇప్పుడు చదువుతున్నారు",
          hopeSpread: "ఆశ వ్యాప్తి",
          oneYearAgoToday: "ఒక సంవత్సరం క్రితం ఈ రోజు",
          oneYearAgo: "ఒక సంవత్సరం క్రితం:"
        },
        categories: {
          all: "అన్నీ",
          current: "ప్రస్తుత వ్యవహారాలు",
          politics: "రాజకీయాలు",
          markets: "మార్కెట్లు",
          startups: "స్టార్టప్‌లు",
          ai: "AI & టెక్నాలజీ",
          automobiles: "ఆటోమొబైల్స్",
          space: "అంతరిక్షం",
          science: "విజ్ఞానం",
          health: "ఆరోగ్యం",
          environment: "పర్యావరణం",
          sports: "క్రీడలు",
          design: "డిజైన్",
          culture: "సంస్కృతి",
          positive: "సానుకూల వార్తలు"
        }
      },
      kn: {
        name: 'ಕನ್ನಡ',
        flag: '🇮🇳',
        ui: {
          todaysHighlights: "ಇಂದಿನ ಮುಖ್ಯಾಂಶಗಳು",
          readMore: "ಓದಿ",
          source: "ಮೂಲ",
          aiSummary: "AI ಸಾರಾಂಶ",
          whySelected: "AI ಇದನ್ನು ಏಕೆ ಆಯ್ಕೆ ಮಾಡಿದೆ",
          // Additional UI elements
          loading: "ಲೋಡ್ ಆಗುತ್ತಿದೆ...",
          translating: "ಲೇಖನಗಳನ್ನು ಅನುವಾದಿಸುತ್ತಿದೆ...",
          refresh: "ರಿಫ್ರೆಶ್",
          listView: "ಪಟ್ಟಿ ವೀಕ್ಷಣೆ",
          gridView: "ಗ್ರಿಡ್ ವೀಕ್ಷಣೆ",
          compactView: "ಕಾಂಪ್ಯಾಕ್ಟ್ ವೀಕ್ಷಣೆ",
          allSources: "ಎಲ್ಲಾ ಮೂಲಗಳು (ಸಂಯೋಜಿತ)",
          allCategories: "ಎಲ್ಲಾ",
          sources: "ಮೂಲಗಳು",
          lastUpdated: "ಕೊನೆಯದಾಗಿ ನವೀಕರಿಸಲಾಗಿದೆ",
          readingTime: "ನಿಮಿಷ ಓದಿ",
          aiCurated: "AI ಕ್ಯೂರೇಟೆಡ್",
          positiveNews: "ಧನಾತ್ಮಕ ಸುದ್ದಿ",
          loadingWeather: "ಹವಾಮಾನ ಲೋಡ್ ಆಗುತ್ತಿದೆ...",
          supportProject: "ಈ ಯೋಜನೆಯನ್ನು ಬೆಂಬಲಿಸಿ",
          premiumSoon: "ಪ್ರೀಮಿಯಂ ಶೀಘ್ರದಲ್ಲೇ",
          readingStats: "ನಿಮ್ಮ ಓದುವ ಅಂಕಿಅಂಶಗಳು",
          aiAgent: "AI ಏಜೆಂಟ್",
          todaysMood: "ಇಂದಿನ ಮನಸ್ಥಿತಿ",
          feedback: "ಸಂದರ್ಶಕರ ಪ್ರತಿಕ್ರಿಯೆ",
          sendFeedback: "ಪ್ರತಿಕ್ರಿಯೆ ಕಳುಹಿಸಿ",
          showMore: "ಹೆಚ್ಚಿನ ಕಥೆಗಳನ್ನು ತೋರಿಸಿ",
          installApp: "ಅಪ್ಲಿಕೇಶನ್ ಸ್ಥಾಪಿಸಿ",
          login: "ಲಾಗಿನ್",
          signUp: "ಸೈನ್ ಅಪ್ ಮಾಡಿ",
          newsFeed: "ಸುದ್ದಿ ಫೀಡ್",
          about: "ಬಗ್ಗೆ",
          noStoriesFound: "ಯಾವುದೇ ಕಥೆಗಳು ಕಂಡುಬಂದಿಲ್ಲ. ದಯವಿಟ್ಟು ನಂತರ ಪ್ರಯತ್ನಿಸಿ.",
          noStoriesAvailable: "ಯಾವುದೇ ಕಥೆಗಳು ಲಭ್ಯವಿಲ್ಲ",
          fetchingStories: "ಅನೇಕ ಮೂಲಗಳಿಂದ ಧನಾತ್ಮಕ ಕಥೆಗಳನ್ನು ಪಡೆಯುತ್ತಿದೆ...",
          // News card specific translations
          netPositiveImpact: "ಧನಾತ್ಮಕ ಪರಿಣಾಮ",
          ongoingStory: "ನಡೆಯುತ್ತಿರುವ ಕಥೆ",
          whatCanIDo: "ನಾನು ಏನು ಮಾಡಬಹುದು?",
          // Hope AI agent translations
          hopeGreeting1: "ಮತ್ತೆ ಸ್ವಾಗತ! ನಾನು ಹೋಪ್, ಮತ್ತು ಇಂದಿನ ಉತ್ತೇಜಕ ಕಥೆಗಳನ್ನು ಹಂಚಿಕೊಳ್ಳಲು ಉತ್ಸುಕನಾಗಿದ್ದೇನೆ! 🌟",
          hopeGreeting2: "ನಮಸ್ಕಾರ! ನಾನು ಹೋಪ್, ಒಳ್ಳೆಯ ಸುದ್ದಿಗಳ ನಿಮ್ಮ ವೈಯಕ್ತಿಕ ಕ್ಯೂರೇಟರ್. ನಿಮ್ಮ ದಿನವನ್ನು ಪ್ರಕಾಶಮಾನವಾಗಿಸೋಣ! 🌈",
          hopeGreeting3: "ನಮಸ್ಕಾರ! ನಾನು ಹೋಪ್, ಮತ್ತು ನಿಮಗಾಗಿ ಅತ್ಯಂತ ಸ್ಫೂರ್ತಿದಾಯಕ ಕಥೆಗಳನ್ನು ಹುಡುಕುವುದರಲ್ಲಿ ನಿರತನಾಗಿದ್ದೇನೆ! 💝",
          globalReads: "ಜಾಗತಿಕ ಓದುಗರು",
          readingNow: "ಈಗ ಓದುತ್ತಿದ್ದಾರೆ",
          hopeSpread: "ಭರವಸೆ ಹರಡುವಿಕೆ",
          oneYearAgoToday: "ಒಂದು ವರ್ಷದ ಹಿಂದೆ ಇಂದು",
          oneYearAgo: "ಒಂದು ವರ್ಷದ ಹಿಂದೆ:"
        },
        categories: {
          all: "ಎಲ್ಲಾ",
          current: "ಪ್ರಸ್ತುತ ವ್ಯವಹಾರಗಳು",
          politics: "ರಾಜಕೀಯ",
          markets: "ಮಾರುಕಟ್ಟೆಗಳು",
          startups: "ಸ್ಟಾರ್ಟಪ್‌ಗಳು",
          ai: "AI ಮತ್ತು ತಂತ್ರಜ್ಞಾನ",
          automobiles: "ಆಟೋಮೊಬೈಲ್ಸ್",
          space: "ಅಂತರಿಕ್ಷ",
          science: "ವಿಜ್ಞಾನ",
          health: "ಆರೋಗ್ಯ",
          environment: "ಪರಿಸರ",
          sports: "ಕ್ರೀಡೆಗಳು",
          design: "ವಿನ್ಯಾಸ",
          culture: "ಸಂಸ್ಕೃತಿ",
          positive: "ಧನಾತ್ಮಕ ಸುದ್ದಿ"
        }
      },
      ml: {
        name: 'മലയാളം',
        flag: '🇮🇳',
        ui: {
          todaysHighlights: "ഇന്നത്തെ പ്രധാന വാർത്തകൾ",
          readMore: "വായിക്കുക",
          source: "ഉറവിടം",
          aiSummary: "AI സംഗ്രഹം",
          whySelected: "AI ഇത് തിരഞ്ഞെടുത്തത് എന്തുകൊണ്ട്",
          // Additional UI elements
          loading: "ലോഡ് ചെയ്യുന്നു...",
          translating: "ലേഖനങ്ങൾ വിവർത്തനം ചെയ്യുന്നു...",
          refresh: "പുതുക്കുക",
          listView: "ലിസ്റ്റ് കാഴ്ച",
          gridView: "ഗ്രിഡ് കാഴ്ച",
          compactView: "കോംപാക്ട് കാഴ്ച",
          allSources: "എല്ലാ ഉറവിടങ്ങളും (സംയോജിത)",
          allCategories: "എല്ലാം",
          sources: "ഉറവിടങ്ങൾ",
          lastUpdated: "അവസാനം അപ്ഡേറ്റ് ചെയ്തത്",
          readingTime: "മിനിറ്റ് വായിക്കുക",
          aiCurated: "AI ക്യൂറേറ്റഡ്",
          positiveNews: "പോസിറ്റീവ് വാർത്തകൾ",
          loadingWeather: "കാലാവസ്ഥ ലോഡ് ചെയ്യുന്നു...",
          supportProject: "ഈ പ്രോജക്റ്റിനെ പിന്തുണയ്ക്കുക",
          premiumSoon: "പ്രീമിയം ഉടൻ വരുന്നു",
          readingStats: "നിങ്ങളുടെ വായനാ സ്ഥിതിവിവരക്കണക്കുകൾ",
          aiAgent: "AI ഏജന്റ്",
          todaysMood: "ഇന്നത്തെ മൂഡ്",
          feedback: "സന്ദർശക പ്രതികരണം",
          sendFeedback: "പ്രതികരണം അയയ്ക്കുക",
          showMore: "കൂടുതൽ കഥകൾ കാണിക്കുക",
          installApp: "ആപ്പ് ഇൻസ്റ്റാൾ ചെയ്യുക",
          login: "ലോഗിൻ",
          signUp: "സൈൻ അപ്പ് ചെയ്യുക",
          newsFeed: "വാർത്താ ഫീഡ്",
          about: "കുറിച്ച്",
          noStoriesFound: "കഥകളൊന്നും കണ്ടെത്തിയില്ല. ദയവായി പിന്നീട് ശ്രമിക്കുക.",
          noStoriesAvailable: "കഥകളൊന്നും ലഭ്യമല്ല",
          fetchingStories: "ഒന്നിലധികം ഉറവിടങ്ങളിൽ നിന്ന് പോസിറ്റീവ് കഥകൾ നേടുന്നു...",
          // News card specific translations
          netPositiveImpact: "പോസിറ്റീവ് സ്വാധീനം",
          ongoingStory: "തുടരുന്ന കഥ",
          whatCanIDo: "എനിക്ക് എന്തു ചെയ്യാൻ കഴിയും?",
          // Hope AI agent translations
          hopeGreeting1: "തിരിച്ചു വരവ്! ഞാൻ ഹോപ്പ്, ഇന്നത്തെ ഉത്തേജകമായ കഥകൾ പങ്കിടാൻ ആവേശത്തിലാണ്! 🌟",
          hopeGreeting2: "ഹലോ! ഞാൻ ഹോപ്പ്, നല്ല വാർത്തകളുടെ നിങ്ങളുടെ വ്യക്തിഗത ക്യൂറേറ്റർ. നിങ്ങളുടെ ദിവസം പ്രകാശമാനമാക്കാം! 🌈",
          hopeGreeting3: "ഹലോ! ഞാൻ ഹോപ്പ്, നിങ്ങൾക്കായി ഏറ്റവും പ്രചോദനാത്മകമായ കഥകൾ കണ്ടെത്തുന്നതിൽ തിരക്കിലായിരുന്നു! 💝",
          globalReads: "ആഗോള വായനകൾ",
          readingNow: "ഇപ്പോൾ വായിക്കുന്നു",
          hopeSpread: "പ്രതീക്ഷ വ്യാപനം",
          oneYearAgoToday: "ഒരു വർഷം മുമ്പ് ഇന്ന്",
          oneYearAgo: "ഒരു വർഷം മുമ്പ്:"
        },
        categories: {
          all: "എല്ലാം",
          current: "നിലവിലെ കാര്യങ്ങൾ",
          politics: "രാഷ്ട്രീയം",
          markets: "വിപണികൾ",
          startups: "സ്റ്റാർട്ടപ്പുകൾ",
          ai: "AI & സാങ്കേതികവിദ്യ",
          automobiles: "ഓട്ടോമൊബൈൽസ്",
          space: "ബഹിരാകാശം",
          science: "ശാസ്ത്രം",
          health: "ആരോഗ്യം",
          environment: "പരിസ്ഥിതി",
          sports: "കായികം",
          design: "ഡിസൈൻ",
          culture: "സംസ്കാരം",
          positive: "പോസിറ്റീവ് വാർത്തകൾ"
        }
      }
    };

    let currentLanguage = localStorage.getItem('preferredLanguage') || 'en';

    // Auto-detect browser language
    function detectLanguage() {
      const browserLang = navigator.language || navigator.userLanguage;
      const langCode = browserLang.split('-')[0];
      if (translations[langCode]) {
        return langCode;
      }
      return 'en';
    }

    // Initialize language
    if (!localStorage.getItem('preferredLanguage')) {
      currentLanguage = detectLanguage();
      localStorage.setItem('preferredLanguage', currentLanguage);
    }

    // Setup language selector
    function setupLanguageSelector() {
      const languageBtn = document.getElementById('language-btn');
      const languageDropdown = document.getElementById('language-dropdown');
      const languageOptions = document.querySelectorAll('.language-option');

      if (!languageBtn) return;

      // Update current language display
      updateLanguageDisplay();

      // Toggle dropdown
      languageBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        languageDropdown.classList.toggle('show');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', () => {
        languageDropdown.classList.remove('show');
      });

      // Language selection
      languageOptions.forEach(option => {
        option.addEventListener('click', () => {
          const lang = option.getAttribute('data-lang');
          changeLanguage(lang);
          languageDropdown.classList.remove('show');
        });
      });
    }

    function updateLanguageDisplay() {
      const currentLangFlag = document.getElementById('current-language-flag');
      const currentLangText = document.getElementById('current-language-text');
      
      if (currentLangFlag && currentLangText && translations[currentLanguage]) {
        currentLangFlag.textContent = translations[currentLanguage].flag;
        currentLangText.textContent = translations[currentLanguage].name;
      }

      // Update active state
      document.querySelectorAll('.language-option').forEach(option => {
        if (option.getAttribute('data-lang') === currentLanguage) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }

    async function changeLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('preferredLanguage', lang);
      updateLanguageDisplay();
      
      // Show loading indicator with translated text
      const newsList = document.getElementById('news-list');
      if (newsList) {
        const t = translations[currentLanguage].ui;
        newsList.innerHTML = `<div style="text-align:center;padding:20px;"><div class="loading-spinner"></div><p style="margin-top:10px;color:#78716c;">${t.translating}</p></div>`;
      }

      updateUITranslations();
      
      // Update Hope message with new language
      if (typeof updateHopeMessage === 'function') {
        updateHopeMessage();
      }
      
      // Reload news with translation
      await loadNews();
    }

    function updateUITranslations() {
      const t = translations[currentLanguage].ui;
      
      // Update section titles
      const sectionTitle = document.querySelector('.section-title h2');
      if (sectionTitle) {
        sectionTitle.textContent = t.todaysHighlights;
      }

      // Update refresh button
      const refreshBtn = document.getElementById('refresh-btn');
      if (refreshBtn) {
        const textNode = Array.from(refreshBtn.childNodes).find(node => node.nodeType === 3);
        if (textNode) {
          textNode.textContent = t.refresh;
        }
      }

      // Update view toggle buttons
      const listViewBtn = document.getElementById('list-view-btn');
      if (listViewBtn) {
        listViewBtn.title = t.listView;
      }
      
      const gridViewBtn = document.getElementById('grid-view-btn');
      if (gridViewBtn) {
        gridViewBtn.title = t.gridView;
      }

      const compactViewBtn = document.getElementById('compact-view-btn');
      if (compactViewBtn) {
        compactViewBtn.title = t.compactView || 'Compact View';
      }

      // Update filter chips text
      const allCategoriesChip = document.querySelector('.filter-chip[data-filter="all"]');
      if (allCategoriesChip) {
        const textNode = Array.from(allCategoriesChip.childNodes).find(node => node.nodeType === 3);
        if (textNode) {
          textNode.textContent = t.allCategories || 'All';
        }
      }

      // Update all category filter chips
      const categoryTranslations = translations[currentLanguage].categories || {};
      const filterChipMap = {
        'current': 'current',
        'ai': 'ai',
        'startups': 'startups',
        'markets': 'markets',
        'automobiles': 'automobiles',
        'science': 'science',
        'space': 'space',
        'health': 'health',
        'environment': 'environment',
        'politics': 'politics',
        'sports': 'sports',
        'culture': 'culture',
        'design': 'design',
        'positive': 'positive'
      };

      Object.entries(filterChipMap).forEach(([dataFilter, categoryKey]) => {
        const chip = document.querySelector(`.filter-chip[data-filter="${dataFilter}"]`);
        if (chip && categoryTranslations[categoryKey]) {
          const textNode = Array.from(chip.childNodes).find(node => node.nodeType === 3);
          if (textNode) {
            textNode.textContent = categoryTranslations[categoryKey];
          }
        }
      });

      // Update sources count label
      const sourcesCountLabel = document.getElementById('sources-count-label');
      if (sourcesCountLabel) {
        sourcesCountLabel.textContent = t.allSources || 'All sources (combined)';
      }

      // Update sources label
      const sourcesLabel = document.querySelector('.sources-label');
      if (sourcesLabel) {
        const span = sourcesLabel.querySelector('span:last-child');
        if (span) span.textContent = t.sources || 'Sources';
      }

      // Update last updated text
      const lastUpdatedEl = document.getElementById('last-updated');
      if (lastUpdatedEl && lastUpdatedEl.textContent.includes('Fetching')) {
        lastUpdatedEl.textContent = t.loading || 'Loading...';
      }

      // Update weather widget
      const weatherText = document.getElementById('weather-text');
      if (weatherText && weatherText.textContent.includes('Loading')) {
        weatherText.textContent = t.loadingWeather || 'Loading weather...';
      }

      // Update sidebar titles
      const sidebarTitles = {
        'Support This Project': t.supportProject || 'Support This Project',
        'Premium Coming Soon': t.premiumSoon || 'Premium Coming Soon',
        'Your Reading Stats': t.readingStats || 'Your Reading Stats',
        'AI Agent': t.aiAgent || 'AI Agent',
        "Today's Mood": t.todaysMood || "Today's Mood",
        'Visitor Feedback': t.feedback || 'Visitor Feedback'
      };

      document.querySelectorAll('.sidebar-card h3').forEach(h3 => {
        const englishText = h3.textContent.trim();
        if (sidebarTitles[englishText]) {
          h3.textContent = sidebarTitles[englishText];
        }
      });

      // Update button texts
      const buttonTexts = {
        'Send feedback': t.sendFeedback || 'Send feedback',
        'Show more stories': t.showMore || 'Show more stories',
        'Install App': t.installApp || 'Install App',
        'Login': t.login || 'Login',
        'Sign Up': t.signUp || 'Sign Up'
      };

      document.querySelectorAll('button').forEach(btn => {
        const text = btn.textContent.trim();
        if (buttonTexts[text]) {
          btn.textContent = buttonTexts[text];
        }
      });

      // Update navigation links
      const navTexts = {
        'News Feed': t.newsFeed || 'News Feed',
        'About': t.about || 'About'
      };

      document.querySelectorAll('.nav-link').forEach(link => {
        const text = link.textContent.trim();
        if (navTexts[text]) {
          link.textContent = navTexts[text];
        }
      });

      // Update last updated text
      const lastUpdatedLabel = document.querySelector('#last-updated-label');
      if (lastUpdatedLabel) {
        lastUpdatedLabel.textContent = t.lastUpdated + ':';
      }

      // Update loading text in the translation loading message
      const loadingMessage = document.querySelector('.loading-spinner + p');
      if (loadingMessage && loadingMessage.textContent.includes('Translating')) {
        loadingMessage.textContent = t.translating;
      }

      // Update Hope AI agent stats labels
      const communityStatLabels = document.querySelectorAll('.community-stat-label');
      if (communityStatLabels.length >= 3) {
        communityStatLabels[0].textContent = t.globalReads || 'Global Reads';
        communityStatLabels[1].textContent = t.readingNow || 'Reading Now';
        communityStatLabels[2].textContent = t.hopeSpread || 'Hope Spread';
      }

      // Update Time Capsule title
      const timeCapsuleTitle = document.querySelector('.time-capsule-title span:last-child');
      if (timeCapsuleTitle) {
        timeCapsuleTitle.textContent = t.oneYearAgoToday || 'One Year Ago Today';
      }

      // Note: News cards will be recreated by loadNews() which is called after this function
      // So we don't need to update individual card elements here
    }

    // Handle Read More clicks with language-specific behavior
    function handleReadMore(url, title, language, category, sourceKey) {
      // Track the article read
      trackArticleRead(url, category, sourceKey);
      
      if (language === 'en') {
        // For English, open directly
        window.open(url, '_blank', 'noopener,noreferrer');
      } else {
        // For other languages, show translation modal
        showTamilModal(url, title, language);
      }
    }

    // Tamil/Multi-language modal with enhanced content
    function showTamilModal(url, title, language) {
      const t = translations[language];
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease;
      `;

      // Check if this is authentic Tamil content
      const decodedTitle = decodeURIComponent(title);
      const isAuthentic = isTamilContent(decodedTitle) || decodedTitle.includes('[தமிழ் மூலம்]');

      // Enhanced Tamil content based on authenticity
      // Build content without nested template literals
      let tamilContent = '';
      
      if (language === 'ta') {
        tamilContent = '<div style="margin-bottom: 20px;">';
        tamilContent += '<h3 style="color: #1e40af; margin-bottom: 12px; line-height: 1.4;">' + decodedTitle + '</h3>';
        
        if (isAuthentic) {
          tamilContent += '<div style="background: #dcfce7; border-left: 4px solid #059669; padding: 16px; margin-bottom: 16px; border-radius: 8px;">';
          tamilContent += '<h4 style="color: #059669; margin-bottom: 8px; font-size: 1rem;">✅ முழுமையான தமிழ் செய்தி</h4>';
          tamilContent += '<p style="line-height: 1.6; color: #374151; margin-bottom: 12px;">இது தமிழ் மூலங்களில் இருந்து வரும் முழுமையான தமிழ் செய்தி. நம்பகமான தமிழ் ஊடகங்களின் அசல் உள்ளடக்கம்.</p>';
          tamilContent += '<div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 12px;">';
          tamilContent += '<span style="background: #dcfce7; color: #059669; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">🇮🇳 தமிழ் அசல்</span>';
          tamilContent += '<span style="background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">✅ நம்பகமான</span>';
          tamilContent += '</div></div>';
        } else {
          tamilContent += '<div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; margin-bottom: 16px; border-radius: 8px;">';
          tamilContent += '<h4 style="color: #d97706; margin-bottom: 8px; font-size: 1rem;">📰 மொழிபெயர்க்கப்பட்ட செய்தி</h4>';
          tamilContent += '<p style="line-height: 1.6; color: #374151; margin-bottom: 12px;">இந்த செய்தி ஆங்கில மூலத்திலிருந்து தமிழுக்கு மொழிபெயர்க்கப்பட்டுள்ளது.</p>';
          tamilContent += '</div>';
        }
        
        tamilContent += '<div style="background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; padding: 16px; margin-bottom: 16px;">';
        tamilContent += '<h4 style="color: #1e40af; margin-bottom: 8px; font-size: 0.9rem;">🔍 இந்த செய்தியில்:</h4>';
        tamilContent += '<ul style="color: #64748b; font-size: 0.85rem; line-height: 1.5; margin-left: 16px;">';
        
        if (isAuthentic) {
          tamilContent += '<li>முழு செய்தி தமிழில் கிடைக்கும்</li>';
          tamilContent += '<li>நம்பகமான தமிழ் ஊடக மூலங்கள்</li>';
        } else {
          tamilContent += '<li>ஆங்கில மூலத்திலிருந்து மொழிபெயர்ப்பு</li>';
          tamilContent += '<li>சர்வதேச செய்தி தமிழில்</li>';
        }
        
        tamilContent += '</ul></div></div>';
      } else {
        tamilContent = '<div style="margin-bottom: 20px;">';
        tamilContent += '<h3 style="color: #1e40af; margin-bottom: 12px; line-height: 1.4;">[' + t.name + '] ' + decodedTitle + '</h3>';
        tamilContent += '<p style="line-height: 1.6; margin-bottom: 16px; color: #374151;">இந்த கட்டுரை ' + t.name + ' மொழியில் கிடைக்கிறது.</p>';
        tamilContent += '</div>';
      }

      // Build the modal buttons HTML
      let buttonsHTML = '';
      
      if (isAuthentic && language === 'ta') {
        buttonsHTML += `
          <button onclick="showTamilSummary('${encodeURIComponent(decodedTitle)}')" style="
            background: #059669;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
          " onmouseover="this.style.background='#047857'" onmouseout="this.style.background='#059669'">
            📝 தமிழ் சுருக்கம் காட்டு
          </button>`;
      }
      
      const readButtonText = language === 'ta' ? (isAuthentic ? '📖 தமிழில் முழு செய்தியைப் படிக்க' : '🌐 மூல கட்டுரையைப் பார்க்க (ஆங்கிலத்தில்)') : 'மூல கட்டுரையைப் பார்க்கவும்';
      
      buttonsHTML += `
        <button onclick="window.open('${url}', '_blank', 'noopener,noreferrer')" style="
          background: #1e40af;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 8px;
          cursor: pointer;
          margin-right: 12px;
          font-weight: 600;
          font-size: 0.9rem;
          transition: all 0.2s;
        " onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#1e40af'">
          ${readButtonText}
        </button>
        <button onclick="this.closest('div').parentElement.remove()" style="
          background: #6b7280;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
          font-size: 0.9rem;
          transition: all 0.2s;
        " onmouseover="this.style.background='#4b5563'" onmouseout="this.style.background='#6b7280'">
          மூடு
        </button>`;

      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 12px;
          padding: 24px;
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
          margin: 20px;
          position: relative;
          animation: slideIn 0.3s ease;
        ">
          <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 16px;
          ">
            <h2 style="margin: 0; color: #1e40af; font-size: 1.25rem;">
              ${language === 'ta' ? '📰 தமிழ் செய்தி' : t.name + ' மொழிபெயர்ப்பு'}
            </h2>
            <button onclick="this.closest('div').parentElement.remove()" style="
              background: none;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #64748b;
              padding: 4px;
              border-radius: 4px;
              transition: background 0.2s;
            " onmouseover="this.style.background='#f1f5f9'" onmouseout="this.style.background='none'">&times;</button>
          </div>
          
          ${tamilContent}
          
          <div style="text-align: center; border-top: 1px solid #e2e8f0; padding-top: 16px;">
            ${buttonsHTML}
          </div>
        </div>
      `;

      // Add CSS animations
      const style = document.createElement('style');
      style.textContent = `
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes slideIn {
          from { transform: scale(0.9) translateY(-20px); opacity: 0; }
          to { transform: scale(1) translateY(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);

      document.body.appendChild(modal);
      
      // Close on outside click
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          modal.remove();
        }
      });
      
      // Close on Escape key
      const handleEscape = function(e) {
        if (e.key === 'Escape') {
          modal.remove();
          document.removeEventListener('keydown', handleEscape);
        }
      };
      document.addEventListener('keydown', handleEscape);
    }

    // Make functions globally accessible
    window.handleReadMore = handleReadMore;
    window.showTamilModal = showTamilModal;

    // Tamil summary function for authentic Tamil content
    function showTamilSummary(title) {
      const decodedTitle = decodeURIComponent(title);
      
      // Create summary modal
      const summaryModal = document.createElement('div');
      summaryModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10001;
        animation: fadeIn 0.3s ease;
      `;

      // Generate Tamil summary content
      const summaryContent = `
        <div style="
          background: white;
          border-radius: 12px;
          padding: 24px;
          max-width: 600px;
          max-height: 80vh;
          overflow-y: auto;
          margin: 20px;
          position: relative;
        ">
          <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 16px;
          ">
            <h2 style="margin: 0; color: #059669; font-size: 1.25rem;">
              📝 தமிழ் செய்தி சுருக்கம்
            </h2>
            <button onclick="this.closest('div').parentElement.remove()" style="
              background: none;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #64748b;
              padding: 4px;
              border-radius: 4px;
            ">&times;</button>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h3 style="color: #1e40af; margin-bottom: 16px; line-height: 1.4; font-size: 1.1rem;">
              ${decodedTitle}
            </h3>
            
            <div style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
              <h4 style="color: #059669; margin-bottom: 12px; font-size: 1rem;">🎯 முக்கிய புள்ளிகள்:</h4>
              <ul style="color: #374151; font-size: 0.9rem; line-height: 1.6; margin-left: 16px;">
                <li>இந்த செய்தி தமிழ் ஊடகங்களில் இருந்து வந்துள்ளது</li>
                <li>நம்பகமான தமிழ் மூலங்களின் அசல் உள்ளடக்கம்</li>
                <li>தமிழ் வாசகர்களுக்கு ஏற்ற வகையில் வழங்கப்பட்டுள்ளது</li>
                <li>உள்ளூர் சூழல் மற்றும் கலாச்சாரத்துடன் தொடர்புடையது</li>
              </ul>
            </div>
            
            <div style="background: #fef7ff; border: 1px solid #e9d5ff; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
              <h4 style="color: #7c3aed; margin-bottom: 8px; font-size: 0.9rem;">💡 ஏன் இது முக்கியம்?</h4>
              <p style="color: #374151; font-size: 0.85rem; line-height: 1.5; margin: 0;">
                தமிழ் மொழியில் அசல் செய்திகள் படிப்பது மொழியின் வளர்ச்சிக்கும், 
                உள்ளூர் விஷயங்களைப் புரிந்துகொள்வதற்கும் உதவுகிறது. 
                இது தமிழ் ஊடகத்துறையின் வளர்ச்சிக்கும் பங்களிக்கிறது.
              </p>
            </div>
            
            <div style="background: #fffbeb; border: 1px solid #fed7aa; border-radius: 8px; padding: 16px;">
              <h4 style="color: #d97706; margin-bottom: 8px; font-size: 0.9rem;">📚 மேலும் அறிய:</h4>
              <p style="color: #374151; font-size: 0.85rem; line-height: 1.5; margin: 0;">
                முழு கட்டுரையைப் படிக்க மேலே உள்ள "தமிழில் முழு செய்தியைப் படிக்க" பொத்தானைக் கிளிக் செய்யவும். 
                இது உங்களை நேரடியாக தமிழ் செய்தி இணையதளத்திற்கு அழைத்துச் செல்லும்.
              </p>
            </div>
          </div>
          
          <div style="text-align: center; border-top: 1px solid #e2e8f0; padding-top: 16px;">
            <button onclick="this.closest('div').parentElement.remove()" style="
              background: #059669;
              color: white;
              border: none;
              padding: 12px 24px;
              border-radius: 8px;
              cursor: pointer;
              font-weight: 600;
              font-size: 0.9rem;
              transition: all 0.2s;
            " onmouseover="this.style.background='#047857'" onmouseout="this.style.background='#059669'">
              சரி, புரிந்தது
            </button>
          </div>
        </div>
      `;

      summaryModal.innerHTML = summaryContent;
      document.body.appendChild(summaryModal);
      
      // Close on outside click
      summaryModal.addEventListener('click', function(e) {
        if (e.target === summaryModal) {
          summaryModal.remove();
        }
      });
    }

    // Make Tamil summary function globally accessible
    window.showTamilSummary = showTamilSummary;

    // Translate text using Google Translate API (free tier)
    async function translateText(text, targetLang) {
      if (targetLang === 'en' || !text) return text;

      // In production, use Google Translate API or similar
      // For now, return original text with a note
      // You can integrate with: https://cloud.google.com/translate
      
      return text; // Placeholder - integrate translation API here
    }

    // ======================
    // PERFORMANCE OPTIMIZATIONS
    // ======================
    
    // Lazy load images with Intersection Observer
    function setupLazyLoading() {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.removeAttribute('data-src');
              observer.unobserve(img);
            }
          }
        });
      }, {
        rootMargin: '50px'
      });

      // Observe all images with data-src
      document.querySelectorAll('img[data-src]').forEach(img => {
        imageObserver.observe(img);
      });
    }

    // Cache articles in localStorage for offline access
    function cacheArticles(articles) {
      try {
        const cache = {
          articles: articles.slice(0, 20), // Cache first 20 articles
          timestamp: Date.now(),
          language: currentLanguage
        };
        localStorage.setItem('cachedArticles', JSON.stringify(cache));
      } catch (e) {
        console.warn('Failed to cache articles:', e);
      }
    }

    function getCachedArticles() {
      try {
        const cache = JSON.parse(localStorage.getItem('cachedArticles'));
        if (cache && cache.language === currentLanguage) {
          const age = Date.now() - cache.timestamp;
          // Cache valid for 1 hour
          if (age < 3600000) {
            return cache.articles;
          }
        }
      } catch (e) {
        console.warn('Failed to get cached articles:', e);
      }
      return null;
    }

    // ======================
    // PREMIUM FEATURES
    // ======================
    window.showPremiumModal = function() {
      document.getElementById('premium-modal').classList.add('show');
    };

    // Premium waitlist form
    const premiumForm = document.getElementById('premium-waitlist-form');
    if (premiumForm) {
      premiumForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('premium-email').value;
        const statusEl = document.getElementById('premium-waitlist-status');
        
        // Store in localStorage (in production, send to backend)
        const waitlist = JSON.parse(localStorage.getItem('premiumWaitlist') || '[]');
        if (!waitlist.includes(email)) {
          waitlist.push(email);
          localStorage.setItem('premiumWaitlist', JSON.stringify(waitlist));
        }
        
        statusEl.innerHTML = '<span style="color: #15803d;">✅ You\'re on the list! We\'ll notify you when Premium launches.</span>';
        document.getElementById('premium-email').value = '';
        
        setTimeout(() => {
          document.getElementById('premium-modal').classList.remove('show');
          statusEl.innerHTML = '';
        }, 3000);
      });
    }

    // ======================
    // TRIGGER INSTALL FUNCTION
    // ======================
    window.triggerInstall = function() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
          }
          deferredPrompt = null;
        });
      } else {
        // Show manual install instructions
        showInstallInstructions();
      }
    };

    function showInstallInstructions() {
      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
      const isAndroid = /Android/i.test(navigator.userAgent);
      
      let message = '';
      
      if (isIOS) {
        message = `To install on iPhone/iPad:\n\n1. Tap the Share button (⬆️) at the bottom\n2. Scroll and tap "Add to Home Screen"\n3. Tap "Add"\n\nThe app will appear on your home screen!`;
      } else if (isAndroid) {
        message = `To install on Android:\n\n1. Tap the menu (⋮) in your browser\n2. Select "Install app" or "Add to Home screen"\n3. Tap "Install"\n\nThe app will appear on your home screen!`;
      } else {
        message = `To install on Desktop:\n\n1. Look for the install icon (⊕) in the address bar\n2. Click it and select "Install"\n\nOr:\n1. Click the menu (⋮) in your browser\n2. Select "Install Mahesh +ve Pill..."\n\nThe app will open in its own window!`;
      }
      
      alert(message);
    }

    // ======================
    // PWA INSTALLATION
    // ======================
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // Show install button in nav
      const installBtn = document.getElementById('pwa-install-btn');
      if (installBtn) {
        installBtn.style.display = 'inline-block';
        installBtn.addEventListener('click', async () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response: ${outcome}`);
            if (outcome === 'accepted') {
              installBtn.style.display = 'none';
            }
            deferredPrompt = null;
          }
        });
      }
      
      // Show install prompt banner
      showInstallPrompt();
    });

    function showInstallPrompt() {
      // Create install banner
      const banner = document.createElement('div');
      banner.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        max-width: 400px;
        margin: 0 auto;
        padding: 16px;
        background: linear-gradient(135deg, #f97316, #ea580c);
        color: white;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(249, 115, 22, 0.4);
        z-index: 9999;
        display: flex;
        align-items: center;
        gap: 12px;
      `;
      
      banner.innerHTML = `
        <span style="font-size: 1.5rem;">📱</span>
        <div style="flex: 1;">
          <div style="font-weight: 600; margin-bottom: 4px;">Install App</div>
          <div style="font-size: 0.8rem; opacity: 0.9;">Get offline access and notifications</div>
        </div>
        <button id="install-btn" style="
          padding: 8px 16px;
          background: white;
          color: #ea580c;
          border: none;
          border-radius: 999px;
          font-weight: 600;
          cursor: pointer;
        ">Install</button>
        <button id="dismiss-install" style="
          padding: 8px;
          background: transparent;
          color: white;
          border: none;
          cursor: pointer;
          font-size: 1.2rem;
        ">&times;</button>
      `;
      
      document.body.appendChild(banner);
      
      document.getElementById('install-btn').addEventListener('click', async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`User response: ${outcome}`);
          deferredPrompt = null;
          banner.remove();
        }
      });
      
      document.getElementById('dismiss-install').addEventListener('click', () => {
        banner.remove();
      });
    }

    // Register service worker with update handling
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/Dashboard1/service-worker.js?v=3')
          .then((registration) => {
            console.log('ServiceWorker registered:', registration);
            
            // Check for updates every 30 seconds
            setInterval(() => {
              registration.update();
            }, 30000);
            
            // Handle service worker updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New service worker is available, show update notification
                  showUpdateNotification();
                }
              });
            });
          })
          .catch((error) => {
            console.log('ServiceWorker registration failed:', error);
          });
      });
    }

    // Show update notification
    function showUpdateNotification() {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--accent);
        color: white;
        padding: 12px 20px;
        border-radius: var(--radius-md);
        box-shadow: var(--shadow-strong);
        z-index: 10000;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        animation: slideDown 0.3s ease;
      `;
      notification.innerHTML = '🔄 New version available! Click to refresh';
      notification.onclick = () => {
        window.location.reload();
      };
      
      document.body.appendChild(notification);
      
      // Auto-remove after 10 seconds
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 10000);
    }

    // ======================
    // TEXT-TO-SPEECH
    // ======================
    let speechSynthesis = window.speechSynthesis;
    let currentUtterance = null;
    let isReading = false;

    document.getElementById('tts-play-btn').addEventListener('click', startReading);
    document.getElementById('tts-stop-btn').addEventListener('click', stopReading);

    function startReading() {
      if (isReading) {
        stopReading();
        return;
      }

      // Get all visible article titles and descriptions
      const articles = Array.from(document.querySelectorAll('.news-card:not(.hidden)'));
      
      if (articles.length === 0) {
        alert('No articles to read');
        return;
      }

      let textToRead = 'Reading today\'s positive news. ';
      
      articles.slice(0, 5).forEach((article, index) => {
        const title = article.querySelector('.news-title')?.textContent || '';
        const summary = article.querySelector('.ai-summary')?.textContent || '';
        textToRead += `Article ${index + 1}. ${title}. ${summary}. `;
      });

      currentUtterance = new SpeechSynthesisUtterance(textToRead);
      currentUtterance.rate = 0.9;
      currentUtterance.pitch = 1;
      currentUtterance.volume = 1;

      currentUtterance.onstart = () => {
        isReading = true;
        document.getElementById('tts-play-btn').style.display = 'none';
        document.getElementById('tts-stop-btn').style.display = 'flex';
        document.getElementById('tts-stop-btn').classList.add('active');
      };

      currentUtterance.onend = () => {
        stopReading();
      };

      speechSynthesis.speak(currentUtterance);
    }

    function stopReading() {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }
      isReading = false;
      document.getElementById('tts-play-btn').style.display = 'flex';
      document.getElementById('tts-stop-btn').style.display = 'none';
      document.getElementById('tts-stop-btn').classList.remove('active');
    }

    // ======================
    // KEYBOARD SHORTCUTS
    // ======================
    document.addEventListener('keydown', (e) => {
      // Ignore if user is typing in an input
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
        return;
      }

      // Show shortcuts help
      if (e.key === '?' || (e.shiftKey && e.key === '/')) {
        e.preventDefault();
        document.getElementById('shortcuts-modal').classList.add('show');
      }

      // Close modals with Escape
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal, .keyboard-shortcuts-modal').forEach(modal => {
          modal.classList.remove('show');
        });
      }

      // Refresh feed
      if (e.key === 'r' || e.key === 'R') {
        e.preventDefault();
        document.getElementById('refresh-btn')?.click();
      }

      // Read aloud
      if (e.altKey && (e.key === 'r' || e.key === 'R')) {
        e.preventDefault();
        startReading();
      }

      // Stop reading
      if (e.altKey && (e.key === 's' || e.key === 'S')) {
        e.preventDefault();
        stopReading();
      }

      // View stats
      if (e.key === 's' || e.key === 'S') {
        e.preventDefault();
        showStatsModal();
      }

      // Jump to discussions
      if (e.key === 'd' || e.key === 'D') {
        e.preventDefault();
        document.getElementById('discussion-section')?.scrollIntoView({ behavior: 'smooth' });
      }

      // Filter shortcuts
      const filterButtons = document.querySelectorAll('.filter-chip[data-filter]');
      if (e.key >= '1' && e.key <= '9') {
        const index = parseInt(e.key) - 1;
        if (filterButtons[index]) {
          e.preventDefault();
          filterButtons[index].click();
        }
      }
    });

    // ======================
    // PRINT FUNCTIONALITY
    // ======================
    // Add print button to header
    const printBtn = document.createElement('button');
    printBtn.innerHTML = '🖨️ Print';
    printBtn.style.cssText = `
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #fed7aa;
      background: transparent;
      color: #78716c;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.16s ease-out;
    `;
    printBtn.onmouseover = () => {
      printBtn.style.borderColor = '#fed7aa';
      printBtn.style.background = '#fff8ed';
      printBtn.style.color = '#292524';
    };
    printBtn.onmouseout = () => {
      printBtn.style.borderColor = '#fed7aa';
      printBtn.style.background = 'transparent';
      printBtn.style.color = '#78716c';
    };
    printBtn.onclick = () => window.print();
    
    // Add to nav
    const nav = document.querySelector('nav');
    if (nav) {
      nav.appendChild(printBtn);
    }

    // ======================
    // AGENTIC AI FEATURES
    // ======================
    
    // AI Agent Profile - learns from user behavior
    class AIAgent {
      constructor() {
        this.profile = this.loadProfile();
      }

      loadProfile() {
        const saved = localStorage.getItem('aiAgentProfile');
        if (saved) {
          return JSON.parse(saved);
        }
        return {
          readingHistory: [],
          categoryPreferences: {},
          sourcePreferences: {},
          timePreferences: {},
          readingSpeed: 200, // words per minute
          preferredLength: 'medium', // short, medium, long
          moodPreference: 'balanced', // uplifting, balanced, serious
          lastActive: null,
          totalInteractions: 0,
          learningEnabled: true
        };
      }

      saveProfile() {
        localStorage.setItem('aiAgentProfile', JSON.stringify(this.profile));
      }

      // Learn from reading behavior
      learnFromRead(article, timeSpent) {
        if (!this.profile.learningEnabled) return;

        this.profile.readingHistory.push({
          url: article.url,
          category: article.category,
          source: article.sourceKey,
          timestamp: Date.now(),
          timeSpent: timeSpent,
          title: article.title
        });

        // Keep only last 100 reads
        if (this.profile.readingHistory.length > 100) {
          this.profile.readingHistory = this.profile.readingHistory.slice(-100);
        }

        // Update category preferences
        this.profile.categoryPreferences[article.category] = 
          (this.profile.categoryPreferences[article.category] || 0) + 1;

        // Update source preferences
        this.profile.sourcePreferences[article.sourceKey] = 
          (this.profile.sourcePreferences[article.sourceKey] || 0) + 1;

        // Update time preferences
        const hour = new Date().getHours();
        const timeSlot = hour < 12 ? 'morning' : hour < 17 ? 'afternoon' : 'evening';
        this.profile.timePreferences[timeSlot] = 
          (this.profile.timePreferences[timeSlot] || 0) + 1;

        this.profile.totalInteractions++;
        this.profile.lastActive = Date.now();
        this.saveProfile();
      }

      // Calculate article relevance score
      calculateRelevance(article) {
        let score = 50; // Base score

        // Category preference boost
        const categoryReads = this.profile.categoryPreferences[article.category] || 0;
        const totalReads = Object.values(this.profile.categoryPreferences).reduce((a, b) => a + b, 0);
        if (totalReads > 0) {
          score += (categoryReads / totalReads) * 30;
        }

        // Source preference boost
        const sourceReads = this.profile.sourcePreferences[article.sourceKey] || 0;
        const totalSourceReads = Object.values(this.profile.sourcePreferences).reduce((a, b) => a + b, 0);
        if (totalSourceReads > 0) {
          score += (sourceReads / totalSourceReads) * 20;
        }

        // Recency boost
        if (article.publishedAt) {
          const ageHours = (Date.now() - new Date(article.publishedAt).getTime()) / (1000 * 60 * 60);
          if (ageHours < 6) score += 15;
          else if (ageHours < 24) score += 10;
          else if (ageHours < 48) score += 5;
        }

        return Math.min(100, score);
      }

      // Get personalized recommendations
      getRecommendations(articles, count = 5) {
        if (this.profile.totalInteractions < 3) {
          // Not enough data, return diverse selection
          return this.getDiverseSelection(articles, count);
        }

        // Score all articles
        const scored = articles.map(article => ({
          article,
          score: this.calculateRelevance(article)
        }));

        // Sort by score and return top N
        return scored
          .sort((a, b) => b.score - a.score)
          .slice(0, count)
          .map(item => item.article);
      }

      getDiverseSelection(articles, count) {
        const categories = [...new Set(articles.map(a => a.category))];
        const perCategory = Math.ceil(count / categories.length);
        const selected = [];

        categories.forEach(cat => {
          const catArticles = articles.filter(a => a.category === cat);
          selected.push(...catArticles.slice(0, perCategory));
        });

        return selected.slice(0, count);
      }

      // Estimate reading time
      estimateReadingTime(article) {
        const text = `${article.title || ''} ${article.description || ''} ${article.content || ''}`;
        const wordCount = text.split(/\s+/).length;
        const minutes = Math.ceil(wordCount / this.profile.readingSpeed);
        return minutes;
      }

      // Get articles matching available time
      getArticlesForTime(articles, availableMinutes) {
        return articles.filter(article => {
          const readTime = this.estimateReadingTime(article);
          return readTime <= availableMinutes;
        });
      }

      // Mood-based filtering
      filterByMood(articles) {
        if (this.profile.moodPreference === 'balanced') {
          return articles;
        }

        return articles.map(article => {
          const text = `${article.title || ''} ${article.description || ''}`.toLowerCase();
          let moodScore = 0;

          // Uplifting keywords
          if (text.match(/success|win|achievement|breakthrough|innovation|growth|positive/i)) {
            moodScore += 2;
          }

          // Serious keywords
          if (text.match(/crisis|concern|challenge|issue|problem|decline/i)) {
            moodScore -= 1;
          }

          article.moodScore = moodScore;
          return article;
        }).filter(article => {
          if (this.profile.moodPreference === 'uplifting') {
            return article.moodScore >= 0;
          }
          return true; // serious mode shows all
        });
      }

      // Generate personalized insight
      getPersonalizedInsight() {
        if (this.profile.totalInteractions < 5) {
          return "🤖 AI is learning your preferences. Keep reading to get personalized recommendations!";
        }

        const topCategory = Object.entries(this.profile.categoryPreferences)
          .sort((a, b) => b[1] - a[1])[0];

        const topTime = Object.entries(this.profile.timePreferences)
          .sort((a, b) => b[1] - a[1])[0];

        return `🤖 AI Insight: You love ${topCategory[0]} news and prefer reading in the ${topTime[0]}. I've prioritized similar content for you!`;
      }

      // Reset learning
      reset() {
        this.profile = {
          readingHistory: [],
          categoryPreferences: {},
          sourcePreferences: {},
          timePreferences: {},
          readingSpeed: 200,
          preferredLength: 'medium',
          moodPreference: 'balanced',
          lastActive: null,
          totalInteractions: 0,
          learningEnabled: true
        };
        this.saveProfile();
      }
    }

    // Initialize AI Agent
    const aiAgent = new AIAgent();

    // Enhanced article tracking with AI learning
    const originalTrackArticleRead = window.trackArticleRead || function() {};
    window.trackArticleRead = function(url, category, source) {
      originalTrackArticleRead(url, category, source);
      
      // Find the article
      const article = state.allArticles.find(a => a.url === url);
      if (article) {
        // Estimate time spent (in production, track actual time)
        const estimatedTime = aiAgent.estimateReadingTime(article);
        aiAgent.learnFromRead(article, estimatedTime);
        
        // Update AI insights display
        updateAIInsights();
      }
    };

    // Apply AI curation to articles
    function applyAICuration(articles) {
      if (!aiAgent.profile.learningEnabled) {
        return articles;
      }

      // Filter by mood
      let curated = aiAgent.filterByMood(articles);

      // Add relevance scores
      curated = curated.map(article => {
        article.aiRelevance = aiAgent.calculateRelevance(article);
        article.readingTime = aiAgent.estimateReadingTime(article);
        return article;
      });

      // Sort by relevance
      curated.sort((a, b) => b.aiRelevance - a.aiRelevance);

      return curated;
    }

    // Update AI insights in UI
    function updateAIInsights() {
      const insightEl = document.getElementById('ai-agent-insight');
      if (insightEl) {
        insightEl.textContent = aiAgent.getPersonalizedInsight();
      }

      const statsEl = document.getElementById('ai-learning-stats');
      if (statsEl) {
        const topCat = Object.entries(aiAgent.profile.categoryPreferences)
          .sort((a, b) => b[1] - a[1])[0];
        
        statsEl.innerHTML = `
          <div style="font-size: 0.75rem; color: #78716c;">
            📊 ${aiAgent.profile.totalInteractions} interactions<br>
            ${topCat ? `❤️ Favorite: ${topCat[0]}` : '🌱 Building your profile...'}
          </div>
        `;
      }
    }

    // Show AI recommendations panel
    function showAIRecommendations() {
      const modal = document.getElementById('ai-recommendations-modal');
      if (!modal) return;

      const recommendations = aiAgent.getRecommendations(state.allArticles, 5);
      const container = document.getElementById('ai-recommendations-list');
      
      if (recommendations.length === 0) {
        container.innerHTML = '<p style="color: #78716c; text-align: center;">No recommendations available yet. Keep reading!</p>';
      } else {
        container.innerHTML = recommendations.map(article => `
          <div style="padding: 12px; background: #fff8ed; border-radius: 12px; margin-bottom: 10px; border-left: 3px solid #f97316;">
            <div style="font-weight: 600; color: #292524; margin-bottom: 4px;">${article.title}</div>
            <div style="font-size: 0.75rem; color: #78716c; margin-bottom: 6px;">
              ${article.category.toUpperCase()} • ${article.readingTime || 3} min read • ${Math.round(article.aiRelevance || 50)}% match
            </div>
            <a href="${article.url}" target="_blank" style="font-size: 0.8rem; color: #f97316; text-decoration: none;">
              Read article ↗
            </a>
          </div>
        `).join('');
      }

      modal.classList.add('show');
    }

    // Quick read mode - articles under 3 minutes
    function showQuickReads() {
      const quickReads = aiAgent.getArticlesForTime(state.allArticles, 3);
      const modal = document.getElementById('quick-reads-modal');
      if (!modal) return;

      const container = document.getElementById('quick-reads-list');
      container.innerHTML = quickReads.slice(0, 8).map(article => `
        <div style="padding: 10px; background: #fff8ed; border-radius: 10px; margin-bottom: 8px;">
          <div style="font-weight: 600; font-size: 0.85rem; color: #292524; margin-bottom: 4px;">${article.title}</div>
          <div style="font-size: 0.7rem; color: #78716c; margin-bottom: 6px;">
            ⏱️ ${article.readingTime || 2} min • ${article.category.toUpperCase()}
          </div>
          <a href="${article.url}" target="_blank" style="font-size: 0.75rem; color: #f97316; text-decoration: none;">
            Quick read ↗
          </a>
        </div>
      `).join('');

      modal.classList.add('show');
    }

    // Show AI Details Modal
    function showAIDetails() {
      const modal = document.getElementById('ai-details-modal');
      if (modal) {
        modal.classList.add('show');
      }
    }

    // Toggle AI learning
    function toggleAILearning() {
      aiAgent.profile.learningEnabled = !aiAgent.profile.learningEnabled;
      aiAgent.saveProfile();
      
      const btn = document.getElementById('toggle-ai-learning-btn');
      if (btn) {
        btn.textContent = aiAgent.profile.learningEnabled ? '🤖 AI Learning: ON' : '🤖 AI Learning: OFF';
        btn.style.background = aiAgent.profile.learningEnabled ? 
          'linear-gradient(135deg, #f97316, #ea580c)' : '#9ca3af';
      }

      alert(aiAgent.profile.learningEnabled ? 
        'AI learning enabled! The system will learn from your reading patterns.' : 
        'AI learning disabled. Your reading patterns will not be tracked.');
    }

    // Change mood preference
    function changeMoodPreference(mood) {
      aiAgent.profile.moodPreference = mood;
      aiAgent.saveProfile();
      
      // Update button states
      document.querySelectorAll('.mood-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-mood="${mood}"]`)?.classList.add('active');
      
      // Reload with new mood filter
      renderNews();
    }

    // Make functions globally accessible
    window.showAIRecommendations = showAIRecommendations;
    window.showQuickReads = showQuickReads;
    window.toggleAILearning = toggleAILearning;
    window.changeMoodPreference = changeMoodPreference;
    window.aiAgent = aiAgent;

    // Initialize AI insights on load
    updateAIInsights();

    // ======================
    // WEATHER WIDGET
    // ======================
    
    async function loadWeather() {
      const weatherWidget = document.getElementById('weather-widget');
      const weatherIcon = document.getElementById('weather-icon');
      const weatherText = document.getElementById('weather-text');
      
      if (!weatherWidget) return;

      try {
        // Try to get user's location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              const { latitude, longitude } = position.coords;
              await fetchWeatherByCoords(latitude, longitude);
            },
            async (error) => {
              // Fallback to IP-based location
              console.log('Geolocation denied, using IP-based location');
              await fetchWeatherByIP();
            },
            { timeout: 5000 }
          );
        } else {
          // Fallback to IP-based location
          await fetchWeatherByIP();
        }
      } catch (error) {
        console.error('Weather loading error:', error);
        weatherText.textContent = 'Weather unavailable';
        weatherWidget.style.display = 'inline-flex';
      }
    }

    async function fetchWeatherByCoords(lat, lon) {
      try {
        // Use wttr.in API (free, no key required)
        const response = await fetch(`https://wttr.in/?format=j1`);
        const data = await response.json();
        
        if (data && data.current_condition && data.current_condition[0]) {
          displayWeather(data.current_condition[0], data.nearest_area[0]);
        }
      } catch (error) {
        console.error('Weather fetch error:', error);
        await fetchWeatherByIP();
      }
    }

    async function fetchWeatherByIP() {
      try {
        // Use wttr.in with automatic location detection
        const response = await fetch(`https://wttr.in/?format=j1`);
        const data = await response.json();
        
        if (data && data.current_condition && data.current_condition[0]) {
          displayWeather(data.current_condition[0], data.nearest_area[0]);
        }
      } catch (error) {
        console.error('Weather fetch error:', error);
        const weatherWidget = document.getElementById('weather-widget');
        const weatherText = document.getElementById('weather-text');
        weatherText.textContent = 'Weather unavailable';
        weatherWidget.style.display = 'inline-flex';
      }
    }

    function displayWeather(current, location) {
      const weatherWidget = document.getElementById('weather-widget');
      const weatherIcon = document.getElementById('weather-icon');
      const weatherText = document.getElementById('weather-text');
      
      if (!current) return;

      const temp = current.temp_C || current.temp_F;
      const condition = current.weatherDesc?.[0]?.value || current.weatherDesc || 'Unknown';
      const locationName = location?.areaName?.[0]?.value || location?.region?.[0]?.value || 'Your location';
      
      // Map weather conditions to emojis
      const weatherEmojis = {
        'clear': '☀️',
        'sunny': '☀️',
        'partly cloudy': '⛅',
        'cloudy': '☁️',
        'overcast': '☁️',
        'mist': '🌫️',
        'fog': '🌫️',
        'rain': '🌧️',
        'light rain': '🌦️',
        'heavy rain': '⛈️',
        'thunderstorm': '⛈️',
        'snow': '❄️',
        'sleet': '🌨️',
        'drizzle': '🌦️'
      };

      // Find matching emoji
      let emoji = '🌤️';
      const conditionLower = condition.toLowerCase();
      for (const [key, value] of Object.entries(weatherEmojis)) {
        if (conditionLower.includes(key)) {
          emoji = value;
          break;
        }
      }

      weatherIcon.textContent = emoji;
      weatherText.textContent = `${temp}°C, ${condition} in ${locationName}`;
      weatherWidget.style.display = 'inline-flex';
      
      // Store in localStorage with timestamp
      const weatherData = {
        temp,
        condition,
        location: locationName,
        emoji,
        timestamp: Date.now()
      };
      localStorage.setItem('weatherData', JSON.stringify(weatherData));
    }

    // Load cached weather immediately, then refresh
    function initWeather() {
      const cached = localStorage.getItem('weatherData');
      if (cached) {
        try {
          const data = JSON.parse(cached);
          const age = Date.now() - data.timestamp;
          
          // Use cache if less than 30 minutes old
          if (age < 30 * 60 * 1000) {
            const weatherWidget = document.getElementById('weather-widget');
            const weatherIcon = document.getElementById('weather-icon');
            const weatherText = document.getElementById('weather-text');
            
            weatherIcon.textContent = data.emoji;
            weatherText.textContent = `${data.temp}°C, ${data.condition} in ${data.location}`;
            weatherWidget.style.display = 'inline-flex';
          }
        } catch (e) {
          console.error('Error loading cached weather:', e);
        }
      }
      
      // Refresh weather data
      loadWeather();
    }

    // Click to refresh weather
    document.getElementById('weather-widget')?.addEventListener('click', () => {
      const weatherText = document.getElementById('weather-text');
      weatherText.textContent = 'Refreshing...';
      loadWeather();
    });

    // Initialize weather on page load
    initWeather();

    // Refresh weather every 30 minutes
    setInterval(loadWeather, 30 * 60 * 1000);

    // ======================
    // VIEW LAYOUT CONTROLS
    // ======================
    
    let currentView = localStorage.getItem('preferredView') || 'list';

    function changeView(view) {
      currentView = view;
      localStorage.setItem('preferredView', view);
      
      const newsList = document.getElementById('news-list');
      const listBtn = document.getElementById('list-view-btn');
      const gridBtn = document.getElementById('grid-view-btn');
      const compactBtn = document.getElementById('compact-view-btn');
      
      // Remove all view classes
      newsList.classList.remove('grid-view', 'compact-view');
      listBtn.classList.remove('active');
      gridBtn.classList.remove('active');
      compactBtn.classList.remove('active');
      
      // Apply selected view
      if (view === 'grid') {
        newsList.classList.add('grid-view');
        gridBtn.classList.add('active');
      } else if (view === 'compact') {
        newsList.classList.add('compact-view');
        compactBtn.classList.add('active');
      } else {
        listBtn.classList.add('active');
      }
    }

    // Initialize view on load
    function initView() {
      changeView(currentView);
    }

    // Make function globally accessible
    window.changeView = changeView;

    // Initialize view after DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initView);
    } else {
      initView();
    }

    // ======================
    // WELLNESS FEATURES
    // ======================
    
    // Daily Inspiration Quotes
    const inspirationQuotes = [
      { text: "The best way to predict the future is to create it.", author: "Peter Drucker" },
      { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
      { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
      { text: "In the middle of difficulty lies opportunity.", author: "Albert Einstein" },
      { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
      { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
      { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
      { text: "Life is 10% what happens to you and 90% how you react to it.", author: "Charles R. Swindoll" },
      { text: "The best time to plant a tree was 20 years ago. The second best time is now.", author: "Chinese Proverb" },
      { text: "Your limitation—it's only your imagination.", author: "Unknown" },
      { text: "Great things never come from comfort zones.", author: "Unknown" },
      { text: "Dream it. Wish it. Do it.", author: "Unknown" },
      { text: "Success doesn't just find you. You have to go out and get it.", author: "Unknown" },
      { text: "The harder you work for something, the greater you'll feel when you achieve it.", author: "Unknown" },
      { text: "Don't stop when you're tired. Stop when you're done.", author: "Unknown" },
      { text: "Wake up with determination. Go to bed with satisfaction.", author: "Unknown" },
      { text: "Do something today that your future self will thank you for.", author: "Unknown" },
      { text: "Little things make big days.", author: "Unknown" },
      { text: "It's going to be hard, but hard does not mean impossible.", author: "Unknown" },
      { text: "Don't wait for opportunity. Create it.", author: "Unknown" }
    ];

    function loadDailyQuote() {
      const today = new Date().toDateString();
      const savedQuote = localStorage.getItem('dailyQuote');
      const savedDate = localStorage.getItem('dailyQuoteDate');
      
      if (savedDate === today && savedQuote) {
        const quote = JSON.parse(savedQuote);
        displayQuote(quote);
      } else {
        const randomQuote = inspirationQuotes[Math.floor(Math.random() * inspirationQuotes.length)];
        localStorage.setItem('dailyQuote', JSON.stringify(randomQuote));
        localStorage.setItem('dailyQuoteDate', today);
        displayQuote(randomQuote);
      }
    }

    function displayQuote(quote) {
      document.getElementById('quote-text').textContent = `"${quote.text}"`;
      document.getElementById('quote-author').textContent = `— ${quote.author}`;
    }

    // Ambient Music
    let musicAudio = null;
    let isMusicPlaying = false;

    function toggleMusic() {
      const musicBtn = document.getElementById('music-btn');
      
      if (!musicAudio) {
        // Using a free lo-fi music stream
        musicAudio = new Audio('https://stream.zeno.fm/f3wvbbqmdg8uv');
        musicAudio.loop = true;
        musicAudio.volume = 0.3;
      }

      if (isMusicPlaying) {
        musicAudio.pause();
        musicBtn.classList.remove('active');
        isMusicPlaying = false;
      } else {
        musicAudio.play().catch(e => console.log('Music play failed:', e));
        musicBtn.classList.add('active');
        isMusicPlaying = true;
      }
    }

    // Breathing Exercise
    function showBreathingExercise() {
      document.getElementById('breathing-modal').classList.add('show');
      animateBreathingText();
    }

    function closeBreathingExercise() {
      document.getElementById('breathing-modal').classList.remove('show');
    }

    function animateBreathingText() {
      const instruction = document.getElementById('breathing-instruction');
      const phases = ['Breathe In...', 'Hold...', 'Breathe Out...', 'Hold...'];
      let index = 0;
      
      const interval = setInterval(() => {
        if (!document.getElementById('breathing-modal').classList.contains('show')) {
          clearInterval(interval);
          return;
        }
        instruction.textContent = phases[index];
        index = (index + 1) % phases.length;
      }, 2000);
    }

    // Theme Cycling
    let currentTheme = 'default';
    const themes = ['default', 'ocean', 'forest', 'sunset'];

    function cycleTheme() {
      const currentIndex = themes.indexOf(currentTheme);
      const nextIndex = (currentIndex + 1) % themes.length;
      currentTheme = themes[nextIndex];
      
      // Remove all theme classes
      document.querySelectorAll('.theme-overlay').forEach(el => el.classList.remove('active'));
      
      // Apply new theme
      if (currentTheme !== 'default') {
        document.getElementById(`theme-${currentTheme}`).classList.add('active');
      }
      
      // Show notification
      const themeNames = {
        'default': 'Default Theme',
        'ocean': '🌊 Ocean Theme',
        'forest': '🌲 Forest Theme',
        'sunset': '🌅 Sunset Theme'
      };
      
      const notification = document.getElementById('theme-notification');
      notification.textContent = themeNames[currentTheme];
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 2000);
      
      localStorage.setItem('preferredTheme', currentTheme);
    }

    // Zen Mode
    let isZenMode = false;

    function toggleZenMode() {
      isZenMode = !isZenMode;
      const zenBtn = document.getElementById('zen-btn');
      
      if (isZenMode) {
        document.body.classList.add('zen-mode');
        zenBtn.classList.add('active');
      } else {
        document.body.classList.remove('zen-mode');
        zenBtn.classList.remove('active');
      }
    }

    // Mood Tracker
    let selectedMood = null;
    let moodBefore = null;
    let moodAfter = null;

    function showMoodTracker() {
      const moodData = JSON.parse(localStorage.getItem('moodData') || '{}');
      const today = new Date().toDateString();
      
      if (moodData.date === today && moodData.before) {
        // Already tracked today, show after mood
        document.getElementById('mood-title').textContent = 'How are you feeling now?';
        document.getElementById('mood-subtitle').textContent = 'After reading the positive news';
        moodBefore = moodData.before;
      } else {
        document.getElementById('mood-title').textContent = 'How are you feeling?';
        document.getElementById('mood-subtitle').textContent = "Let's check in before you start reading";
        moodBefore = null;
      }
      
      document.getElementById('mood-modal').classList.add('show');
    }

    function selectMood(mood) {
      selectedMood = mood;
      
      // Update UI
      document.querySelectorAll('.mood-option').forEach(el => el.classList.remove('selected'));
      document.querySelector(`[data-mood="${mood}"]`).classList.add('selected');
      document.getElementById('mood-submit-btn').style.display = 'block';
    }

    function submitMood() {
      if (!selectedMood) return;
      
      const moodData = JSON.parse(localStorage.getItem('moodData') || '{}');
      const today = new Date().toDateString();
      
      if (!moodBefore) {
        // First mood of the day
        moodData.date = today;
        moodData.before = selectedMood;
        localStorage.setItem('moodData', JSON.stringify(moodData));
        
        closeMoodTracker();
        showAffirmation('Great! Enjoy reading positive news. Check back later to see how you feel! 🌟');
      } else {
        // After mood
        moodData.after = selectedMood;
        localStorage.setItem('moodData', JSON.stringify(moodData));
        
        closeMoodTracker();
        showMoodImprovement(moodBefore, selectedMood);
      }
      
      selectedMood = null;
    }

    function closeMoodTracker() {
      document.getElementById('mood-modal').classList.remove('show');
      document.getElementById('mood-submit-btn').style.display = 'none';
      document.querySelectorAll('.mood-option').forEach(el => el.classList.remove('selected'));
    }

    function showMoodImprovement(before, after) {
      const moodValues = { stressed: 1, sad: 2, neutral: 3, good: 4, happy: 5 };
      const improvement = moodValues[after] - moodValues[before];
      
      let message = '';
      if (improvement > 0) {
        message = `Amazing! Your mood improved from ${before} to ${after}! 🎉 Positive news works!`;
      } else if (improvement === 0) {
        message = `You're feeling ${after}. Keep reading positive stories! 💪`;
      } else {
        message = `Thanks for sharing. Remember, it's okay to have ups and downs. 💙`;
      }
      
      showAffirmation(message);
    }

    function showAffirmation(message) {
      const affirmation = document.createElement('div');
      affirmation.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: white;
        padding: 24px 32px;
        border-radius: 16px;
        font-size: 1.1rem;
        font-weight: 600;
        text-align: center;
        z-index: 100003;
        box-shadow: 0 10px 40px rgba(139, 92, 246, 0.4);
        max-width: 400px;
        animation: fadeIn 0.3s ease;
      `;
      affirmation.textContent = message;
      document.body.appendChild(affirmation);
      
      setTimeout(() => {
        affirmation.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => affirmation.remove(), 300);
      }, 3000);
    }

    // Initialize wellness features
    loadDailyQuote();
    
    // Load saved theme
    const savedTheme = localStorage.getItem('preferredTheme');
    if (savedTheme && savedTheme !== 'default') {
      currentTheme = savedTheme;
      document.getElementById(`theme-${savedTheme}`).classList.add('active');
    }

    // Show mood tracker on first visit of the day
    const moodData = JSON.parse(localStorage.getItem('moodData') || '{}');
    const today = new Date().toDateString();
    if (moodData.date !== today) {
      setTimeout(() => showMoodTracker(), 2000);
    }

    // Make functions globally accessible
    window.toggleMusic = toggleMusic;
    window.showBreathingExercise = showBreathingExercise;
    window.closeBreathingExercise = closeBreathingExercise;
    window.cycleTheme = cycleTheme;
    window.toggleZenMode = toggleZenMode;
    window.showMoodTracker = showMoodTracker;
    window.selectMood = selectMood;
    window.submitMood = submitMood;
    window.closeMoodTracker = closeMoodTracker;

    // ======================
    // UNIQUE FEATURES
    // ======================
    
    // 1. AI PERSONALITY - HOPE
    const hopePersonality = {
      greetings: [
        "Hey! I'm Hope, your AI news companion. I've found some amazing stories for you today! 💫",
        "Good to see you! I'm Hope, and I've curated the best positive news just for you! ✨",
        "Welcome back! I'm Hope, and I'm excited to share today's uplifting stories with you! 🌟",
        "Hi there! I'm Hope, your personal curator of good news. Let's brighten your day! 🌈",
        "Hello! I'm Hope, and I've been busy finding the most inspiring stories for you! 💝"
      ],
      insights: [
        "I noticed you love {category} news! I've prioritized similar stories today.",
        "You've been on a {streak}-day reading streak! That's amazing! Keep it up!",
        "I found {count} stories that match your interests perfectly!",
        "Today's news is particularly uplifting - I'm excited for you to read them!",
        "I've learned what you like, and today's selection is tailored just for you!"
      ]
    };

    function updateHopeMessage() {
      const t = translations[currentLanguage].ui;
      const greetings = [
        t.hopeGreeting1 || hopePersonality.greetings[2],
        t.hopeGreeting2 || hopePersonality.greetings[3],
        t.hopeGreeting3 || hopePersonality.greetings[4]
      ];
      const greeting = greetings[Math.floor(Math.random() * greetings.length)];
      const hopeText = document.getElementById('hope-text');
      if (hopeText) {
        hopeText.textContent = greeting;
      }
    }

    // 2. HOPE SCORE CALCULATION
    function calculateHopeScore() {
      const stats = JSON.parse(localStorage.getItem('readingStats') || '{}');
      const moodData = JSON.parse(localStorage.getItem('moodData') || '{}');
      
      let score = 50; // Base score
      
      // Reading activity boost
      if (stats.readToday) score += Math.min(stats.readToday * 2, 20);
      if (stats.streak) score += Math.min(stats.streak, 15);
      
      // Mood improvement boost
      if (moodData.before && moodData.after) {
        const moodValues = { stressed: 1, sad: 2, neutral: 3, good: 4, happy: 5 };
        const improvement = moodValues[moodData.after] - moodValues[moodData.before];
        score += improvement * 5;
      }
      
      // AI learning boost
      if (aiAgent && aiAgent.profile.totalInteractions > 10) {
        score += 10;
      }
      
      return Math.min(Math.max(score, 0), 100);
    }

    function updateHopeScore() {
      const score = calculateHopeScore();
      const scoreEl = document.getElementById('hope-score-number');
      if (scoreEl) {
        scoreEl.textContent = score;
      }
    }

    function showHopeScoreModal() {
      const score = calculateHopeScore();
      let message = '';
      
      if (score >= 90) {
        message = 'Amazing! Your Hope Score is outstanding! You\'re spreading positivity everywhere! 🌟';
      } else if (score >= 75) {
        message = 'Great job! Your Hope Score shows you\'re actively engaging with positive news! 💫';
      } else if (score >= 50) {
        message = 'Good start! Keep reading to boost your Hope Score even higher! ✨';
      } else {
        message = 'Welcome! Start reading positive news to build your Hope Score! 🌈';
      }
      
      showAffirmation(message);
    }

    // 3. COMMUNITY STATS (Simulated)
    function updateCommunityStats() {
      const baseReads = 1247893;
      const baseReaders = 2341;
      const randomReads = Math.floor(Math.random() * 100);
      const randomReaders = Math.floor(Math.random() * 50);
      
      document.getElementById('global-reads').textContent = (baseReads + randomReads).toLocaleString();
      document.getElementById('active-readers').textContent = (baseReaders + randomReaders).toLocaleString();
      
      // Hope spread percentage (always high!)
      const hopeSpread = 92 + Math.floor(Math.random() * 6);
      document.getElementById('hope-spread').textContent = hopeSpread + '%';
    }

    // Update community stats every 30 seconds
    setInterval(updateCommunityStats, 30000);

    // 4. STORY ARCS TRACKER
    const storyArcs = [
      { keywords: ['climate', 'renewable', 'solar', 'wind'], category: 'environment' },
      { keywords: ['vaccine', 'cure', 'treatment', 'medical'], category: 'health' },
      { keywords: ['space', 'mars', 'moon', 'rocket'], category: 'space' },
      { keywords: ['ai', 'artificial intelligence', 'machine learning'], category: 'ai' }
    ];

    function detectStoryArc(article) {
      const text = `${article.title || ''} ${article.description || ''}`.toLowerCase();
      
      for (const arc of storyArcs) {
        if (arc.keywords.some(keyword => text.includes(keyword))) {
          article.isStoryArc = true;
          return true;
        }
      }
      return false;
    }

    // 5. TIME CAPSULE
    function loadTimeCapsule() {
      const oneYearAgo = new Date();
      oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
      
      const timeCapsuleStories = [
        "One year ago: Scientists announced a breakthrough in renewable energy storage.",
        "One year ago: Global poverty rates hit historic lows according to UN report.",
        "One year ago: New conservation efforts saved 3 endangered species from extinction.",
        "One year ago: Revolutionary cancer treatment showed 90% success rate in trials.",
        "One year ago: Record number of countries committed to carbon neutrality."
      ];
      
      const randomStory = timeCapsuleStories[Math.floor(Math.random() * timeCapsuleStories.length)];
      const capsuleEl = document.getElementById('time-capsule');
      const contentEl = document.getElementById('time-capsule-content');
      
      if (capsuleEl && contentEl) {
        contentEl.textContent = randomStory;
        capsuleEl.style.display = 'block';
      }
    }

    // 6. LIVING BACKGROUND
    function updateLivingBackground() {
      const hour = new Date().getHours();
      const body = document.body;
      
      // Remove all time classes
      body.classList.remove('time-morning', 'time-afternoon', 'time-evening', 'time-night');
      
      // Add appropriate class
      if (hour >= 5 && hour < 12) {
        body.classList.add('time-morning');
      } else if (hour >= 12 && hour < 17) {
        body.classList.add('time-afternoon');
      } else if (hour >= 17 && hour < 21) {
        body.classList.add('time-evening');
      } else {
        body.classList.add('time-night');
      }
    }

    // Update background every minute
    setInterval(updateLivingBackground, 60000);

    // 7. ACTION MODAL
    const actionSuggestions = {
      environment: [
        "🌱 Plant a tree in your community",
        "♻️ Start composting at home",
        "🚴 Use public transport or bike this week",
        "💡 Switch to LED bulbs",
        "🛍️ Bring reusable bags when shopping"
      ],
      health: [
        "🏃 Take a 15-minute walk today",
        "🥗 Add one more vegetable to your meals",
        "💧 Drink 8 glasses of water",
        "😴 Get 7-8 hours of sleep",
        "🧘 Try 5 minutes of meditation"
      ],
      science: [
        "📚 Read a science article today",
        "🔬 Visit a science museum",
        "👨‍🔬 Support science education",
        "🌟 Share science news with friends",
        "💻 Learn about a new technology"
      ],
      ai: [
        "💻 Learn basic coding online",
        "🤖 Explore AI tools responsibly",
        "📖 Read about AI ethics",
        "🎓 Take a free AI course",
        "💡 Think about AI's positive impact"
      ],
      default: [
        "💝 Do one kind act today",
        "📱 Share positive news with someone",
        "🙏 Express gratitude to someone",
        "😊 Smile at a stranger",
        "🤝 Help someone in need"
      ]
    };

    function showActionModal(category, title) {
      const actions = actionSuggestions[category] || actionSuggestions.default;
      const randomActions = actions.sort(() => 0.5 - Math.random()).slice(0, 3);
      
      const message = `Inspired by this story? Here's what you can do:\n\n${randomActions.join('\n')}`;
      showAffirmation(message);
    }

    // 8. AUDIO SUMMARIES WITH PERSONALITY
    function startReadingWithPersonality() {
      if (isReading) {
        stopReading();
        return;
      }

      const articles = Array.from(document.querySelectorAll('.news-card:not(.hidden)'));
      
      if (articles.length === 0) {
        alert('No articles to read');
        return;
      }

      let textToRead = 'Hi! I\'m Hope, your AI news companion. Let me share today\'s most inspiring stories with you. ';
      
      articles.slice(0, 5).forEach((article, index) => {
        const title = article.querySelector('.news-title')?.textContent || '';
        const summary = article.querySelector('.ai-summary')?.textContent || '';
        textToRead += `Story number ${index + 1}. ${title}. ${summary}. `;
      });

      textToRead += ' That\'s all for now! Remember, every day brings new reasons to hope. Stay positive!';

      currentUtterance = new SpeechSynthesisUtterance(textToRead);
      currentUtterance.rate = 0.9;
      currentUtterance.pitch = 1.1; // Slightly higher pitch for Hope's voice
      currentUtterance.volume = 1;

      currentUtterance.onstart = () => {
        isReading = true;
        document.getElementById('tts-play-btn').style.display = 'none';
        document.getElementById('tts-stop-btn').style.display = 'flex';
        document.getElementById('tts-stop-btn').classList.add('active');
      };

      currentUtterance.onend = () => {
        stopReading();
      };

      speechSynthesis.speak(currentUtterance);
    }

    // Override the original TTS function
    document.getElementById('tts-play-btn').onclick = startReadingWithPersonality;

    // Initialize unique features
    updateHopeMessage();
    updateHopeScore();
    updateCommunityStats();
    loadTimeCapsule();
    updateLivingBackground();

    // Make functions globally accessible
    window.showHopeScoreModal = showHopeScoreModal;
    window.showActionModal = showActionModal;

  </script>

  <!-- Authentication Modals -->
  <div id="auth-modal" class="auth-modal" style="display: none;">
    <div class="auth-modal-content">
      <span class="auth-modal-close" onclick="closeAuthModal()">&times;</span>
      
      <!-- Login Form -->
      <div id="login-form" class="auth-form">
        <h2>Welcome Back! 👋</h2>
        <p>Sign in to get personalized news and track your reading habits</p>
        
        <form onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="login-email">Email or Username</label>
            <input type="text" id="login-email" required placeholder="Enter your email or username">
          </div>
          
          <div class="form-group">
            <label for="login-password">Password</label>
            <input type="password" id="login-password" required placeholder="Enter your password">
          </div>
          
          <button type="submit" class="auth-submit-btn" id="login-submit-btn">
            <span class="btn-text">Sign In</span>
            <span class="btn-loading" style="display: none;">Signing in...</span>
          </button>
        </form>
        
        <div class="auth-switch">
          Don't have an account? 
          <a href="#" onclick="switchToSignup()">Sign up here</a>
        </div>
      </div>
      
      <!-- Signup Form -->
      <div id="signup-form" class="auth-form" style="display: none;">
        <h2>Join Dashboard1! ✨</h2>
        <p>Create your account to get personalized news and wellness features</p>
        
        <form onsubmit="handleSignup(event)">
          <div class="form-row">
            <div class="form-group">
              <label for="signup-firstname">First Name</label>
              <input type="text" id="signup-firstname" placeholder="John">
            </div>
            <div class="form-group">
              <label for="signup-lastname">Last Name</label>
              <input type="text" id="signup-lastname" placeholder="Doe">
            </div>
          </div>
          
          <div class="form-group">
            <label for="signup-username">Username</label>
            <input type="text" id="signup-username" required placeholder="Choose a username">
          </div>
          
          <div class="form-group">
            <label for="signup-email">Email</label>
            <input type="email" id="signup-email" required placeholder="your@email.com">
          </div>
          
          <div class="form-group">
            <label for="signup-password">Password</label>
            <input type="password" id="signup-password" required placeholder="Create a secure password" minlength="6">
          </div>
          
          <button type="submit" class="auth-submit-btn" id="signup-submit-btn">
            <span class="btn-text">Create Account</span>
            <span class="btn-loading" style="display: none;">Creating account...</span>
          </button>
        </form>
        
        <div class="auth-switch">
          Already have an account? 
          <a href="#" onclick="switchToLogin()">Sign in here</a>
        </div>
      </div>
    </div>
  </div>

  <!-- User Preferences Modal -->
  <div id="preferences-modal" class="auth-modal" style="display: none;">
    <div class="auth-modal-content">
      <span class="auth-modal-close" onclick="closePreferencesModal()">&times;</span>
      
      <div class="preferences-form">
        <h2>📰 News Preferences</h2>
        <p>Customize your news feed for the best experience</p>
        
        <div class="form-group">
          <label>Favorite Categories</label>
          <div class="category-grid">
            <label class="category-checkbox">
              <input type="checkbox" value="technology" checked>
              <span>💻 Technology</span>
            </label>
            <label class="category-checkbox">
              <input type="checkbox" value="business">
              <span>💼 Business</span>
            </label>
            <label class="category-checkbox">
              <input type="checkbox" value="science">
              <span>🔬 Science</span>
            </label>
            <label class="category-checkbox">
              <input type="checkbox" value="health">
              <span>🏥 Health</span>
            </label>
            <label class="category-checkbox">
              <input type="checkbox" value="ai">
              <span>🤖 AI & ML</span>
            </label>
            <label class="category-checkbox">
              <input type="checkbox" value="startups">
              <span>🚀 Startups</span>
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label for="positivity-slider">Positivity Filter</label>
          <input type="range" id="positivity-slider" min="-1" max="1" step="0.1" value="0.1">
          <div class="slider-labels">
            <span>All News</span>
            <span>Balanced</span>
            <span>Positive Only</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="digest-frequency">News Digest</label>
          <select id="digest-frequency">
            <option value="realtime">Real-time updates</option>
            <option value="hourly">Hourly digest</option>
            <option value="daily" selected>Daily digest</option>
            <option value="weekly">Weekly summary</option>
          </select>
        </div>
        
        <button onclick="savePreferences()" class="auth-submit-btn">
          Save Preferences
        </button>
      </div>
    </div>
  </div>

  <style>
    /* Authentication Modal Styles */
    .auth-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .auth-modal-content {
      background: white;
      border-radius: 16px;
      padding: 32px;
      max-width: 400px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .auth-modal-close {
      position: absolute;
      top: 16px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #64748b;
      transition: color 0.2s ease;
    }

    .auth-modal-close:hover {
      color: #f97316;
    }

    .auth-form h2 {
      margin-bottom: 8px;
      color: #1e293b;
      font-size: 1.5rem;
    }

    .auth-form p {
      margin-bottom: 24px;
      color: #64748b;
      font-size: 0.9rem;
    }

    .form-row {
      display: flex;
      gap: 12px;
    }

    .form-group {
      margin-bottom: 16px;
      flex: 1;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      color: #374151;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.2s ease;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .auth-submit-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 16px;
    }

    .auth-submit-btn:hover {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .auth-submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .auth-switch {
      text-align: center;
      color: #64748b;
      font-size: 0.9rem;
    }

    .auth-switch a {
      color: #6366f1;
      text-decoration: none;
      font-weight: 500;
    }

    .auth-switch a:hover {
      text-decoration: underline;
    }

    /* Category Selection */
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
    }

    .category-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .category-checkbox:hover {
      border-color: #6366f1;
      background: #f8fafc;
    }

    .category-checkbox input:checked + span {
      color: #6366f1;
      font-weight: 600;
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #64748b;
      margin-top: 4px;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .auth-modal-content {
        padding: 24px;
        margin: 10px;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .category-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <script>
    // Authentication State
    let currentUser = null;
    let authToken = localStorage.getItem('dashboard1_token');

    // API Configuration
    const API_BASE_URL = 'http://localhost:5000/api'; // Change to your backend URL

    // Initialize authentication state
    document.addEventListener('DOMContentLoaded', function() {
      if (authToken) {
        verifyToken();
      }
    });

    // Show/Hide Authentication Modals
    function showLoginModal() {
      document.getElementById('auth-modal').style.display = 'flex';
      document.getElementById('login-form').style.display = 'block';
      document.getElementById('signup-form').style.display = 'none';
    }

    function showSignupModal() {
      document.getElementById('auth-modal').style.display = 'flex';
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('signup-form').style.display = 'block';
    }

    function closeAuthModal() {
      document.getElementById('auth-modal').style.display = 'none';
    }

    function switchToSignup() {
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('signup-form').style.display = 'block';
    }

    function switchToLogin() {
      document.getElementById('signup-form').style.display = 'none';
      document.getElementById('login-form').style.display = 'block';
    }

    // Handle Login
    async function handleLogin(event) {
      event.preventDefault();
      
      const submitBtn = document.getElementById('login-submit-btn');
      const btnText = submitBtn.querySelector('.btn-text');
      const btnLoading = submitBtn.querySelector('.btn-loading');
      
      // Show loading state
      submitBtn.disabled = true;
      btnText.style.display = 'none';
      btnLoading.style.display = 'inline';
      
      try {
        const response = await fetch(`${API_BASE_URL}/auth/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            login: document.getElementById('login-email').value,
            password: document.getElementById('login-password').value
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Store token and user data
          localStorage.setItem('dashboard1_token', data.data.token);
          currentUser = data.data.user;
          
          // Update UI
          updateAuthUI();
          closeAuthModal();
          
          // Show success message
          showNotification('Welcome back! 🎉', 'success');
          
          // Refresh news feed with personalized content
          refreshNewsFeed();
        } else {
          showNotification(data.message || 'Login failed', 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showNotification('Connection error. Please try again.', 'error');
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
      }
    }

    // Handle Signup
    async function handleSignup(event) {
      event.preventDefault();
      
      const submitBtn = document.getElementById('signup-submit-btn');
      const btnText = submitBtn.querySelector('.btn-text');
      const btnLoading = submitBtn.querySelector('.btn-loading');
      
      // Show loading state
      submitBtn.disabled = true;
      btnText.style.display = 'none';
      btnLoading.style.display = 'inline';
      
      try {
        const response = await fetch(`${API_BASE_URL}/auth/register`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            username: document.getElementById('signup-username').value,
            email: document.getElementById('signup-email').value,
            password: document.getElementById('signup-password').value,
            firstName: document.getElementById('signup-firstname').value,
            lastName: document.getElementById('signup-lastname').value
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Store token and user data
          localStorage.setItem('dashboard1_token', data.data.token);
          currentUser = data.data.user;
          
          // Update UI
          updateAuthUI();
          closeAuthModal();
          
          // Show success message
          showNotification('Account created successfully! 🎉', 'success');
          
          // Show preferences modal for new users
          setTimeout(() => {
            showPreferencesModal();
          }, 1000);
        } else {
          showNotification(data.message || 'Signup failed', 'error');
        }
      } catch (error) {
        console.error('Signup error:', error);
        showNotification('Connection error. Please try again.', 'error');
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
      }
    }

    // Verify Token
    async function verifyToken() {
      try {
        const response = await fetch(`${API_BASE_URL}/auth/profile`, {
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          currentUser = data.data.user;
          updateAuthUI();
        } else {
          // Token invalid, clear it
          localStorage.removeItem('dashboard1_token');
          authToken = null;
        }
      } catch (error) {
        console.error('Token verification error:', error);
        localStorage.removeItem('dashboard1_token');
        authToken = null;
      }
    }

    // Update Authentication UI
    function updateAuthUI() {
      const authSection = document.getElementById('auth-section');
      const userProfile = document.getElementById('user-profile');
      
      if (currentUser) {
        // Hide auth buttons, show user profile
        authSection.style.display = 'none';
        userProfile.style.display = 'block';
        
        // Update user info
        document.getElementById('user-name').textContent = currentUser.username;
        
        // Update avatar if available
        if (currentUser.profile && currentUser.profile.avatar) {
          document.getElementById('user-avatar').textContent = currentUser.profile.avatar;
        }
      } else {
        // Show auth buttons, hide user profile
        authSection.style.display = 'flex';
        userProfile.style.display = 'none';
      }
    }

    // Profile Menu Toggle
    function toggleProfileMenu() {
      const dropdown = document.getElementById('profile-dropdown');
      dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    }

    // Close profile menu when clicking outside
    document.addEventListener('click', function(event) {
      const profileBtn = document.getElementById('profile-btn');
      const dropdown = document.getElementById('profile-dropdown');
      
      if (!profileBtn.contains(event.target)) {
        dropdown.style.display = 'none';
      }
    });

    // Logout
    function logout() {
      localStorage.removeItem('dashboard1_token');
      authToken = null;
      currentUser = null;
      updateAuthUI();
      showNotification('Logged out successfully', 'info');
      refreshNewsFeed();
    }

    // Show Preferences Modal
    function showPreferencesModal() {
      document.getElementById('preferences-modal').style.display = 'flex';
      
      // Load current preferences if user is logged in
      if (currentUser && currentUser.preferences) {
        loadUserPreferences();
      }
    }

    function closePreferencesModal() {
      document.getElementById('preferences-modal').style.display = 'none';
    }

    // Load User Preferences
    function loadUserPreferences() {
      const prefs = currentUser.preferences;
      
      // Set category checkboxes
      const categoryCheckboxes = document.querySelectorAll('.category-checkbox input');
      categoryCheckboxes.forEach(checkbox => {
        checkbox.checked = prefs.categories.includes(checkbox.value);
      });
      
      // Set positivity slider
      document.getElementById('positivity-slider').value = prefs.positivityThreshold || 0.1;
      
      // Set digest frequency
      document.getElementById('digest-frequency').value = prefs.digestFrequency || 'daily';
    }

    // Save Preferences
    async function savePreferences() {
      if (!currentUser) return;
      
      const categories = Array.from(document.querySelectorAll('.category-checkbox input:checked'))
        .map(cb => cb.value);
      
      const preferences = {
        categories: categories,
        positivityThreshold: parseFloat(document.getElementById('positivity-slider').value),
        digestFrequency: document.getElementById('digest-frequency').value
      };
      
      try {
        const response = await fetch(`${API_BASE_URL}/auth/preferences`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(preferences)
        });
        
        if (response.ok) {
          const data = await response.json();
          currentUser.preferences = data.data.preferences;
          closePreferencesModal();
          showNotification('Preferences saved! 🎯', 'success');
          refreshNewsFeed();
        } else {
          showNotification('Failed to save preferences', 'error');
        }
      } catch (error) {
        console.error('Save preferences error:', error);
        showNotification('Connection error', 'error');
      }
    }

    // Show Profile Settings
    function showProfileSettings() {
      showPreferencesModal();
    }

    // Show Reading Stats
    function showReadingStats() {
      if (currentUser && currentUser.analytics) {
        const stats = currentUser.analytics;
        alert(`📊 Your Reading Stats:\n\nTotal Articles Read: ${stats.totalReads}\nReading Time: ${Math.round(stats.readingTime / 60)} minutes\nFavorite Categories: ${stats.favoriteCategories.join(', ')}`);
      }
    }

    // Show Preferences
    function showPreferences() {
      showPreferencesModal();
    }

    // Refresh News Feed
    function refreshNewsFeed() {
      // This would trigger a refresh of the news feed with user preferences
      // For now, just reload the page
      location.reload();
    }

    // Show Notification
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 10001;
        animation: slideIn 0.3s ease;
      `;
      
      // Set background color based on type
      switch (type) {
        case 'success':
          notification.style.background = '#10b981';
          break;
        case 'error':
          notification.style.background = '#ef4444';
          break;
        case 'info':
        default:
          notification.style.background = '#6366f1';
          break;
      }
      
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Add slide-in animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    `;
    document.head.appendChild(style);

    // ======================
    // SAFE TESTIMONIALS REMOVAL
    // ======================
    function safeRemoveTestimonials() {
      console.log('Safely removing testimonials...');
      
      // Only target very specific testimonials content
      document.querySelectorAll('.sidebar-card').forEach(card => {
        const text = card.textContent || '';
        // Only remove if it contains ALL these specific testimonials indicators
        if (text.includes('What People Say') && 
            text.includes('John Doe') && 
            text.includes('Sarah Kumar') && 
            text.includes('Alex Patel')) {
          console.log('Removing testimonials sidebar-card:', card);
          card.style.display = 'none';
        }
      });
    }

    // Run safely after page loads
    document.addEventListener('DOMContentLoaded', safeRemoveTestimonials);
    window.addEventListener('load', safeRemoveTestimonials);
  </script>

</body>
</html>
